<!DOCTYPE html>
<html lang="fa" dir="rtl" data-theme="dark">
<head>
<meta charset="utf-8">
<title>System</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@100;300;400;500;700;900&display=swap" rel="stylesheet">
<script src="xlsx.full.min.js"></script>
<script src="crypto-js.min.js"></script>
<style>
:root {
    --bg-body: #003035;
    --bg-sidebar: #002225;
    --bg-card: linear-gradient(145deg, #004d4d, #003333);
    --bg-input: rgba(0, 0, 0, 0.3);
    --gold-primary: #d4af37;
    --gold-hover: #f9d877;
    --gold-shadow: rgba(212, 175, 55, 0.5);
    --gold-border: rgba(212, 175, 55, 0.7);
    --gold-faint: rgba(212, 175, 55, 0.2);
    --text-main: #e0f2f1;
    --text-muted: #d4af37;
    --btn-bg: linear-gradient(145deg, #005252, #003d3d);
    --success: #00e676; 
    --danger: #ff5252;
    --radius: 12px;
}
[data-theme="light"] {
    --bg-body: #f8f9fa;
    --bg-sidebar: #ffffff;
    --bg-card: #ffffff;
    --bg-input: #f1f3f5;
    --gold-primary: #b8860b; 
    --gold-hover: #d4af37;
    --gold-shadow: rgba(184, 134, 11, 0.15);
    --gold-border: rgba(184, 134, 11, 0.3);
    --gold-faint: rgba(184, 134, 11, 0.08);
    --text-main: #1f2937;
    --text-muted: #856404;
    --btn-bg: linear-gradient(145deg, #ffffff, #f3f4f6);
    --success: #059669; 
    --danger: #dc2626;
    --radius: 12px;
}
input:focus, select:focus, button:focus, .nav-btn:focus, textarea:focus, .fx-box:focus-within {
    outline: 3px solid var(--success) !important;
    box-shadow: 0 0 20px rgba(0, 230, 118, 0.6) !important;
    border-color: var(--success) !important;
    z-index: 100;
    transform: scale(1.01);
}
* { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Vazirmatn', 'Segoe UI', 'Tahoma', 'Arial', sans-serif !important; transition: background 0.3s ease, color 0.2s; }
body { background-color: var(--bg-body); color: var(--text-main); height: 100vh; overflow: hidden; display: flex; }
html[dir="ltr"] body { direction: ltr; }
html[dir="rtl"] body { direction: rtl; }
::-webkit-scrollbar { width: 8px; }
::-webkit-scrollbar-track { background: var(--bg-sidebar); }
html[dir="rtl"] ::-webkit-scrollbar-track { border-left: 1px solid var(--gold-border); }
html[dir="ltr"] ::-webkit-scrollbar-track { border-right: 1px solid var(--gold-border); }
::-webkit-scrollbar-thumb { background: var(--gold-primary); border-radius: 4px; border: 1px solid var(--bg-body); }
#loginPage { 
    position: fixed; top: 0; right: 0; width: 100%; height: 100%; 
    background-color: #001a1c;
    background-image: radial-gradient(var(--gold-border) 1px, transparent 1px);
    background-size: 30px 30px;
    z-index: 9999; 
    display: flex; align-items: center; justify-content: center; 
}
.login-box { 
    background: linear-gradient(180deg, rgba(0,30,30,0.95), rgba(0,15,15,0.98));
    padding: 60px 40px; 
    border-radius: 15px; 
    width: 100%; max-width: 420px; 
    text-align: center; 
    border: 4px double var(--gold-primary); 
    box-shadow: 0 0 50px rgba(0,0,0,0.8), inset 0 0 20px var(--gold-shadow);
    position: relative;
}
.login-box::before {
    content: "âšœ"; position: absolute; top: -25px; left: 50%; transform: translateX(-50%);
    font-size: 40px; color: var(--gold-primary); text-shadow: 0 0 10px var(--gold-shadow);
    background: #001a1c; padding: 0 10px; border-radius: 50%;
}
.login-header-text { color: var(--gold-primary); text-shadow: 0 2px 4px rgba(0,0,0,0.5); margin-bottom: 5px; font-weight: 900; letter-spacing: -1px; font-size: 28px; }
.login-sub-text { color: var(--gold-hover); margin-bottom: 30px; font-size: 13px; border-bottom: 1px solid var(--gold-border); display: inline-block; padding-bottom: 5px; font-weight: 300; }
.login-input { background: rgba(0,0,0,0.4) !important; border: 1px solid var(--gold-border) !important; color: var(--gold-primary) !important; text-align: center; border-radius: 50px !important; margin-bottom: 15px; transition: 0.3s; font-size: 16px; font-weight: bold; }
.login-input:focus { box-shadow: 0 0 15px var(--gold-shadow) !important; border-color: var(--gold-hover) !important; }
#loadingMsg { color: var(--gold-primary); margin-top: 20px; font-size: 14px; display: none; }
.lang-select-container { margin-top: 20px; display: flex; justify-content: center; gap: 10px; }
.lang-btn { background: transparent; border: 1px solid var(--gold-border); color: var(--gold-primary); padding: 5px 10px; border-radius: 8px; cursor: pointer; font-size: 12px; opacity: 0.6; }
.lang-btn.active { background: var(--gold-primary); color: #000; opacity: 1; font-weight: bold; }
#mainApp { display: flex; width: 100%; height: 100%; display: none; }
.sidebar { width: 280px; background: var(--bg-sidebar); display: flex; flex-direction: column; padding: 25px; flex-shrink: 0; box-shadow: 5px 0 15px rgba(0,0,0,0.05); z-index: 10; }
html[dir="rtl"] .sidebar { border-left: 1px solid var(--gold-border); }
html[dir="ltr"] .sidebar { border-right: 1px solid var(--gold-border); }
.content { flex-grow: 1; overflow-y: auto; padding: 30px; background-image: radial-gradient(circle at 10% 20%, var(--gold-faint) 0%, transparent 20%); }
.page { display: none; animation: fadeIn 0.4s; }
.page.active { display: block; }
@keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
.nav-btn { background: transparent; color: var(--text-muted); border: 1px solid transparent; padding: 15px; width: 100%; cursor: pointer; border-radius: var(--radius); margin-bottom: 8px; font-size: 15px; display: flex; align-items: center; gap: 10px; font-weight: 700; }
html[dir="rtl"] .nav-btn { text-align: right; }
html[dir="ltr"] .nav-btn { text-align: left; }
.nav-btn:hover { color: var(--gold-primary); background: var(--gold-faint); transform: translateX(5px); border: 1px solid var(--gold-border); }
html[dir="rtl"] .nav-btn:hover { transform: translateX(-5px); }
.nav-btn.active { background: linear-gradient(90deg, var(--gold-faint), transparent); color: var(--gold-primary); border: 1px solid var(--gold-border); box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
html[dir="rtl"] .nav-btn.active { border-right: 4px solid var(--gold-primary); }
html[dir="ltr"] .nav-btn.active { border-left: 4px solid var(--gold-primary); }
.card { background: var(--bg-card); border-radius: var(--radius); padding: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.08); margin-bottom: 20px; border: 1px solid var(--gold-border); position: relative; overflow: hidden; }
.card-header { font-size: 20px; font-weight: 900; margin-bottom: 20px; color: var(--gold-primary); border-bottom: 1px solid var(--gold-border); padding-bottom: 10px; display: flex; justify-content: space-between; align-items: center; letter-spacing: -0.5px; }
.grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
.grid-3 { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; }
.grid-4 { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; }
.input, select.input { width: 100%; padding: 10px 12px; border: 1px solid var(--gold-border); border-radius: var(--radius); margin-bottom: 10px; background: var(--bg-input); color: var(--text-main); outline: none; font-size: 14px; font-weight: 500; }
.input:focus { border-color: var(--gold-primary); box-shadow: 0 0 10px var(--gold-shadow); }
.label { font-size: 13px; color: var(--gold-primary); margin-bottom: 4px; display: block; font-weight: 700; }
.btn { padding: 10px 20px; border-radius: 50px; border: none; cursor: pointer; font-size: 14px; font-weight: 700; display: inline-flex; align-items: center; justify-content: center; gap: 5px; border: 1px solid transparent; }
.btn:hover { transform: translateY(-2px); filter: brightness(1.1); }
.btn-gold { background: linear-gradient(135deg, #b8860b 0%, #d4af37 50%, #b8860b 100%); color: #fff; box-shadow: 0 4px 15px rgba(184, 134, 11, 0.3); border: none; }
.btn-blue { background: linear-gradient(45deg, #1565c0, #42a5f5); color: white; border: 1px solid rgba(255,255,255,0.1); }
.btn-green { background: linear-gradient(45deg, #059669, #34d399); color: white; border: 1px solid rgba(255,255,255,0.1); }
.btn-red { background: linear-gradient(45deg, #b91c1c, #f87171); color: white; border: 1px solid rgba(255,255,255,0.1); }
.btn-purple { background: linear-gradient(45deg, #6d28d9, #a78bfa); color: white; border: 1px solid rgba(255,255,255,0.1); }
.btn-indigo { background: linear-gradient(45deg, #3730a3, #818cf8); color: white; border: 1px solid rgba(255,255,255,0.1); }
.btn-outline { background: transparent; border: 1px solid var(--gold-primary); color: var(--gold-primary); }
.btn-outline:hover { background: var(--gold-primary); color: #fff; }
.btn-sm { padding: 4px 8px !important; font-size: 11px !important; border-radius: 8px !important; min-width: auto !important; }
.fx-container { display: flex; flex-direction: column; gap: 15px; background: rgba(255,255,255,0.02); padding: 20px; border-radius: 16px; border: 1px solid var(--gold-border); margin-top: 15px; }
.fx-box { flex: 1; background: var(--bg-input); padding: 15px; border-radius: 12px; border: 1px solid var(--gold-border); position: relative; transition: 0.3s; }
.fx-box:focus-within { border-color: var(--gold-primary); box-shadow: 0 0 15px var(--gold-shadow); }
.fx-box-label { font-size: 11px; color: var(--gold-primary); font-weight: 700; margin-bottom: 5px; display: block; text-transform: uppercase; }
.fx-input-group { display: flex; align-items: center; justify-content: space-between; }
.fx-amount { font-size: 24px; font-weight: 900; background: transparent; border: none; color: var(--text-main); width: 100%; outline: none; font-family: 'Arial', sans-serif !important; direction: ltr; text-align: left; }
.fx-currency { font-weight: 900; color: var(--gold-primary); font-size: 16px; background: rgba(0,0,0,0.3); padding: 5px 10px; border-radius: 8px; border: none; cursor: pointer; outline: none; }
.fx-rate-bar { display: flex; align-items: center; justify-content: center; gap: 10px; margin: -10px 0; z-index: 2; position: relative; }
.fx-rate-badge { background: var(--bg-card); border: 1px solid var(--gold-primary); padding: 5px 15px; border-radius: 20px; font-size: 13px; font-weight: bold; color: var(--gold-primary); box-shadow: 0 4px 10px rgba(0,0,0,0.2); display: flex; gap: 5px; align-items: center; cursor: pointer; transition: 0.2s; }
.fx-rate-badge:hover { transform: scale(1.05); background: var(--gold-faint); }
.fx-info { display: flex; justify-content: space-between; font-size: 12px; color: var(--text-muted); margin-top: 5px; padding: 0 5px; }
.fx-type-switch { display: flex; background: rgba(0,0,0,0.2); border-radius: 50px; padding: 4px; border: 1px solid var(--gold-border); margin-bottom: 15px; }
.fx-type-opt { flex: 1; text-align: center; padding: 8px; border-radius: 40px; cursor: pointer; font-size: 13px; font-weight: bold; color: var(--text-muted); transition: 0.3s; }
.fx-type-opt.active.sell { background: var(--danger); color: white; box-shadow: 0 4px 10px rgba(255,82,82,0.3); }
.fx-type-opt.active.buy { background: var(--success); color: white; box-shadow: 0 4px 10px rgba(0,230,118,0.3); }
table { width: 100%; border-collapse: separate; border-spacing: 0 0; font-size: 14px; border: 1px solid var(--gold-border); border-radius: 8px; overflow: hidden; }
th { background: var(--gold-faint); color: var(--gold-primary); padding: 12px; border-bottom: 1px solid var(--gold-border); font-weight: 800; }
html[dir="rtl"] th { text-align: right; border-left: 1px solid var(--gold-border); }
html[dir="ltr"] th { text-align: left; border-right: 1px solid var(--gold-border); }
td { padding: 12px; background: rgba(0,0,0,0.02); border-bottom: 1px solid var(--gold-border); color: var(--text-main); font-weight: 500; }
html[dir="rtl"] td { border-left: 1px solid var(--gold-border); }
html[dir="ltr"] td { border-right: 1px solid var(--gold-border); }
tr:last-child td { border-bottom: none; }
html[dir="rtl"] th:last-child, html[dir="rtl"] td:last-child { border-left: none; }
html[dir="ltr"] th:last-child, html[dir="ltr"] td:last-child { border-right: none; }
.badge { padding: 4px 8px; border-radius: 20px; font-size: 12px; font-weight: bold; border: 1px solid var(--gold-border); }
.text-green { color: var(--success) !important; font-weight: bold; dir: ltr; }
.text-red { color: var(--danger) !important; font-weight: bold; dir: ltr; }
.modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; display: none; align-items: center; justify-content: center; backdrop-filter: blur(8px); }
.modal-content { position: relative; background: var(--bg-body); border: 1px solid var(--gold-primary); padding: 30px; border-radius: 20px; width: 90%; max-width: 650px; box-shadow: 0 20px 60px rgba(0,0,0,0.5); max-height: 90vh; overflow-y: auto; color: var(--text-main); }
.close-icon { position: absolute; top: 20px; font-size: 24px; font-weight: bold; color: var(--danger); cursor: pointer; transition: transform 0.2s; z-index: 10; }
html[dir="rtl"] .close-icon { left: 20px; }
html[dir="ltr"] .close-icon { right: 20px; }
.close-icon:hover { transform: scale(1.2); }
.account-list-item { display: flex; justify-content: space-between; align-items: center; padding: 15px; border-bottom: 1px solid var(--gold-border); transition: 0.2s; cursor: pointer; background: rgba(0,0,0,0.1); border-radius: 8px; margin-bottom: 5px; }
.account-list-item:hover { background: var(--gold-faint); transform: translateX(5px); }
html[dir="rtl"] .account-list-item:hover { transform: translateX(-5px); }
.search-sticky { position: sticky; top: 0; background: var(--bg-body); z-index: 5; padding-bottom: 10px; border-bottom: 2px solid var(--gold-primary); margin-bottom: 15px; }
.stat-box { background: linear-gradient(to bottom right, var(--gold-faint), rgba(0,0,0,0.02)); padding: 15px; border-radius: 20px; border: 1px solid var(--gold-border); text-align: center; box-shadow: 0 4px 8px rgba(0,0,0,0.05); }
.stat-val { font-size: 26px; font-weight: 900; margin-top: 8px; direction: ltr; color: var(--gold-primary); letter-spacing: 0.5px; }
.profit-section { background: linear-gradient(90deg, #0f2027, #203a43, #2c5364); color: white; padding: 20px; border-radius: 20px; margin-bottom: 20px; display: flex; justify-content: space-around; border: 2px solid var(--gold-primary); box-shadow: 0 0 15px rgba(0,0,0,0.2); }
.theme-switch { position: absolute; top: 20px; cursor: pointer; font-size: 22px; background: var(--bg-card); padding: 12px; border-radius: 50%; border: 1px solid var(--gold-border); color: var(--gold-primary); box-shadow: 0 4px 10px rgba(0,0,0,0.1); z-index: 100; transition: 0.3s; }
html[dir="rtl"] .theme-switch { left: 20px; }
html[dir="ltr"] .theme-switch { right: 20px; }
.theme-switch:hover { transform: rotate(15deg) scale(1.1); background: var(--gold-faint); }
.radio-group { display: flex; gap: 10px; margin-bottom: 15px; }
.radio-label { flex: 1; text-align: center; padding: 10px; border: 1px solid var(--gold-primary); border-radius: var(--radius); cursor: pointer; opacity: 0.7; color: var(--gold-primary); font-weight: bold; }
.radio-label.active { background: var(--gold-primary); color: #fff; opacity: 1; font-weight: 900; box-shadow: 0 0 15px var(--gold-shadow); }
#printHeaderGlobal { display: none; }
@media print {
    body { background: white !important; color: black !important; display: block !important; height: auto !important; }
    .sidebar, .no-print, .theme-switch, .header-bar .btn, #loginPage { display: none !important; }
    .content { padding: 0 !important; margin: 0 !important; background: none !important; width: 100% !important; overflow: visible !important; }
    .card { border: none !important; box-shadow: none !important; padding: 0 !important; background: white !important; color: black !important; margin-bottom: 20px !important; }
    .card-header { color: black !important; border-bottom: 2px solid black !important; }
    table { width: 100% !important; border-collapse: collapse !important; font-size: 10pt !important; border: 1px solid #000 !important; font-family: 'Vazirmatn', sans-serif !important; }
    th, td { border: 1px solid #000 !important; padding: 5px !important; color: black !important; background: transparent !important; }
    html[dir="rtl"] th, html[dir="rtl"] td { text-align: right !important; }
    html[dir="ltr"] th, html[dir="ltr"] td { text-align: left !important; }
    .stat-box { border: 1px solid #000 !important; color: black !important; page-break-inside: avoid; }
    .stat-val { color: black !important; text-shadow: none !important; }
    .input, input, select { border: none !important; background: transparent !important; color: black !important; padding: 0 !important; margin: 0 !important; height: auto !important; }
    ::-webkit-scrollbar { display: none; }
    #printHeaderGlobal { display: block !important; margin-bottom: 20px; }
}
</style>
</head>
<body>
<div id="printHeaderGlobal"></div>
<div class="theme-switch no-print" onclick="toggleTheme()" title="Theme/ØªÙ…">ğŸŒ“</div>

<div id="loginPage">
    <div class="login-box">
        <h2 class="login-header-text" data-i18n="app_title">ØµØ±Ø§ÙÛŒ Ù‡Ø±Ø§ØªÛŒâ€ŒÙ‡Ø§</h2>
        <span class="login-sub-text" data-i18n="company_subtitle">Ø´Ø±Ú©Øª ØµØ±Ø§ÙÛŒ Ùˆ Ø®Ø¯Ù…Ø§Øª Ù¾ÙˆÙ„ÛŒ Ù‡Ø±Ø§ØªÛŒÙ‡Ø§</span>
        <br><br>
        <input type="text" id="loginUser" class="input login-input" placeholder="Username / Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ" autocomplete="off" autofocus>
        <input type="password" id="loginPass" class="input login-input" placeholder="Password / Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±">
        <button class="btn btn-gold" style="width:100%; padding: 15px; font-size: 16px; margin-top: 10px;" onclick="auth()" data-i18n="login_btn">ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ø³ÛŒØ³ØªÙ… (Enter)</button>
        
        <div class="lang-select-container">
            <button class="lang-btn active" onclick="setLanguage('fa')" id="btn-lang-fa">ÙØ§Ø±Ø³ÛŒ</button>
            <button class="lang-btn" onclick="setLanguage('en')" id="btn-lang-en">English</button>
            <button class="lang-btn" onclick="setLanguage('tr')" id="btn-lang-tr">TÃ¼rkÃ§e</button>
            <button class="lang-btn" onclick="setLanguage('ar')" id="btn-lang-ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</button>
        </div>

        <p id="loginErr" style="color:var(--danger); margin-top:15px; display:none; font-size:12px" data-i18n="login_error">Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø§Ø´ØªØ¨Ø§Ù‡ Ø§Ø³Øª</p>
        <div id="loadingMsg" data-i18n="loading_db">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù¾Ø§ÛŒÚ¯Ø§Ù‡ Ø¯Ø§Ø¯Ù‡ Ø§Ù…Ù†ÛŒØªÛŒ...</div>
    </div>
</div>
<div id="mainApp">
    <div class="sidebar">
        <div style="text-align:center; margin-bottom:30px; border-bottom:1px solid var(--gold-border); padding-bottom:20px">
            <h2 style="color:var(--gold-primary); text-shadow: 0 0 10px var(--gold-shadow); font-weight: 900; font-size: 24px;" data-i18n="app_title">Ø´Ø±Ú©Øª Ù‡Ø±Ø§ØªÛŒâ€ŒÙ‡Ø§</h2>
            <div style="font-size:12px; margin-top:5px; color: var(--gold-primary); opacity:0.8; font-weight:500;" id="sidebarUserInfo"></div>
        </div>
        
        <button class="nav-btn active admin-only-btn" onclick="go('dashboard')" id="nav-dashboard">
            <span data-i18n="nav_dashboard">ğŸ“Š Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ (F1)</span>
        </button>
        
        <button class="nav-btn" onclick="go('hawala')" id="nav-hawala">
            <span data-i18n="nav_hawala">âœˆï¸ Ø­ÙˆØ§Ù„Ù‡â€ŒØ¬Ø§Øª (F2)</span>
        </button>
        
        <button class="nav-btn" onclick="go('accounts')" id="nav-accounts">
            <span data-i18n="nav_accounts">ğŸ‘¥ Ø­Ø³Ø§Ø¨ Ù…Ø´ØªØ±ÛŒØ§Ù† (F3)</span>
        </button>
        
        <button class="nav-btn" onclick="go('ttPage')" id="nav-tt">
            <span data-i18n="nav_tt">ğŸŒ Ø§Ù†ØªÙ‚Ø§Ù„ Ø§Ø±Ø² (TT) (F6)</span>
        </button>
        
        <button class="nav-btn" onclick="go('exchange')" id="nav-exchange">
            <span data-i18n="nav_exchange">ğŸ’± Ø®Ø±ÛŒØ¯ Ùˆ ÙØ±ÙˆØ´ (FX) (F4)</span>
        </button>
        
        <button class="nav-btn" onclick="go('cryptoFX')" id="nav-crypto">
            <span data-i18n="nav_crypto">ğŸª™ Ø§Ø±Ø² Ø¯ÛŒØ¬ÛŒØªØ§Ù„ (Crypto)</span>
        </button>
        
<button class="nav-btn admin-only-btn" onclick="go('analysis')" id="nav-analysis">
            <span data-i18n="nav_analysis">ğŸ§® Ø¢Ù†Ø§Ù„ÛŒØ² Ø³Ø±Ù…Ø§ÛŒÙ‡ (F7)</span>
        </button>

<button class="nav-btn admin-only-btn" onclick="go('employees')" id="nav-employees">
    <span>ğŸ‘” Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø§Ø±Ù…Ù†Ø¯Ø§Ù†</span>
</button>

        <button class="nav-btn admin-only-btn" onclick="go('reports')" id="nav-reports">
            <span data-i18n="nav_reports">ğŸ“‘ Ú¯Ø²Ø§Ø±Ø´Ø§Øª (Logs)</span>
        </button>
        
        <div style="margin-top:auto; border-top:1px solid var(--gold-border); padding-top:20px">
            <button class="nav-btn" onclick="openSettings()">
                <span data-i18n="nav_settings">âš™ï¸ ØªÙ†Ø¸ÛŒÙ…Ø§Øª</span>
            </button>
            <button class="nav-btn" style="color:var(--danger); border-color:rgba(255, 82, 82, 0.3)" onclick="logout()">
                <span data-i18n="nav_logout">ğŸšª Ø®Ø±ÙˆØ¬ Ø§Ù…Ù†</span>
            </button>
        </div>
    </div>
<div class="content">
        <div class="header-bar" style="display:flex; justify-content:space-between; margin-bottom:30px; align-items: center;">
            <h2 id="pageTitle" style="border-right:5px solid var(--gold-primary); padding-right:20px; color:var(--gold-primary); font-size: 30px; font-weight: 900;" data-i18n="nav_dashboard">Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯</h2>
            <div style="font-size:14px; background:var(--bg-card); padding:10px 20px; border-radius:50px; border:1px solid var(--gold-primary); color: var(--gold-primary); box-shadow: 0 5px 15px rgba(0,0,0,0.05); font-weight: bold; margin-left: 60px;">
                ğŸ“… <span id="displayDate"></span>
            </div>
        </div>

        <div id="dashboard" class="page active admin-only-view">
            <div class="profit-section">
                <div class="profit-details" style="min-width: 30%; text-align: center;">
                    <div style="font-size:13px; opacity:0.8; border-bottom: 1px solid var(--gold-border); padding-bottom:10px; margin-bottom:10px; color: var(--gold-primary);" data-i18n="lbl_initial_capital">Ø³Ø±Ù…Ø§ÛŒÙ‡ Ø§ÙˆÙ„ÛŒÙ‡ Ø«Ø¨Øª Ø´Ø¯Ù‡</div>
                    <div id="dispInitialCap" style="font-size:20px; font-weight:800; direction:ltr; display:flex; flex-wrap:wrap; justify-content:center; gap: 15px;">0</div>
                </div>
                
                <div style="border-right:1px solid var(--gold-border); margin:0 15px"></div>

                <div class="profit-details" style="min-width: 30%; text-align: center;">
                    <div style="font-size:13px; opacity:0.8; border-bottom: 1px solid var(--gold-border); padding-bottom:10px; margin-bottom:10px; color: var(--text-main);">Ø³ÙˆØ¯ Ø§Ù…Ø±ÙˆØ² (Today)</div>
                    <div id="dispDailyProfit" style="font-size:20px; font-weight:900; color:var(--success)">0</div>
                </div>

                <div style="border-right:1px solid var(--gold-border); margin:0 15px"></div>

                <div class="profit-details" style="min-width: 30%; text-align: center;">
                    <div style="font-size:13px; opacity:0.8; border-bottom: 1px solid var(--gold-border); padding-bottom:10px; margin-bottom:10px; color: var(--gold-primary);" data-i18n="lbl_profit_loss">Ø³ÙˆØ¯ Ú©Ù„ (Total/Yearly)</div>
                    <div id="dispProfit" style="font-size:20px; font-weight:900; color:var(--success)">0</div>
                </div>
            </div>

            <div style="text-align: right; color: var(--gold-primary); margin-bottom: 15px; font-size: 18px; font-weight: 800; border-bottom: 2px solid var(--gold-faint); display:inline-block; padding-bottom:5px;" data-i18n="lbl_cash_balance">Ù…ÙˆØ¬ÙˆØ¯ÛŒ ÙÛŒØ²ÛŒÚ©ÛŒ ØµÙ†Ø¯ÙˆÙ‚ (Ø®Ø²Ø§Ù†Ù‡)</div>
            <div class="grid-4" id="cashStats" style="margin-bottom: 30px;"></div>

            <div style="text-align: right; color: #42a5f5; margin-bottom: 15px; font-size: 18px; font-weight: 800; border-bottom: 2px solid rgba(66, 165, 245, 0.3); display:inline-block; padding-bottom:5px;" data-i18n="lbl_crypto_assets">Ø¯Ø§Ø±Ø§ÛŒÛŒâ€ŒÙ‡Ø§ÛŒ Ø¯ÛŒØ¬ÛŒØªØ§Ù„ (Crypto Assets)</div>
            <div class="grid-4" id="cryptoStats" style="margin-bottom: 30px;"></div>
<div class="card">
                <div class="card-header">
                    <span data-i18n="lbl_city_balance">Ø¨Ø§Ù„Ø§Ù†Ø³ Ú©ØªØ§Ø¨ Ø´Ù‡Ø±Ù‡Ø§ (Ø¨Ø¯Ù‡Ú©Ø§Ø±ÛŒ/Ø¨Ø³ØªØ§Ù†Ú©Ø§Ø±ÛŒ Ù†Ù…Ø§ÛŒÙ†Ø¯Ú¯Ø§Ù†)</span>
                    <button class="btn btn-outline" style="font-size:11px" onclick="renderDashboard()">
                        <span data-i18n="btn_refresh">ğŸ”„ Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ</span>
                    </button>
                </div>
                <div class="grid-3" id="cityStats"></div>
                <p style="font-size:11px; color:var(--text-muted); margin-top:15px; border-top: 1px dashed var(--gold-primary); padding-top: 10px;" data-i18n="msg_city_balance_hint">* Ø§Ø¹Ø¯Ø§Ø¯ Ù…Ø«Ø¨Øª (Ø³Ø¨Ø²): Ù†Ù…Ø§ÛŒÙ†Ø¯Ù‡ Ø¨Ù‡ Ù…Ø§ Ø¨Ø¯Ù‡Ú©Ø§Ø± Ø§Ø³Øª. Ø§Ø¹Ø¯Ø§Ø¯ Ù…Ù†ÙÛŒ (Ù‚Ø±Ù…Ø²): Ù…Ø§ Ø¨Ù‡ Ù†Ù…Ø§ÛŒÙ†Ø¯Ù‡ Ø¨Ø¯Ù‡Ú©Ø§Ø±ÛŒÙ….</p>
            </div>
            
            <div class="card">
                <div class="card-header"><span data-i18n="lbl_total_commissions">Ù…Ø¬Ù…ÙˆØ¹ Ú©Ù…ÛŒØ´Ù†â€ŒÙ‡Ø§ÛŒ Ø­ÙˆØ§Ù„Ù‡ (Ø³ÙˆØ¯ Ø®Ø§Ù„Øµ)</span></div>
                <div class="grid-4" id="cityCommissions"></div>
            </div>
        </div>
<div id="hawala" class="page">
            <div class="card">
                <div class="grid-2" style="align-items:center">
                    <h3 style="color:var(--gold-primary); font-weight:800" data-i18n="header_hawala_manage">Ù…Ø¯ÛŒØ±ÛŒØª Ø­ÙˆØ§Ù„Ù‡â€ŒØ¬Ø§Øª</h3>
                    <div style="text-align:left">
                        <button class="btn btn-gold" onclick="openModal('modalNewHawala')" id="btnNewHawala">
                            <span data-i18n="btn_new_hawala">â• Ø«Ø¨Øª Ø­ÙˆØ§Ù„Ù‡ Ø¬Ø¯ÛŒØ¯ (F9)</span>
                        </button>
                    </div>
                </div>
                <div class="grid-4" style="margin-top:25px">
                    <div>
                        <label class="label" data-i18n="lbl_filter_city">ÙÛŒÙ„ØªØ± Ø´Ù‡Ø±</label>
                        <select id="filterHCity" class="input" onchange="filterHawala()"></select>
                    </div>
                    <div>
                        <label class="label" data-i18n="lbl_type">Ù†ÙˆØ¹</label>
                        <select id="filterHType" class="input" onchange="filterHawala()">
                            <option value="All" data-i18n="opt_all">Ù‡Ù…Ù‡</option>
                            <option value="Outgoing" data-i18n="opt_outgoing">Ø§Ø±Ø³Ø§Ù„ÛŒ (Out)</option>
                            <option value="Incoming" data-i18n="opt_incoming">Ø¯Ø±ÛŒØ§ÙØªÛŒ (In)</option>
                        </select>
                    </div>
                    <div>
                        <label class="label" data-i18n="lbl_status">ÙˆØ¶Ø¹ÛŒØª</label>
                        <select id="filterHStatus" class="input" onchange="filterHawala()">
                            <option value="All" data-i18n="opt_all">Ù‡Ù…Ù‡</option>
                            <option value="Pending" data-i18n="opt_pending">Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± Ø§Ø¬Ø±Ø§</option>
                            <option value="Done" data-i18n="opt_done">Ø§Ø¬Ø±Ø§/ØªØ³ÙˆÛŒÙ‡ Ø´Ø¯Ù‡</option>
                        </select>
                    </div>
                    <div style="padding-top:25px; display:flex; gap:10px">
                        <button class="btn btn-outline" style="font-size:12px; flex:1" onclick="exportHawalaToExcel()">
                            <span data-i18n="btn_excel">ğŸ“Š Ø§Ú©Ø³Ù„ Ø¹Ø§Ù„ÛŒ</span>
                        </button>
                        <button class="btn btn-outline" style="font-size:12px; flex:1" onclick="printHawalaList()">
                            <span data-i18n="btn_print_book">ğŸ–¨ Ù¾Ø±ÛŒÙ†Øª Ú©ØªØ§Ø¨</span>
                        </button>
                    </div>
                </div>
            </div>
<div class="card table-container" style="overflow-x:auto;">
                <table>
                    <thead>
                        <tr>
                            <th data-i18n="th_hawala_no">Ù†Ù…Ø¨Ø± Ø­ÙˆØ§Ù„Ù‡</th>
                            <th data-i18n="th_type">Ù†ÙˆØ¹</th>
                            <th data-i18n="th_city_book">Ø´Ù‡Ø± / Ú©ØªØ§Ø¨</th>
                            <th data-i18n="th_amount">Ù…Ø¨Ù„Øº</th>
                            <th data-i18n="th_commission">Ú©Ù…ÛŒØ´Ù†</th>
                            <th data-i18n="th_reg_date">ØªØ§Ø±ÛŒØ® Ø«Ø¨Øª</th>
                            <th data-i18n="th_exec_date">ØªØ§Ø±ÛŒØ® Ø§Ø¬Ø±Ø§</th>
                            <th data-i18n="th_status">ÙˆØ¶Ø¹ÛŒØª</th>
                            <th style="min-width: 200px;" data-i18n="th_ops">Ø¹Ù…Ù„ÛŒØ§Øª</th>
                        </tr>
                    </thead>
                    <tbody id="hawalaBody"></tbody>
                </table>
            </div>
        </div>
<div id="accounts" class="page">
            <div class="card">
                <div class="card-header" data-i18n="header_accounts_manage">Ù…Ø¯ÛŒØ±ÛŒØª Ø­Ø³Ø§Ø¨ Ù…Ø´ØªØ±ÛŒØ§Ù†</div>
                <div class="grid-2">
                    <div>
                        <label class="label" data-i18n="lbl_search_customer">Ø¬Ø³ØªØ¬ÙˆÛŒ Ù…Ø´ØªØ±ÛŒ</label>
                        <select id="selCustomer" class="input" onchange="loadCustomerLedger()"></select>
                    </div>
                    <div style="text-align:left; padding-top:25px; display: flex; gap: 5px; flex-wrap: wrap; justify-content: flex-end;">
                        <button class="btn btn-green" onclick="openModal('modalNewCust')" id="btnNewCust">
                            <span data-i18n="btn_new_customer">â• Ù…Ø´ØªØ±ÛŒ Ø¬Ø¯ÛŒØ¯ (F9)</span>
                        </button>
                        <button class="btn btn-blue" onclick="openModal('modalTx')">
                            <span data-i18n="btn_deposit_withdraw">ğŸ’° ÙˆØ§Ø±ÛŒØ²/Ø¨Ø±Ø¯Ø§Ø´Øª</span>
                        </button>
                        <button class="btn btn-indigo" onclick="openModalClientTransfer()">
                            <span data-i18n="btn_transfer">ğŸ”„ Ø§Ù†ØªÙ‚Ø§Ù„ Ø­Ø³Ø§Ø¨</span>
                        </button>
                        <button class="btn btn-gold admin-only-btn" onclick="openAllAccountsModal()">
                            <span data-i18n="btn_all_accounts">ğŸ“‹ ÙˆØ¶Ø¹ÛŒØª Ú©Ù„ Ø­Ø³Ø§Ø¨â€ŒÙ‡Ø§</span>
                        </button>
                    </div>
                </div>
            </div>
<div class="card" id="ledgerCard" style="display:none">
                <div class="card-header">
                    <span>
                        <span data-i18n="lbl_statement">ØµÙˆØ±Øªâ€ŒØ­Ø³Ø§Ø¨:</span> 
                        <b id="ledgerName" style="color:var(--text-main); text-shadow: 0 0 10px var(--gold-faint);"></b> 
                        <span id="ledgerPhone" style="font-size:13px; color:var(--text-muted); margin-right:10px; font-weight:400;"></span>
                    </span>
                    <div style="display:flex; gap:5px; align-items:center; flex-wrap:wrap;">
                        <span id="ledgerFinalSum" dir="ltr" style="font-size:15px; margin-left:10px; font-weight: 900;"></span>
                        <button class="btn btn-outline btn-sm" onclick="openEditCustomerModal()">
                            <span data-i18n="btn_edit">âœï¸ ÙˆÛŒØ±Ø§ÛŒØ´</span>
                        </button>
                        <button class="btn btn-red btn-sm" onclick="deleteCustomer()">
                            <span data-i18n="btn_delete">ğŸ—‘ Ø­Ø°Ù</span>
                        </button>
                        <button class="btn btn-outline btn-sm no-print" onclick="exportLedgerToExcel()">
                            <span data-i18n="btn_excel">ğŸ“Š Ø§Ú©Ø³Ù„</span>
                        </button>
                        <button class="btn btn-outline btn-sm no-print" onclick="printLedger()">
                            <span data-i18n="btn_print">ğŸ–¨ Ù¾Ø±ÛŒÙ†Øª</span>
                        </button>
                    </div>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th data-i18n="th_date">ØªØ§Ø±ÛŒØ®</th>
                                <th data-i18n="th_desc">Ø´Ø±Ø­</th>
                                <th data-i18n="th_currency">Ø§Ø±Ø²</th>
                                <th data-i18n="th_debit">Ø¨Ø¯Ù‡Ú©Ø§Ø±</th>
                                <th data-i18n="th_credit">Ø¨Ø³ØªØ§Ù†Ú©Ø§Ø±</th>
                                <th data-i18n="th_balance">Ù…Ø§Ù†Ø¯Ù‡ (ØªØ´Ø®ÛŒØµ)</th>
                                <th class="no-print" data-i18n="th_ops">Ø¹Ù…Ù„ÛŒØ§Øª</th>
                            </tr>
                        </thead>
                        <tbody id="ledgerBody"></tbody>
                    </table>
                </div>
            </div>
        </div>
<div id="ttPage" class="page">
            <div class="card" style="max-width:850px; margin:0 auto">
                <div class="card-header">
                    <span data-i18n="header_tt_app">Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø­ÙˆØ§Ù„Ù‡ Ø§Ø±Ø²ÛŒ (TT Application)</span>
                </div>
                <div class="radio-group">
                    <div id="ttOptInternal" class="radio-label active" onclick="setTTType('internal')" tabindex="0">
                        <span data-i18n="opt_internal_cust">Ù…Ø´ØªØ±ÛŒ Ø¯Ø§Ø®Ù„ÛŒ (Ø­Ø³Ø§Ø¨Ø¯Ø§Ø±)</span>
                    </div>
                    <div id="ttOptExternal" class="radio-label" onclick="setTTType('external')" tabindex="0">
                        <span data-i18n="opt_external_cust">Ù…Ø´ØªØ±ÛŒ Ø®Ø§Ø±Ø¬ÛŒ (Ù†Ù‚Ø¯ÛŒ)</span>
                    </div>
                </div>
                <div class="grid-2" style="background:rgba(212,175,55,0.05); padding:15px; border-radius:12px; margin-bottom:20px; border:1px solid var(--gold-border)">
                    <div id="ttInternalSec">
                         <label class="label" data-i18n="lbl_select_account">Ø§Ù†ØªØ®Ø§Ø¨ Ø­Ø³Ø§Ø¨ Ù…Ø´ØªØ±ÛŒ (Ø¨Ø±Ø¯Ø§Ø´Øª Ø§Ø² Ø­Ø³Ø§Ø¨)</label>
                         <select id="ttCustomer" class="input"></select>
                    </div>
                    <div id="ttExternalSec" style="display:none">
                        <label class="label" data-i18n="lbl_payer_name">Ù†Ø§Ù… Ù…Ø´ØªØ±ÛŒ (Ù¾Ø±Ø¯Ø§Ø®Øª Ù†Ù‚Ø¯ÛŒ)</label>
                        <input type="text" id="ttExtName" class="input" placeholder="...">
                        <label class="label" style="margin-top:5px" data-i18n="lbl_phone">ØªÙ„ÙÙ† ØªÙ…Ø§Ø³</label>
                        <input type="text" id="ttExtPhone" class="input" placeholder="07...">
                    </div>
                    <div>
                        <label class="label" data-i18n="lbl_amount">Ù…Ø¨Ù„Øº Ø­ÙˆØ§Ù„Ù‡</label>
                        <div style="display:flex; gap:5px">
                            <input type="number" id="ttAmt" class="input" placeholder="0.00" oninput="updateTTAutoWords()">
                            <select id="ttCurr" class="input" style="width:100px"></select>
                        </div>
                        <label class="label">Amount in Words (Auto - English)</label>
                        <input type="text" id="ttAmtWords" class="input" placeholder="Amount in letters...">
                    </div>
                </div>
                <hr style="margin:20px 0; border:0; border-top:1px dashed var(--gold-primary)">
                <h4 style="color:var(--gold-primary); margin-bottom:15px; font-weight:800;" data-i18n="header_beneficiary">Ù…Ø´Ø®ØµØ§Øª Ø°ÛŒÙ†ÙØ¹ (Beneficiary)</h4>
                <div class="grid-2">
                     <div>
                        <label class="label" data-i18n="lbl_ben_name">Ù†Ø§Ù… Ø°ÛŒÙ†ÙØ¹ (ÙØ§Ø±Ø³ÛŒ)</label>
                        <input type="text" id="ttBenName" class="input">
                     </div>
                     <div>
                        <label class="label">Beneficiary Name (English)</label>
                        <input type="text" id="ttBenNameEn" class="input" style="text-align:left; direction:ltr" placeholder="Full Name in English">
                     </div>
                </div>
                <div class="grid-2">
                     <div><label class="label">Ú©Ø´ÙˆØ± (Country)</label><input type="text" id="ttCountry" class="input"></div>
                     <div><label class="label">Ø´Ù‡Ø± (City)</label><input type="text" id="ttCityDest" class="input"></div>
                </div>
                <label class="label">Ø¢Ø¯Ø±Ø³ (Address)</label><input type="text" id="ttAddress" class="input">
                <div class="grid-2" style="margin-top:10px">
                     <div><label class="label">Ø¨Ø§Ù†Ú© Ù…Ù‚ØµØ¯ (Dest. Bank)</label><input type="text" id="ttDestBank" class="input"></div>
                     <div><label class="label">Ø³ÙˆØ¦ÛŒÙØª Ú©Ø¯ (Swift Code)</label><input type="text" id="ttSwift" class="input" style="text-transform:uppercase"></div>
                </div>
                <label class="label">Ø´Ù…Ø§Ø±Ù‡ Ø­Ø³Ø§Ø¨ / IBAN</label><input type="text" id="ttIban" class="input" style="direction:ltr; text-align:left">
                <div class="grid-2" style="margin-top:10px">
                     <div><label class="label">Ø¨Ø§Ù†Ú© Ú©Ø§Ø±Ú¯Ø²Ø§Ø± (Intermediary Bank)</label><input type="text" id="ttInterBank" class="input"></div>
                     <div><label class="label">Ø³ÙˆØ¦ÛŒÙØª Ú©Ø§Ø±Ú¯Ø²Ø§Ø± (Intermediary Swift)</label><input type="text" id="ttInterSwift" class="input"></div>
                </div>
                <label class="label">Ø±ÙØ±Ù†Ø³ (Reference)</label><input type="text" id="ttRef" class="input">
                <label class="label" data-i18n="lbl_desc">ØªÙˆØ¶ÛŒØ­Ø§Øª ØªÚ©Ù…ÛŒÙ„ÛŒ</label><input type="text" id="ttDesc" class="input">
                <div style="margin-top:25px; display:flex; gap:10px">
                    <button class="btn btn-purple" style="flex:2; padding:15px" onclick="submitNewTT()">
                        <span data-i18n="btn_submit_tt">Ø«Ø¨Øª Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ùˆ Ø¯Ø±ÛŒØ§ÙØª ÙˆØ¬Ù‡ (F10)</span>
                    </button>
                    <button class="btn btn-outline" style="flex:1" onclick="printCurrentTTForm()">
                        <span data-i18n="btn_print_form">ğŸ–¨ Ú†Ø§Ù¾ ÙØ±Ù… Ø±Ø³Ù…ÛŒ</span>
                    </button>
                </div>
            </div>
        </div>
<div id="cryptoFX" class="page">
            <div class="card" style="max-width:750px; margin:0 auto">
                <div class="card-header">
                    <span data-i18n="header_crypto_deal">Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ø±Ø² Ø¯ÛŒØ¬ÛŒØªØ§Ù„ (Crypto)</span>
                    <button class="btn btn-outline" style="font-size:12px;" onclick="printCryptoFx()">
                        <span data-i18n="btn_print_receipt">ğŸ–¨ Ú†Ø§Ù¾ Ø±Ø³ÛŒØ¯</span>
                    </button>
                </div>
                
                <div class="radio-group">
                    <div id="cryptoOptExternal" class="radio-label active" onclick="setCryptoCustType('external')" tabindex="0">
                        <span data-i18n="opt_external_cust">Ù…Ø´ØªØ±ÛŒ Ø¢Ø²Ø§Ø¯ (Ù†Ù‚Ø¯ÛŒ)</span>
                    </div>
                    <div id="cryptoOptInternal" class="radio-label" onclick="setCryptoCustType('internal')" tabindex="0">
                        <span data-i18n="opt_internal_cust">Ù…Ø´ØªØ±ÛŒ Ø­Ø³Ø§Ø¨â€ŒØ¯Ø§Ø±</span>
                    </div>
                </div>
                <div id="cryptoInternalSec" style="display:none; margin-bottom:15px; padding:10px; border:1px solid var(--gold-border); border-radius:12px;">
                    <label class="label" data-i18n="lbl_select_customer">Ø§Ù†ØªØ®Ø§Ø¨ Ù…Ø´ØªØ±ÛŒ</label>
                    <select id="cryptoCustomer" class="input" style="margin-bottom:0"></select>
                </div>

                <div class="grid-2">
                    <div style="background:rgba(212,175,55,0.05); padding:15px; border-radius:15px; border:1px solid var(--gold-primary)">
                        <label class="label" style="font-weight:900; color:var(--text-main)" data-i18n="lbl_deal_type">Ù†ÙˆØ¹ Ù…Ø¹Ø§Ù…Ù„Ù‡</label>
                        <select id="cryptoTxType" class="input" style="margin-bottom:0">
                            <option value="Buy" data-i18n="opt_buy">Ø®Ø±ÛŒØ¯ (Ù¾Ø±Ø¯Ø§Ø®Øª Ù¾ÙˆÙ„)</option>
                            <option value="Sell" data-i18n="opt_sell">ÙØ±ÙˆØ´ (Ø¯Ø±ÛŒØ§ÙØª Ù¾ÙˆÙ„)</option>
                        </select>
                    </div>
                    <div>
                        <label class="label" data-i18n="lbl_desc">ØªÙˆØ¶ÛŒØ­Ø§Øª</label>
                        <input type="text" id="cryptoDesc" class="input" placeholder="..." style="margin-bottom:0">
                    </div>
                </div>
                <hr style="margin:20px 0; border:0; border-top:1px dashed var(--gold-primary)">
                <div class="grid-2">
                    <div>
                        <label class="label" data-i18n="lbl_crypto_name">Ù†Ø§Ù… Ø§Ø±Ø² (USDT)</label>
                        <input type="text" id="cryptoName" class="input" placeholder="USDT, BTC...">
                    </div>
                    <div>
                        <label class="label" data-i18n="lbl_volume">Ù…Ù‚Ø¯Ø§Ø± (Volume)</label>
                        <input type="number" id="cryptoAmt" class="input" placeholder="0.00">
                    </div>
                </div>
                <div class="grid-2">
                    <div>
                        <label class="label" data-i18n="lbl_payment_curr">Ù†ÙˆØ¹ Ø§Ø±Ø² Ù¾Ø±Ø¯Ø§Ø®ØªÛŒ/Ø¯Ø±ÛŒØ§ÙØªÛŒ</label>
                        <select class="input" id="cryptoCurr"></select>
                    </div>
                    <div>
                        <label class="label" data-i18n="lbl_total_fiat">Ù…Ø¨Ù„Øº Ú©Ù„ (Total Fiat)</label>
                        <input type="number" id="fiatAmt" class="input" placeholder="0">
                    </div>
                </div>
                <div style="background:rgba(212,175,55,0.05); padding:15px; border-radius:15px; border:1px solid var(--gold-border); margin-top: 15px;">
                    <label class="label" style="color:var(--text-muted)" data-i18n="lbl_cost_basis">Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø³ÙˆØ¯ (ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ ÙØ±ÙˆØ´): Ù‚ÛŒÙ…Øª Ø®Ø±ÛŒØ¯ Ø§ÙˆÙ„ÛŒÙ‡ Ú†Ù‚Ø¯Ø± Ø¨ÙˆØ¯Ù‡ØŸ</label>
                    <input type="number" id="cryptoCostBasis" class="input" placeholder="" style="margin-bottom: 0;">
                </div>
                <button class="btn btn-blue" style="width:100%; margin-top:25px; padding: 15px;" onclick="submitCryptoFx()">
                    <span data-i18n="btn_submit_deal">Ø«Ø¨Øª Ù†Ù‡Ø§ÛŒÛŒ Ù…Ø¹Ø§Ù…Ù„Ù‡ (F10)</span>
                </button>
            </div>
        </div>
<div id="exchange" class="page">
            <div class="card" style="max-width:800px; margin:0 auto">
                <div class="card-header">
                    <span data-i18n="header_fx_deal">Ù…Ø¹Ø§Ù…Ù„Ù‡ Ø§Ø±Ø²ÛŒ (FX Deal Ticket)</span>
                    <button class="btn btn-outline btn-sm" onclick="printExchangeReceipt()">
                        <span data-i18n="btn_print_receipt">ğŸ–¨ Ú†Ø§Ù¾ Ø±Ø³ÛŒØ¯</span>
                    </button>
                </div>

                <div class="radio-group">
                    <div id="exOptExternal" class="radio-label active" onclick="setExType('external')" tabindex="0" onkeypress="if(event.key==='Enter') this.click()">
                        <span data-i18n="opt_external_cust">Ù…Ø´ØªØ±ÛŒ Ø¢Ø²Ø§Ø¯ (Ù†Ù‚Ø¯ÛŒ)</span>
                    </div>
                    <div id="exOptInternal" class="radio-label" onclick="setExType('internal')" tabindex="0" onkeypress="if(event.key==='Enter') this.click()">
                        <span data-i18n="opt_internal_cust">Ù…Ø´ØªØ±ÛŒ Ø­Ø³Ø§Ø¨â€ŒØ¯Ø§Ø±</span>
                    </div>
                </div>

                <div id="exInternalSec" style="display:none; margin-bottom:15px; padding:10px; border:1px solid var(--gold-border); border-radius:12px;">
                    <label class="label" data-i18n="lbl_select_customer">Ø§Ù†ØªØ®Ø§Ø¨ Ù…Ø´ØªØ±ÛŒ</label>
                    <select id="exCustomer" class="input" style="margin-bottom:0"></select>
                </div>

                <div class="fx-container">
                    <div class="fx-type-switch">
                        <div id="btnFxBuy" class="fx-type-opt active buy" onclick="setFxDirection('Buy')" tabindex="0" onkeypress="if(event.key==='Enter') this.click()">
                            <span data-i18n="btn_fx_buy">Ø®Ø±ÛŒØ¯ (BUY)</span>
                        </div>
                        <div id="btnFxSell" class="fx-type-opt" onclick="setFxDirection('Sell')" tabindex="0" onkeypress="if(event.key==='Enter') this.click()">
                            <span data-i18n="btn_fx_sell">ÙØ±ÙˆØ´ (SELL)</span>
                        </div>
                    </div>

                    <div class="fx-box">
                        <span class="fx-box-label" data-i18n="lbl_volume">Ù…Ù‚Ø¯Ø§Ø± (Volume)</span>
                        <div class="fx-input-group">
                            <input type="number" id="fxBaseAmt" class="fx-amount" placeholder="1000" oninput="calcFx()">
                            <select id="fxBaseCurr" class="fx-currency" onchange="calcFx()"></select>
                        </div>
                    </div>

                    <div class="fx-rate-bar">
                        <div class="fx-rate-badge">
                            <span data-i18n="lbl_rate">Rate:</span>
                            <input type="number" id="fxRate" style="background:transparent; border:none; color:var(--gold-primary); font-weight:bold; width:80px; text-align:center;" value="1" oninput="calcFx()">
                        </div>
                        <div class="fx-rate-badge" onclick="toggleFxOperator()" title="Operator" tabindex="0" onkeypress="if(event.key==='Enter') this.click()">
                            <span id="fxOpDisplay">âœ–</span>
                        </div>
                    </div>

                    <div class="fx-box">
                        <span class="fx-box-label" data-i18n="lbl_total">Ù…Ø¨Ù„Øº Ù†Ù‡Ø§ÛŒÛŒ (Total)</span>
                        <div class="fx-input-group">
                            <input type="number" id="fxQuoteAmt" class="fx-amount" placeholder="0" readonly>
                            <select id="fxQuoteCurr" class="fx-currency" onchange="calcFx()"></select>
                        </div>
                    </div>
                    
                    <div class="fx-info">
                        <span id="fxDirText">---</span>
                        <span data-i18n="lbl_cash_balance_after">ØªØ±Ø§Ø² ØµÙ†Ø¯ÙˆÙ‚ Ù¾Ø³ Ø§Ø² Ø§Ù†Ø¬Ø§Ù…</span>
                    </div>
                </div>

                <div style="margin-top:15px">
                    <label class="label" data-i18n="lbl_desc_opt">ØªÙˆØ¶ÛŒØ­Ø§Øª (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)</label>
                    <input type="text" id="exDesc" class="input" placeholder="...">
                </div>

                <div style="margin-top:10px; padding:10px; background:rgba(255,255,255,0.05); border-radius:8px;">
                    <label class="label" style="font-weight:normal; opacity:0.8" data-i18n="lbl_cost_basis_fx">Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø³ÙˆØ¯ Ù„Ø­Ø¸Ù‡â€ŒØ§ÛŒ (Cost Basis)</label>
                    <div style="display:flex; gap:10px; align-items:center">
                        <input type="number" id="exCostBasis" class="input" placeholder="..." style="margin-bottom:0">
                        <span id="estimatedProfit" style="font-weight:bold; color:var(--success)">---</span>
                    </div>
                </div>

                <button class="btn btn-blue" style="width:100%; margin-top:20px; padding:15px; font-size:16px;" onclick="submitExchange()">
                    <span data-i18n="btn_submit_deal">Ø«Ø¨Øª Ù…Ø¹Ø§Ù…Ù„Ù‡ (Submit Deal) (F10)</span>
                </button>
            </div>
        </div>
<div id="analysis" class="page admin-only-view">
    <div class="card">
        <div class="card-header">
            <span>Ø¢Ù†Ø§Ù„ÛŒØ² Ø¯Ù‚ÛŒÙ‚ Ø³Ø±Ù…Ø§ÛŒÙ‡ (ØªØ¨Ø¯ÛŒÙ„ Ø¨Ù‡ Ø¯Ù„Ø§Ø±)</span>
            <button class="btn btn-gold" onclick="renderAnalysis()">
                <span>ğŸ”„ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…Ø¬Ø¯Ø¯</span>
            </button>
        </div>
        
        <div style="margin-bottom:20px; background:rgba(0,0,0,0.2); padding:15px; border-radius:10px; border:1px solid var(--gold-primary);">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <span style="font-size:18px; font-weight:bold; color:var(--text-main);">Ù…Ø¬Ù…ÙˆØ¹ Ú©Ù„ Ø³Ø±Ù…Ø§ÛŒÙ‡ Ø´Ù…Ø§ Ø¨Ù‡ Ø¯Ù„Ø§Ø±:</span>
                <span id="grandTotalUSD" style="font-size:24px; font-weight:900; color:var(--success); direction:ltr; text-shadow:0 0 10px rgba(0,230,118,0.5);">0.00 $</span>
            </div>
            <p style="font-size:11px; color:var(--text-muted); margin-top:10px;">
                * Ù†Ø±Ø® ØªØ¨Ø¯ÛŒÙ„: Ø§Ø±Ø²Ø´ Û± ÙˆØ§Ø­Ø¯ Ø§Ø² Ø¢Ù† Ø§Ø±Ø² Ø¨Ù‡ Ø¯Ù„Ø§Ø± Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯ (Ù…Ø«Ù„Ø§Ù‹ Ø¨Ø±Ø§ÛŒ ÛŒÙˆØ±Ùˆ 1.05ØŒ Ø¨Ø±Ø§ÛŒ ØªØªØ± 1).
                <br>
                * Ø³ØªÙˆÙ† Ø³Ø±Ù…Ø§ÛŒÙ‡ Ø®Ø§Ù„Øµ = (Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ú¯Ø§ÙˆØµÙ†Ø¯ÙˆÙ‚) + (Ø·Ù„Ø¨ Ø§Ø² Ù†Ù…Ø§ÛŒÙ†Ø¯Ú¯Ø§Ù†) + (Ø·Ù„Ø¨ Ø§Ø² Ù…Ø´ØªØ±ÛŒØ§Ù†).
            </p>
        </div>

        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th style="width:10%">Ø§Ø±Ø²</th>
                        <th style="width:15%">Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ú¯Ø§ÙˆØµÙ†Ø¯ÙˆÙ‚</th>
                        <th style="width:15%">Ù…Ø§Ù†Ø¯Ù‡ Ø­Ø³Ø§Ø¨ Ù…Ø´ØªØ±ÛŒØ§Ù†</th>
                        <th style="width:15%">Ù…Ø§Ù†Ø¯Ù‡ Ú©ØªØ§Ø¨ Ø­ÙˆØ§Ù„Ù‡</th>
                        <th style="width:15%; background:rgba(212,175,55,0.1)">âœ… Ø³Ø±Ù…Ø§ÛŒÙ‡ Ø®Ø§Ù„Øµ</th>
                        <th style="width:15%">Ù†Ø±Ø® ØªØ¨Ø¯ÛŒÙ„ Ø¨Ù‡ Ø¯Ù„Ø§Ø± ($)</th>
                        <th style="width:15%">Ù…Ø¹Ø§Ø¯Ù„ Ø¯Ù„Ø§Ø±ÛŒ</th>
                    </tr>
                </thead>
                <tbody id="analysisBody"></tbody>
            </table>
        </div>
    </div>
</div>
<div id="employees" class="page admin-only-view">
    <div class="card">
        <div class="card-header">
            <span>Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø§Ø±Ù…Ù†Ø¯Ø§Ù† Ùˆ Ø­Ù‚ÙˆÙ‚ Ùˆ Ø¯Ø³ØªÙ…Ø²Ø¯</span>
            <button class="btn btn-green" onclick="openModal('modalNewEmp')">â• Ø§Ø³ØªØ®Ø¯Ø§Ù… Ú©Ø§Ø±Ù…Ù†Ø¯ Ø¬Ø¯ÛŒØ¯</button>
        </div>
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Ù†Ø§Ù… Ú©Ø§Ø±Ù…Ù†Ø¯</th>
                        <th>Ø³Ù…Øª / ÙˆØ¸ÛŒÙÙ‡</th>
                        <th>Ø­Ù‚ÙˆÙ‚ ØªÙˆØ§ÙÙ‚ÛŒ (Ù…Ø§Ù‡Ø§Ù†Ù‡)</th>
                        <th>ÙˆØ¶Ø¹ÛŒØª Ø­Ø³Ø§Ø¨ (Ø·Ù„Ø¨ Ú©Ø§Ø±Ù…Ù†Ø¯)</th>
                        <th style="min-width: 250px;">Ø¹Ù…Ù„ÛŒØ§Øª Ø­Ù‚ÙˆÙ‚</th>
                    </tr>
                </thead>
                <tbody id="employeeBody"></tbody>
            </table>
        </div>
        <p style="font-size:12px; color:var(--text-muted); margin-top:10px;">
            * <b>Ø³Ø±Ø±Ø³ÛŒØ¯ Ø­Ù‚ÙˆÙ‚:</b> ÛŒØ¹Ù†ÛŒ Ù…Ø§Ù‡ ØªÙ…Ø§Ù… Ø´Ø¯Ù‡ Ùˆ Ø­Ù‚ÙˆÙ‚ Ø¨Ù‡ Ø·Ù„Ø¨ Ú©Ø§Ø±Ù…Ù†Ø¯ Ø§Ø¶Ø§ÙÙ‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯ (Ù¾ÙˆÙ„ÛŒ Ù¾Ø±Ø¯Ø§Ø®Øª Ù†Ù…ÛŒâ€ŒØ´ÙˆØ¯).<br>
            * <b>Ù¾Ø±Ø¯Ø§Ø®Øª Ù†Ù‚Ø¯ÛŒ:</b> ÛŒØ¹Ù†ÛŒ Ù¾ÙˆÙ„ Ù†Ù‚Ø¯ Ø§Ø² ØµÙ†Ø¯ÙˆÙ‚ Ø¨Ù‡ Ú©Ø§Ø±Ù…Ù†Ø¯ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯ Ùˆ Ø­Ø³Ø§Ø¨Ø´ ØªØ³ÙˆÛŒÙ‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯.
        </p>
    </div>
</div>

<div id="modalNewEmp" class="modal">
    <div class="modal-content" style="max-width:400px; border: 2px solid var(--gold-primary);">
        <span class="close-icon" onclick="closeModal('modalNewEmp')">&times;</span>
        <div class="card-header">Ø§Ø³ØªØ®Ø¯Ø§Ù… Ú©Ø§Ø±Ù…Ù†Ø¯ Ø¬Ø¯ÛŒØ¯</div>
        
        <label class="label">Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ</label>
        <input id="empName" class="input" placeholder="Ù…Ø«Ù„Ø§Ù‹: Ø§Ø­Ù…Ø¯ Ø±Ø¶Ø§ÛŒÛŒ">
        
        <label class="label">Ø³Ù…Øª / Ø´ØºÙ„</label>
        <input id="empJob" class="input" placeholder="Ù…Ø«Ù„Ø§Ù‹: Ø¢Ø¨Ø¯Ø§Ø±Ú†ÛŒØŒ Ø­Ø³Ø§Ø¨Ø¯Ø§Ø±...">
        
        <div class="grid-2">
            <div>
                <label class="label">Ù…Ø¨Ù„Øº Ø­Ù‚ÙˆÙ‚ Ù…Ø§Ù‡Ø§Ù†Ù‡</label>
                <input type="number" id="empSalary" class="input" placeholder="0">
            </div>
            <div>
                <label class="label">Ø§Ø±Ø² Ø­Ù‚ÙˆÙ‚</label>
                <select id="empCurr" class="input"></select>
            </div>
        </div>

        <button class="btn btn-green" style="width:100%" onclick="saveNewEmployee()">
            Ø«Ø¨Øª Ú©Ø§Ø±Ù…Ù†Ø¯ (F10)
        </button>
    </div>
</div>
<div id="reports" class="page admin-only-view">
            <div class="card" style="margin-bottom:15px">
                <div class="card-header"><span data-i18n="header_backup">Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ (Backup)</span></div>
                <div style="display:flex; gap:15px">
                    <button class="btn btn-blue" onclick="exportDB()">
                        <span data-i18n="btn_download_backup">â¬‡ï¸ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø¨Ú©â€ŒØ¢Ù¾ Ú©Ø§Ù…Ù„</span>
                    </button>
                    <button class="btn btn-gold" onclick="importDB()">
                        <span data-i18n="btn_restore_backup">â¬†ï¸ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø¨Ú©â€ŒØ¢Ù¾ (Restore)</span>
                    </button>
                </div>
            </div>
            <div class="card">
                <div class="card-header">
                    <span data-i18n="header_journal">Ø¯ÙØªØ± Ø±ÙˆØ²Ù†Ø§Ù…Ù‡ (Log) - Ø§Ù…Ú©Ø§Ù† Ø¨Ø§Ø²Ú¯Ø´Øª ØªØ±Ø§Ú©Ù†Ø´</span>
                    <button class="btn btn-outline no-print" style="font-size:12px;" onclick="printTodayJournal()">
                        <span data-i18n="btn_print_log">ğŸ–¨ Ù¾Ø±ÛŒÙ†Øª Ø±Ø³Ù…ÛŒ Ú¯Ø²Ø§Ø±Ø´</span>
                    </button>
                </div>
                <div class="table-container" style="height:500px; overflow-y:auto">
                    <table id="journalTable">
                        <thead>
                            <tr>
                                <th data-i18n="th_time">Ø²Ù…Ø§Ù†</th>
                                <th data-i18n="th_section">Ø¨Ø®Ø´</th>
                                <th data-i18n="th_desc">ØªÙˆØ¶ÛŒØ­Ø§Øª</th>
                                <th data-i18n="th_amount">Ù…Ø¨Ù„Øº</th>
                                <th data-i18n="th_user">Ú©Ø§Ø±Ø¨Ø±</th>
                                <th class="admin-only-col" data-i18n="th_ops">Ø¹Ù…Ù„ÛŒØ§Øª</th>
                            </tr>
                        </thead>
                        <tbody id="journalBody"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div> 
</div>
<div id="modalNewHawala" class="modal">
    <div class="modal-content">
        <span class="close-icon" onclick="closeModal('modalNewHawala')">&times;</span>
        <div class="card-header" data-i18n="modal_new_hawala">Ø«Ø¨Øª Ø­ÙˆØ§Ù„Ù‡ Ø¬Ø¯ÛŒØ¯</div>
        
        <div class="radio-group" style="margin-bottom: 10px;">
            <div id="hOptExternal" class="radio-label active" onclick="setHawalaCustType('external')" tabindex="0">
                <span data-i18n="opt_external_cust">Ù…Ø´ØªØ±ÛŒ Ø¢Ø²Ø§Ø¯ (Ù†Ù‚Ø¯ÛŒ)</span>
            </div>
            <div id="hOptInternal" class="radio-label" onclick="setHawalaCustType('internal')" tabindex="0">
                <span data-i18n="opt_internal_cust">Ù…Ø´ØªØ±ÛŒ Ø­Ø³Ø§Ø¨â€ŒØ¯Ø§Ø±</span>
            </div>
        </div>
        <div id="hInternalSec" style="display:none; background:rgba(212,175,55,0.1); padding:10px; border-radius:8px; margin-bottom:15px; border:1px solid var(--gold-primary);">
            <label class="label" data-i18n="lbl_select_account">Ø§Ù†ØªØ®Ø§Ø¨ Ù…Ø´ØªØ±ÛŒ (Ø¬Ù‡Øª Ø«Ø¨Øª Ø¯Ø± Ø­Ø³Ø§Ø¨)</label>
            <select id="hCustomerSelect" class="input" onchange="fillHawalaCustName()"></select>
        </div>
        <div class="grid-2">
            <div>
                <label class="label" data-i18n="lbl_operation_type">Ù†ÙˆØ¹ Ø¹Ù…Ù„ÛŒØ§Øª</label>
                <select id="hType" class="input">
                    <option value="Outgoing" data-i18n="opt_outgoing_full">Ø§Ø±Ø³Ø§Ù„ (Ø¨Ù‡ Ø´Ù‡Ø± Ø¯ÛŒÚ¯Ø±)</option>
                    <option value="Incoming" data-i18n="opt_incoming_full">Ø¯Ø±ÛŒØ§ÙØª (Ø§Ø² Ø´Ù‡Ø± Ø¯ÛŒÚ¯Ø±)</option>
                </select>
            </div>
            <div>
                <label class="label" data-i18n="lbl_city_book">Ú©ØªØ§Ø¨ Ø´Ù‡Ø± (Ø·Ø±Ù Ø­Ø³Ø§Ø¨)</label>
                <select id="hCityBook" class="input"></select>
            </div>
        </div>
        <div class="grid-4">
            <div><label class="label" data-i18n="lbl_amount">Ù…Ø¨Ù„Øº Ø§ØµÙ„ Ø­ÙˆØ§Ù„Ù‡</label><input type="number" id="hAmt" class="input"></div>
            <div><label class="label" data-i18n="lbl_currency">Ø§Ø±Ø²</label><select id="hCurr" class="input"></select></div>
            <div>
                <label class="label" style="color:#42a5f5">Ù†ÙˆØ¹ Ú©Ù…ÛŒØ´Ù†</label>
                <select id="hCommType" class="input">
                    <option value="in">Ø¯Ø±ÛŒØ§ÙØªÛŒ (Ø³ÙˆØ¯ +)</option>
                    <option value="out">Ù¾Ø±Ø¯Ø§Ø®ØªÛŒ (Ù‡Ø²ÛŒÙ†Ù‡ -)</option>
                </select>
            </div>
            <div><label class="label" data-i18n="lbl_commission">Ù…Ù‚Ø¯Ø§Ø± Ú©Ù…ÛŒØ´Ù†</label><input type="number" id="hComm" class="input" value="0" placeholder="0"></div>
        </div>
        <hr style="margin:10px 0; border:0; border-top:1px dashed var(--gold-primary)">
        <div class="grid-2">
            <div><label class="label" data-i18n="lbl_sender">Ù†Ø§Ù… ÙØ±Ø³ØªÙ†Ø¯Ù‡</label><input id="hSender" class="input"></div>
            <div><label class="label" data-i18n="lbl_receiver">Ù†Ø§Ù… Ú¯ÛŒØ±Ù†Ø¯Ù‡</label><input id="hReceiver" class="input"></div>
        </div>
        <div class="grid-2">
            <div><label class="label" data-i18n="lbl_phone">ØªÙ„ÙÙ† ØªÙ…Ø§Ø³</label><input id="hPhone" class="input"></div>
            <div><label class="label" data-i18n="lbl_id_card">Ø´Ù…Ø§Ø±Ù‡ ØªØ°Ú©Ø±Ù‡/Ù¾Ø§Ø³Ù¾ÙˆØ±Øª</label><input id="hIDCard" class="input"></div>
        </div>
        <div style="margin-top:15px; text-align:left">
            <button class="btn btn-outline" onclick="closeModal('modalNewHawala')">
                <span data-i18n="btn_cancel">Ø§Ù†ØµØ±Ø§Ù (Esc)</span>
            </button>
            <button class="btn btn-gold" onclick="submitHawala()">
                <span data-i18n="btn_issue_hawala">ØµØ¯ÙˆØ± Ùˆ Ø«Ø¨Øª (F10)</span>
            </button>
        </div>
    </div>
</div>
<div id="modalEditHawala" class="modal">
    <div class="modal-content">
        <span class="close-icon" onclick="closeModal('modalEditHawala')">&times;</span>
        <div class="card-header">
            <span data-i18n="modal_edit_hawala">ÙˆÛŒØ±Ø§ÛŒØ´ Ø­ÙˆØ§Ù„Ù‡</span> 
            <span id="editHawalaId" style="color:var(--gold-primary)"></span>
        </div>
        <div class="label" style="background: rgba(255, 82, 82, 0.1); color: var(--danger); padding: 5px; margin-bottom: 10px; border-radius: 4px;" data-i18n="msg_security_warning">ØªÙˆØ¬Ù‡: Ø¬Ù‡Øª Ø§Ù…Ù†ÛŒØª ØµÙ†Ø¯ÙˆÙ‚ØŒ Ø§Ù…Ú©Ø§Ù† ØªØºÛŒÛŒØ± Ù…Ø¨Ù„Øº ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯. Ø¨Ø±Ø§ÛŒ Ø§ØµÙ„Ø§Ø­ Ù…Ø¨Ù„ØºØŒ Ø­ÙˆØ§Ù„Ù‡ Ø±Ø§ Ø­Ø°Ù Ùˆ Ù…Ø¬Ø¯Ø¯ Ø§ÛŒØ¬Ø§Ø¯ Ú©Ù†ÛŒØ¯.</div>
        <input type="hidden" id="editHId">
        <div class="grid-2">
            <div>
                <label class="label" data-i18n="lbl_operation_type">Ù†ÙˆØ¹ Ø¹Ù…Ù„ÛŒØ§Øª</label>
                <select id="editHType" class="input" disabled>
                    <option value="Outgoing" data-i18n="opt_outgoing_full">Ø§Ø±Ø³Ø§Ù„ (Ø¨Ù‡ Ø´Ù‡Ø± Ø¯ÛŒÚ¯Ø±)</option>
                    <option value="Incoming" data-i18n="opt_incoming_full">Ø¯Ø±ÛŒØ§ÙØª (Ø§Ø² Ø´Ù‡Ø± Ø¯ÛŒÚ¯Ø±)</option>
                </select>
            </div>
            <div>
                <label class="label" data-i18n="lbl_city_book">Ú©ØªØ§Ø¨ Ø´Ù‡Ø±</label>
                <select id="editHCityBook" class="input"></select>
            </div>
        </div>
        <div class="grid-2">
            <div>
                <label class="label" data-i18n="lbl_amount_fixed">Ù…Ø¨Ù„Øº (ØºÛŒØ±Ù‚Ø§Ø¨Ù„ ØªØºÛŒÛŒØ±)</label>
                <input type="number" id="editHAmt" class="input" disabled>
            </div>
            <div>
                <label class="label" data-i18n="lbl_currency_fixed">Ø§Ø±Ø² (ØºÛŒØ±Ù‚Ø§Ø¨Ù„ ØªØºÛŒÛŒØ±)</label>
                <select id="editHCurr" class="input" disabled></select>
            </div>
        </div>
        <hr style="margin:10px 0; border:0; border-top:1px dashed var(--gold-border)">
        <div class="grid-2">
            <div><label class="label" data-i18n="lbl_sender">Ù†Ø§Ù… ÙØ±Ø³ØªÙ†Ø¯Ù‡</label><input id="editHSender" class="input"></div>
            <div><label class="label" data-i18n="lbl_receiver">Ù†Ø§Ù… Ú¯ÛŒØ±Ù†Ø¯Ù‡</label><input id="editHReceiver" class="input"></div>
        </div>
        <div class="grid-2">
            <div><label class="label" data-i18n="lbl_phone">ØªÙ„ÙÙ† ØªÙ…Ø§Ø³</label><input id="editHPhone" class="input"></div>
            <div><label class="label" data-i18n="lbl_id_card">Ø´Ù…Ø§Ø±Ù‡ ØªØ°Ú©Ø±Ù‡/Ù¾Ø§Ø³Ù¾ÙˆØ±Øª</label><input id="editHIDCard" class="input"></div>
        </div>
        <div style="margin-top:15px; text-align:left">
            <button class="btn btn-outline" onclick="closeModal('modalEditHawala')">
                <span data-i18n="btn_cancel">Ø§Ù†ØµØ±Ø§Ù (Esc)</span>
            </button>
            <button class="btn btn-blue" onclick="submitEditHawala()">
                <span data-i18n="btn_save_edit">Ø«Ø¨Øª ÙˆÛŒØ±Ø§ÛŒØ´ (F10)</span>
            </button>
        </div>
    </div>
</div>

<div id="modalTx" class="modal">
    <div class="modal-content">
        <span class="close-icon" onclick="closeModal('modalTx')">&times;</span>
        <div class="card-header" data-i18n="modal_tx_header">Ø«Ø¨Øª ØªØ±Ø§Ú©Ù†Ø´ Ø­Ø³Ø§Ø¨ Ù…Ø´ØªØ±ÛŒ</div>
        <label class="label" data-i18n="lbl_account_party">Ø·Ø±Ù Ø­Ø³Ø§Ø¨</label>
        <select id="txCust" class="input"></select>
        <div class="grid-2">
            <div>
                <label class="label" data-i18n="lbl_type">Ù†ÙˆØ¹</label>
                <select id="txType" class="input">
                    <option value="credit" data-i18n="opt_deposit">ÙˆØ§Ø±ÛŒØ² Ø¨Ù‡ Ø­Ø³Ø§Ø¨ (Ø¯Ø±ÛŒØ§ÙØª Ù¾ÙˆÙ„)</option>
                    <option value="debit" data-i18n="opt_withdraw">Ø¨Ø±Ø¯Ø§Ø´Øª Ø§Ø² Ø­Ø³Ø§Ø¨ (Ù¾Ø±Ø¯Ø§Ø®Øª Ù¾ÙˆÙ„)</option>
                </select>
            </div>
            <div>
                <label class="label" data-i18n="lbl_currency">Ø§Ø±Ø²</label>
                <select id="txCurr" class="input"></select>
            </div>
        </div>
        <label class="label" data-i18n="lbl_amount">Ù…Ø¨Ù„Øº</label>
        <input type="number" id="txAmt" class="input">
        <label class="label" data-i18n="lbl_desc">Ø´Ø±Ø­</label>
        <input type="text" id="txDesc" class="input">
        <button class="btn btn-gold" style="width:100%; margin-top:15px" onclick="submitTx()">
            <span data-i18n="btn_submit_tx">Ø«Ø¨Øª Ø³Ù†Ø¯ Ùˆ Ø§Ù†Ø¬Ø§Ù… (F10)</span>
        </button>
        <button class="btn btn-outline" style="width:100%; margin-top:5px" onclick="closeModal('modalTx')">
            <span data-i18n="btn_close">Ø¨Ø³ØªÙ† (Esc)</span>
        </button>
    </div>
</div>
<div id="modalClientTransfer" class="modal">
    <div class="modal-content" style="max-width:500px">
        <span class="close-icon" onclick="closeModal('modalClientTransfer')">&times;</span>
        <div class="card-header" data-i18n="modal_transfer_header">Ø§Ù†ØªÙ‚Ø§Ù„ Ø¨ÛŒÙ† Ø­Ø³Ø§Ø¨ Ù…Ø´ØªØ±ÛŒâ€ŒÙ‡Ø§</div>
        <div style="background:rgba(212, 175, 55, 0.1); padding:10px; border-radius:8px; margin-bottom:15px; border:1px solid var(--gold-primary)">
            <span style="font-size:12px; color:var(--text-main)" data-i18n="lbl_source_account">Ù…Ø¨Ø¯Ø§ (Ú©Ø³Ø± Ø§Ø² Ø­Ø³Ø§Ø¨): </span>
            <b id="ctSender" style="color:var(--gold-primary); font-size:14px"></b>
        </div>
        <label class="label" data-i18n="lbl_dest_account">Ù…Ù‚ØµØ¯ (ÙˆØ§Ø±ÛŒØ² Ø¨Ù‡ Ø­Ø³Ø§Ø¨)</label>
        <select id="ctReceiver" class="input"></select>
        <div class="grid-2">
            <div><label class="label" data-i18n="lbl_transfer_amount">Ù…Ø¨Ù„Øº Ø§Ù†ØªÙ‚Ø§Ù„</label><input type="number" id="ctAmt" class="input"></div>
            <div><label class="label" data-i18n="lbl_currency">Ø§Ø±Ø²</label><select id="ctCurr" class="input"></select></div>
        </div>
        <label class="label" data-i18n="lbl_desc">ØªÙˆØ¶ÛŒØ­Ø§Øª</label>
        <input type="text" id="ctDesc" class="input" placeholder="...">
        <button class="btn btn-indigo" style="width:100%; margin-top:15px" onclick="submitClientTransfer()">
            <span data-i18n="btn_do_transfer">Ø§Ù†Ø¬Ø§Ù… Ø§Ù†ØªÙ‚Ø§Ù„ (F10)</span>
        </button>
        <button class="btn btn-outline" style="width:100%; margin-top:5px" onclick="closeModal('modalClientTransfer')">
            <span data-i18n="btn_cancel">Ø§Ù†ØµØ±Ø§Ù (Esc)</span>
        </button>
    </div>
</div>

<div id="modalNewCust" class="modal">
    <div class="modal-content" style="max-width:400px; border: 2px solid var(--gold-primary);">
        <span class="close-icon" onclick="closeModal('modalNewCust')">&times;</span>
        <div class="card-header" data-i18n="modal_new_cust">Ù…Ø´ØªØ±ÛŒ Ø¬Ø¯ÛŒØ¯</div>
        <div class="label" data-i18n="lbl_cust_name">Ù†Ø§Ù… Ú©Ø§Ù…Ù„ Ù…Ø´ØªØ±ÛŒ</div>
        <input id="newCustName" class="input" placeholder="...">
        <div class="label" data-i18n="lbl_phone">Ø´Ù…Ø§Ø±Ù‡ ØªÙ„ÙÙ†</div>
        <input id="newCustPhone" class="input" placeholder="07...">
        <button class="btn btn-green" style="width:100%" onclick="addCustomer()">
            <span data-i18n="btn_add_list">Ø§ÙØ²ÙˆØ¯Ù† Ø¨Ù‡ Ù„ÛŒØ³Øª (F10)</span>
        </button>
        <button class="btn btn-outline" style="width:100%; margin-top:5px" onclick="closeModal('modalNewCust')">
            <span data-i18n="btn_cancel">Ù„ØºÙˆ (Esc)</span>
        </button>
    </div>
</div>

<div id="modalEditCust" class="modal">
    <div class="modal-content" style="max-width:400px; border: 2px solid var(--gold-primary);">
        <span class="close-icon" onclick="closeModal('modalEditCust')">&times;</span>
        <div class="card-header" data-i18n="modal_edit_cust">ÙˆÛŒØ±Ø§ÛŒØ´ Ù…Ø´Ø®ØµØ§Øª Ù…Ø´ØªØ±ÛŒ</div>
        <div class="label" style="color:var(--danger); font-size:11px; margin-bottom:5px" data-i18n="msg_edit_name_warning">ØªÙˆØ¬Ù‡: ØªØºÛŒÛŒØ± Ù†Ø§Ù… Ø¨Ø§Ø¹Ø« ØªØºÛŒÛŒØ± Ù†Ø§Ù… Ø¯Ø± ØªÙ…Ø§Ù… Ú¯Ø²Ø§Ø±Ø´Ø§Øª Ù‚Ø¨Ù„ÛŒ Ù†ÛŒØ² Ù…ÛŒâ€ŒØ´ÙˆØ¯.</div>
        <div class="label" data-i18n="lbl_new_name">Ù†Ø§Ù… Ø¬Ø¯ÛŒØ¯</div>
        <input id="editCustName" class="input">
        <div class="label" data-i18n="lbl_new_phone">ØªÙ„ÙÙ† Ø¬Ø¯ÛŒØ¯</div>
        <input id="editCustPhone" class="input">
        <button class="btn btn-blue" style="width:100%" onclick="submitEditCustomer()">
            <span data-i18n="btn_save_changes">Ø«Ø¨Øª ØªØºÛŒÛŒØ±Ø§Øª (F10)</span>
        </button>
        <button class="btn btn-outline" style="width:100%; margin-top:5px" onclick="closeModal('modalEditCust')">
            <span data-i18n="btn_cancel">Ù„ØºÙˆ (Esc)</span>
        </button>
    </div>
</div>

<div id="modalAllAcc" class="modal">
    <div class="modal-content" style="max-width:800px; max-height: 90vh; display: flex; flex-direction: column;">
        <span class="close-icon" onclick="closeModal('modalAllAcc')">&times;</span>
        <div class="card-header" data-i18n="modal_all_acc_status">ÙˆØ¶Ø¹ÛŒØª Ú©Ù„ Ø­Ø³Ø§Ø¨â€ŒÙ‡Ø§ÛŒ Ù…Ø´ØªØ±ÛŒØ§Ù†</div>
        
        <div class="search-sticky">
            <div class="label" style="font-size: 11px; margin-bottom: 5px; color: var(--gold-primary);" data-i18n="msg_click_to_view">* Ø¬Ù‡Øª Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø±ÛŒØ²Ø­Ø³Ø§Ø¨ØŒ Ø±ÙˆÛŒ Ú©Ø§Ø±Øª Ù…Ø´ØªØ±ÛŒ Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯.</div>
            <input type="text" id="searchAllAcc" class="input" placeholder="ğŸ” ..." oninput="filterAllAccounts()" style="margin-bottom: 0;">
        </div>

        <div id="allAccountsList" style="flex-grow: 1; overflow-y: auto; padding-right: 5px;"></div>

        <div style="margin-top:15px; text-align:left; border-top: 1px solid var(--gold-border); padding-top: 10px;">
            <button class="btn btn-red" onclick="closeModal('modalAllAcc')">
                <span data-i18n="btn_close">Ø¨Ø³ØªÙ† (Esc)</span>
            </button>
        </div>
    </div>
</div>
<div id="modalSettings" class="modal">
    <div class="modal-content">
        <span class="close-icon" onclick="closeModal('modalSettings')">&times;</span>
        <div class="card-header" data-i18n="header_settings">ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø³ÛŒØ³ØªÙ…</div>
        <div style="border-bottom:1px solid var(--gold-border); padding-bottom:10px; margin-bottom:10px">
    <label class="label" style="color:var(--gold-primary)">Ù¾Ø±ÙˆÙØ§ÛŒÙ„ Ùˆ Ù…Ø´Ø®ØµØ§Øª ØµØ±Ø§ÙÛŒ (Ø¬Ù‡Øª Ú†Ø§Ù¾)</label>
    <div class="grid-2">
        <div>
            <label class="label">Ù†Ø§Ù… ØµØ±Ø§ÙÛŒ</label>
            <input id="setCompName" class="input" placeholder="Ù…Ø«Ù„Ø§Ù‹: ØµØ±Ø§ÙÛŒ Ø¨Ø±Ø§Ø¯Ø±Ø§Ù†...">
        </div>
        <div>
            <label class="label">Ø´Ø¹Ø§Ø± ØªØ¨Ù„ÛŒØºØ§ØªÛŒ</label>
            <input id="setCompSlogan" class="input" placeholder="Ø³Ø±ÛŒØ¹ØŒ Ù…Ø·Ù…Ø¦Ù†...">
        </div>
    </div>
    <div class="grid-2">
        <div>
            <label class="label">Ø´Ù…Ø§Ø±Ù‡ ØªÙ…Ø§Ø³</label>
            <input id="setCompPhone" class="input">
        </div>
        <div>
            <label class="label">Ø¢Ø¯Ø±Ø³ Ø¯ÙØªØ±</label>
            <input id="setCompAddress" class="input">
        </div>
    </div>
    <div>
        <label class="label">Ù¾ÛŒØ§Ù… ØªØ´Ú©Ø± (Ø²ÛŒØ± ÙØ§Ú©ØªÙˆØ±)</label>
        <input id="setCompFooter" class="input" placeholder="Ø§Ø² Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ù…Ø§ Ù…ØªØ´Ú©Ø±ÛŒÙ…">
    </div>
    <button class="btn btn-green" style="width:100%; margin-top:10px" onclick="saveCompanyProfile()">
        Ø«Ø¨Øª Ù…Ø´Ø®ØµØ§Øª Ø´Ø±Ú©Øª
    </button>
</div>
        <div style="border-bottom:1px solid var(--gold-border); padding-bottom:10px; margin-bottom:10px">
            <label class="label" style="color:var(--gold-primary)" data-i18n="lbl_print_settings">ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ú†Ø§Ù¾</label>
            <div style="display:flex; align-items:center; gap:10px; background:rgba(212,175,55,0.05); padding:10px; border-radius:8px; border:1px solid var(--gold-border)">
                <input type="checkbox" id="printHeaderOpt" onchange="togglePrintHeaderSetting()">
                <label for="printHeaderOpt" style="font-size:13px; cursor:pointer" data-i18n="lbl_print_header_opt">Ù†Ù…Ø§ÛŒØ´ Â«Ù†Ø§Ù… Ø´Ø±Ú©ØªÂ» Ø¯Ø± Ø³Ø±Ø¨Ø±Ú¯ ØªÙ…Ø§Ù… Ú†Ø§Ù¾â€ŒÙ‡Ø§</label>
            </div>
        </div>

        <div id="settingsAdminSection" style="display:none">
            <div style="border-bottom:1px solid var(--gold-border); padding-bottom:10px; margin-bottom:10px">
                <label class="label" data-i18n="lbl_initial_capital_set">Ø³Ø±Ù…Ø§ÛŒÙ‡ Ø§ÙˆÙ„ÛŒÙ‡ (Ø¬Ù‡Øª Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø³ÙˆØ¯/Ø²ÛŒØ§Ù†)</label>
                <div id="initialCapitalInputs"></div>
                <button class="btn btn-blue" style="width:100%; margin-top:10px" onclick="setInitialCapital()">
                    <span data-i18n="btn_save_capital">Ø«Ø¨Øª Ø³Ø±Ù…Ø§ÛŒÙ‡ Ø§ÙˆÙ„ÛŒÙ‡</span>
                </button>
            </div>
            
            <div style="border-bottom:1px solid var(--gold-border); padding-bottom:10px; margin-bottom:10px">
                <label class="label" data-i18n="lbl_user_mgmt">Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø§Ø±Ø¨Ø±Ø§Ù†</label>
                <div class="grid-2" style="gap:10px">
                    <input id="newUName" class="input" placeholder="Username">
                    <input id="newUPass" class="input" placeholder="Password">
                </div>
                <label class="label" style="margin-top:5px; font-weight:600" data-i18n="lbl_permissions">Ø³Ø·ÙˆØ­ Ø¯Ø³ØªØ±Ø³ÛŒ:</label>
                <div style="display:flex; flex-wrap:wrap; gap:10px; margin-bottom:10px; background:rgba(0,0,0,0.2); padding:10px; border-radius:8px; border:1px solid var(--gold-border)">
                    <label style="font-size:13px"><input type="checkbox" id="perm_hawala" checked> <span data-i18n="perm_hawala">Ø­ÙˆØ§Ù„Ù‡â€ŒØ¬Ø§Øª</span></label>
                    <label style="font-size:13px"><input type="checkbox" id="perm_exchange" checked> <span data-i18n="perm_exchange">Ø®Ø±ÛŒØ¯/ÙØ±ÙˆØ´</span></label>
                    <label style="font-size:13px"><input type="checkbox" id="perm_accounts"> <span data-i18n="perm_accounts">Ø­Ø³Ø§Ø¨ Ù…Ø´ØªØ±ÛŒØ§Ù†</span></label>
                    <label style="font-size:13px"><input type="checkbox" id="perm_tt"> <span data-i18n="perm_tt">Ø§Ù†ØªÙ‚Ø§Ù„ Ø§Ø±Ø² (TT)</span></label>
                    <label style="font-size:13px"><input type="checkbox" id="perm_admin" onchange="toggleAdminAccess(this)"> <span style="color:var(--gold-primary)" data-i18n="perm_admin">Ø¯Ø³ØªØ±Ø³ÛŒ Ú©Ø§Ù…Ù„ (Ù…Ø¯ÛŒØ±)</span></label>
                </div>
                <button class="btn btn-green" style="width:100%" onclick="addUser()">
                    <span data-i18n="btn_add_user">Ø§ÙØ²ÙˆØ¯Ù† Ú©Ø§Ø±Ø¨Ø±</span>
                </button>
                <div id="userListManage" style="margin-top:10px"></div>
            </div>

            <div style="border-bottom:1px solid var(--gold-border); padding-bottom:10px; margin-bottom:10px">
                <label class="label" data-i18n="lbl_add_city">Ø§ÙØ²ÙˆØ¯Ù† Ø´Ù‡Ø± (Ú©ØªØ§Ø¨ Ø­ÙˆØ§Ù„Ù‡)</label>
                <div style="display:flex; gap:5px">
                    <input id="newCityName" class="input" placeholder="Name">
                    <input id="newCityCode" class="input" placeholder="Code (MZR)" style="text-transform:uppercase; width:80px">
                    <button class="btn btn-gold" onclick="addCity()">
                        <span data-i18n="btn_add">Ø§ÙØ²ÙˆØ¯Ù†</span>
                    </button>
                </div>
                <div style="margin-top:15px; border-top:1px dashed var(--gold-border); padding-top:10px">
                    <label class="label" style="color:var(--danger)" data-i18n="lbl_delete_city">Ø­Ø°Ù Ø´Ù‡Ø± (Delete City)</label>
                    <div style="display:flex; gap:5px; flex-direction:column">
                        <select id="cityToDelete" class="input" onchange="checkCityForDelete()"></select>
                        <div id="transferCitySection" style="display:none; background:rgba(212,175,55,0.1); padding:10px; border-radius:8px;">
                            <label class="label" data-i18n="msg_city_has_data">ØªÙˆØ¬Ù‡: Ø§ÛŒÙ† Ø´Ù‡Ø± Ø¯Ø§Ø±Ø§ÛŒ Ø­ÙˆØ§Ù„Ù‡ Ø§Ø³Øª. Ù…Ù‚ØµØ¯ Ø§Ù†ØªÙ‚Ø§Ù„:</label>
                            <select id="cityTransferTarget" class="input"></select>
                        </div>
                        <button id="btnDeleteCity" class="btn btn-red" onclick="deleteCityProcess()">
                            <span data-i18n="btn_delete_city">Ø­Ø°Ù Ø´Ù‡Ø±</span>
                        </button>
                    </div>
                </div>
            </div>

            <div style="border-bottom:1px solid var(--gold-border); padding-bottom:10px; margin-bottom:10px">
                <label class="label" data-i18n="lbl_currency_mgmt">Ù…Ø¯ÛŒØ±ÛŒØª Ø§Ø±Ø²Ù‡Ø§ (Ø§ÙØ²ÙˆØ¯Ù† Ùˆ Ø­Ø°Ù)</label>
                <div style="display:flex; gap:5px; margin-bottom:10px">
                    <input id="newCurrCode" class="input" placeholder="Code (EURO)">
                    <button class="btn btn-outline" onclick="addCurrency()">
                        <span data-i18n="btn_add">Ø§ÙØ²ÙˆØ¯Ù†</span>
                    </button>
                </div>
                <div style="display:flex; gap:5px">
                    <select id="currToDelete" class="input"></select>
                    <button class="btn btn-red" onclick="deleteCurrency()">
                        <span data-i18n="btn_delete">Ø­Ø°Ù</span>
                    </button>
                </div>
            </div>

            <div style="margin-top:20px; padding-top:15px; border-top:1px solid var(--gold-border);">
                <label class="label" style="color:var(--danger)" data-i18n="lbl_reset_app">Ø±ÛŒØ³ØªØ§Ø±Øª Ø¨Ø±Ù†Ø§Ù…Ù‡ (Ø­Ø°Ù ØªÙ…Ø§Ù… Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ùˆ Ù…Ø´ØªØ±ÛŒØ§Ù†)</label>
                <button class="btn btn-red" style="width:100%" onclick="resetData()">
                    <span data-i18n="btn_full_reset">Ø±ÛŒØ³ØªØ§Ø±Øª Ú©Ø§Ù…Ù„ Ø¨Ø±Ù†Ø§Ù…Ù‡</span>
                </button>
            </div>
        </div>

        <div>
            <label class="label" data-i18n="lbl_change_pass">ØªØºÛŒÛŒØ± Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ù…Ù†</label>
            <input type="password" id="myNewPass" class="input">
            <button class="btn btn-blue" onclick="changeMyPass()">
                <span data-i18n="btn_change_pass">ØªØºÛŒÛŒØ± Ø±Ù…Ø²</span>
            </button>
        </div>
        <button class="btn btn-red" style="width:100%; margin-top:20px" onclick="closeModal('modalSettings')">
            <span data-i18n="btn_close">Ø¨Ø³ØªÙ† (Esc)</span>
        </button>
    </div>
</div>
<script>
function numberToPersianWords(number) {
    const units = ['', 'ÛŒÚ©', 'Ø¯Ùˆ', 'Ø³Ù‡', 'Ú†Ù‡Ø§Ø±', 'Ù¾Ù†Ø¬', 'Ø´Ø´', 'Ù‡ÙØª', 'Ù‡Ø´Øª', 'Ù†Ù‡'];
    const teens = ['Ø¯Ù‡', 'ÛŒØ§Ø²Ø¯Ù‡', 'Ø¯ÙˆØ§Ø²Ø¯Ù‡', 'Ø³ÛŒØ²Ø¯Ù‡', 'Ú†Ù‡Ø§Ø±Ø¯Ù‡', 'Ù¾Ø§Ù†Ø²Ø¯Ù‡', 'Ø´Ø§Ù†Ø²Ø¯Ù‡', 'Ù‡ÙØ¯Ù‡', 'Ù‡Ø¬Ø¯Ù‡', 'Ù†ÙˆØ²Ø¯Ù‡'];
    const tens = ['', '', 'Ø¨ÛŒØ³Øª', 'Ø³ÛŒ', 'Ú†Ù‡Ù„', 'Ù¾Ù†Ø¬Ø§Ù‡', 'Ø´ØµØª', 'Ù‡ÙØªØ§Ø¯', 'Ù‡Ø´ØªØ§Ø¯', 'Ù†ÙˆØ¯'];
    const hundreds = ['', 'ÛŒÚ©ØµØ¯', 'Ø¯ÙˆÛŒØ³Øª', 'Ø³ÛŒØµØ¯', 'Ú†Ù‡Ø§Ø±ØµØ¯', 'Ù¾Ø§Ù†ØµØ¯', 'Ø´Ø´ØµØ¯', 'Ù‡ÙØªØµØ¯', 'Ù‡Ø´ØªØµØ¯', 'Ù†Ù‡ØµØ¯'];
    if (number === 0) return 'ØµÙØ±';
    const str = number.toString();
    function convertGroup(n) {
        let res = '';
        const h = Math.floor(n / 100);
        const t = n % 100;
        if (h > 0) {
            res += hundreds[h];
            if (t > 0) res += ' Ùˆ ';
        }
        if (t > 0) {
            if (t < 10) res += units[t];
            else if (t < 20) res += teens[t - 10];
            else {
                res += tens[Math.floor(t / 10)];
                if (t % 10 > 0) res += ' Ùˆ ' + units[t % 10];
            }
        }
        return res;
    }
    const parts = [];
    let n = Math.floor(number);
    const scales = ['', ' Ù‡Ø²Ø§Ø±', ' Ù…ÛŒÙ„ÛŒÙˆÙ†', ' Ù…ÛŒÙ„ÛŒØ§Ø±Ø¯', ' ØªØ±ÛŒÙ„ÛŒÙˆÙ†'];
    let scaleIndex = 0;
    while(n > 0) {
        let chunk = n % 1000;
        if(chunk > 0) {
            let chunkStr = convertGroup(chunk);
            parts.push(chunkStr + scales[scaleIndex]);
        }
        n = Math.floor(n / 1000);
        scaleIndex++;
    }
    return parts.reverse().join(' Ùˆ ').trim();
}

function numberToEnglishWords(n) {
    if (n < 0) return "Minus " + numberToEnglishWords(-n);
    if (n === 0) return "Zero";
    const units = ["", "One", "Two", "Three", "Four", "Five", "Six", "Seven", "Eight", "Nine", "Ten", "Eleven", "Twelve", "Thirteen", "Fourteen", "Fifteen", "Sixteen", "Seventeen", "Eighteen", "Nineteen"];
    const tens = ["", "", "Twenty", "Thirty", "Forty", "Fifty", "Sixty", "Seventy", "Eighty", "Ninety"];
    const scales = ["", "Thousand", "Million", "Billion", "Trillion"];
    let result = "";
    let scaleIndex = 0;
    function convertChunk(num) {
        let chunkStr = "";
        if (num >= 100) {
            chunkStr += units[Math.floor(num / 100)] + " Hundred ";
            num %= 100;
        }
        if (num >= 20) {
            chunkStr += tens[Math.floor(num / 10)] + " ";
            num %= 10;
        }
        if (num > 0) {
            chunkStr += units[num] + " ";
        }
        return chunkStr;
    }
    while (n > 0) {
        let chunk = n % 1000;
        if (chunk > 0) {
            let str = convertChunk(chunk).trim();
            result = str + (scales[scaleIndex] ? " " + scales[scaleIndex] : "") + " " + result;
        }
        n = Math.floor(n / 1000);
        scaleIndex++;
    }
    return result.trim();
}

function updateTTAutoWords() {
    const amt = parseInt(document.getElementById('ttAmt').value);
    if (!isNaN(amt)) document.getElementById('ttAmtWords').value = numberToEnglishWords(amt);
    else document.getElementById('ttAmtWords').value = '';
}
const TRANSLATIONS = {
    fa: {
        dir: 'rtl',
        app_title: "ØµØ±Ø§ÙÛŒ Ù‡Ø±Ø§ØªÛŒâ€ŒÙ‡Ø§",
        company_subtitle: "Ø´Ø±Ú©Øª ØµØ±Ø§ÙÛŒ Ùˆ Ø®Ø¯Ù…Ø§Øª Ù¾ÙˆÙ„ÛŒ Ù‡Ø±Ø§ØªÛŒÙ‡Ø§",
        login_btn: "ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ø³ÛŒØ³ØªÙ… (Enter)",
        login_error: "Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø§Ø´ØªØ¨Ø§Ù‡ Ø§Ø³Øª",
        loading_db: "Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù¾Ø§ÛŒÚ¯Ø§Ù‡ Ø¯Ø§Ø¯Ù‡ Ø§Ù…Ù†ÛŒØªÛŒ...",
        nav_dashboard: "ğŸ“Š Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ (F1)",
        nav_hawala: "âœˆï¸ Ø­ÙˆØ§Ù„Ù‡â€ŒØ¬Ø§Øª (F2)",
        nav_accounts: "ğŸ‘¥ Ø­Ø³Ø§Ø¨ Ù…Ø´ØªØ±ÛŒØ§Ù† (F3)",
        nav_tt: "ğŸŒ Ø§Ù†ØªÙ‚Ø§Ù„ Ø§Ø±Ø² (TT) (F6)",
        nav_exchange: "ğŸ’± Ø®Ø±ÛŒØ¯ Ùˆ ÙØ±ÙˆØ´ (FX) (F4)",
        nav_crypto: "ğŸª™ Ø§Ø±Ø² Ø¯ÛŒØ¬ÛŒØªØ§Ù„ (Crypto)",
        nav_reports: "ğŸ“‘ Ú¯Ø²Ø§Ø±Ø´Ø§Øª (Logs)",
        nav_settings: "âš™ï¸ ØªÙ†Ø¸ÛŒÙ…Ø§Øª",
        nav_logout: "ğŸšª Ø®Ø±ÙˆØ¬ Ø§Ù…Ù†",
        lbl_initial_capital: "Ø³Ø±Ù…Ø§ÛŒÙ‡ Ø§ÙˆÙ„ÛŒÙ‡ Ø«Ø¨Øª Ø´Ø¯Ù‡",
        lbl_profit_loss: "Ø³ÙˆØ¯ / Ø²ÛŒØ§Ù† (FX & Crypto)",
        lbl_cash_balance: "Ù…ÙˆØ¬ÙˆØ¯ÛŒ ÙÛŒØ²ÛŒÚ©ÛŒ ØµÙ†Ø¯ÙˆÙ‚ (Ø®Ø²Ø§Ù†Ù‡)",
        lbl_crypto_assets: "Ø¯Ø§Ø±Ø§ÛŒÛŒâ€ŒÙ‡Ø§ÛŒ Ø¯ÛŒØ¬ÛŒØªØ§Ù„ (Crypto Assets)",
        lbl_city_balance: "Ø¨Ø§Ù„Ø§Ù†Ø³ Ú©ØªØ§Ø¨ Ø´Ù‡Ø±Ù‡Ø§ (Ø¨Ø¯Ù‡Ú©Ø§Ø±ÛŒ/Ø¨Ø³ØªØ§Ù†Ú©Ø§Ø±ÛŒ Ù†Ù…Ø§ÛŒÙ†Ø¯Ú¯Ø§Ù†)",
        btn_refresh: "ğŸ”„ Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ",
        msg_city_balance_hint: "* Ø§Ø¹Ø¯Ø§Ø¯ Ù…Ø«Ø¨Øª (Ø³Ø¨Ø²): Ù†Ù…Ø§ÛŒÙ†Ø¯Ù‡ Ø¨Ù‡ Ù…Ø§ Ø¨Ø¯Ù‡Ú©Ø§Ø± Ø§Ø³Øª. Ø§Ø¹Ø¯Ø§Ø¯ Ù…Ù†ÙÛŒ (Ù‚Ø±Ù…Ø²): Ù…Ø§ Ø¨Ù‡ Ù†Ù…Ø§ÛŒÙ†Ø¯Ù‡ Ø¨Ø¯Ù‡Ú©Ø§Ø±ÛŒÙ….",
        lbl_total_commissions: "Ù…Ø¬Ù…ÙˆØ¹ Ú©Ù…ÛŒØ´Ù†â€ŒÙ‡Ø§ÛŒ Ø­ÙˆØ§Ù„Ù‡ (Ø³ÙˆØ¯ Ø®Ø§Ù„Øµ)",
        header_hawala_manage: "Ù…Ø¯ÛŒØ±ÛŒØª Ø­ÙˆØ§Ù„Ù‡â€ŒØ¬Ø§Øª",
        btn_new_hawala: "â• Ø«Ø¨Øª Ø­ÙˆØ§Ù„Ù‡ Ø¬Ø¯ÛŒØ¯ (F9)",
        lbl_filter_city: "ÙÛŒÙ„ØªØ± Ø´Ù‡Ø±",
        lbl_type: "Ù†ÙˆØ¹",
        opt_all: "Ù‡Ù…Ù‡",
        opt_outgoing: "Ø§Ø±Ø³Ø§Ù„ÛŒ (Out)",
        opt_incoming: "Ø¯Ø±ÛŒØ§ÙØªÛŒ (In)",
        lbl_status: "ÙˆØ¶Ø¹ÛŒØª",
        opt_pending: "Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± Ø§Ø¬Ø±Ø§",
        opt_done: "Ø§Ø¬Ø±Ø§/ØªØ³ÙˆÛŒÙ‡ Ø´Ø¯Ù‡",
        btn_excel: "ğŸ“Š Ø§Ú©Ø³Ù„ Ø¹Ø§Ù„ÛŒ",
        btn_print_book: "ğŸ–¨ Ù¾Ø±ÛŒÙ†Øª Ú©ØªØ§Ø¨",
        th_hawala_no: "Ù†Ù…Ø¨Ø± Ø­ÙˆØ§Ù„Ù‡",
        th_type: "Ù†ÙˆØ¹",
        th_city_book: "Ø´Ù‡Ø± / Ú©ØªØ§Ø¨",
        th_amount: "Ù…Ø¨Ù„Øº",
        th_commission: "Ú©Ù…ÛŒØ´Ù†",
        th_reg_date: "ØªØ§Ø±ÛŒØ® Ø«Ø¨Øª",
        th_exec_date: "ØªØ§Ø±ÛŒØ® Ø§Ø¬Ø±Ø§",
        th_status: "ÙˆØ¶Ø¹ÛŒØª",
        th_ops: "Ø¹Ù…Ù„ÛŒØ§Øª",
        header_accounts_manage: "Ù…Ø¯ÛŒØ±ÛŒØª Ø­Ø³Ø§Ø¨ Ù…Ø´ØªØ±ÛŒØ§Ù†",
        lbl_search_customer: "Ø¬Ø³ØªØ¬ÙˆÛŒ Ù…Ø´ØªØ±ÛŒ",
        btn_new_customer: "â• Ù…Ø´ØªØ±ÛŒ Ø¬Ø¯ÛŒØ¯ (F9)",
        btn_deposit_withdraw: "ğŸ’° ÙˆØ§Ø±ÛŒØ²/Ø¨Ø±Ø¯Ø§Ø´Øª",
        btn_transfer: "ğŸ”„ Ø§Ù†ØªÙ‚Ø§Ù„ Ø­Ø³Ø§Ø¨",
        btn_all_accounts: "ğŸ“‹ ÙˆØ¶Ø¹ÛŒØª Ú©Ù„ Ø­Ø³Ø§Ø¨â€ŒÙ‡Ø§",
        lbl_statement: "ØµÙˆØ±Øªâ€ŒØ­Ø³Ø§Ø¨:",
        btn_edit: "âœï¸ ÙˆÛŒØ±Ø§ÛŒØ´",
        btn_delete: "ğŸ—‘ Ø­Ø°Ù",
        btn_print: "ğŸ–¨ Ù¾Ø±ÛŒÙ†Øª",
        th_date: "ØªØ§Ø±ÛŒØ®",
        th_desc: "Ø´Ø±Ø­",
        th_currency: "Ø§Ø±Ø²",
        th_debit: "Ø¨Ø¯Ù‡Ú©Ø§Ø±",
        th_credit: "Ø¨Ø³ØªØ§Ù†Ú©Ø§Ø±",
        th_balance: "Ù…Ø§Ù†Ø¯Ù‡ (ØªØ´Ø®ÛŒØµ)",
        header_tt_app: "Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø­ÙˆØ§Ù„Ù‡ Ø§Ø±Ø²ÛŒ (TT Application)",
        opt_internal_cust: "Ù…Ø´ØªØ±ÛŒ Ø¯Ø§Ø®Ù„ÛŒ (Ø­Ø³Ø§Ø¨Ø¯Ø§Ø±)",
        opt_external_cust: "Ù…Ø´ØªØ±ÛŒ Ø®Ø§Ø±Ø¬ÛŒ (Ù†Ù‚Ø¯ÛŒ)",
        lbl_select_account: "Ø§Ù†ØªØ®Ø§Ø¨ Ø­Ø³Ø§Ø¨ Ù…Ø´ØªØ±ÛŒ (Ø¨Ø±Ø¯Ø§Ø´Øª Ø§Ø² Ø­Ø³Ø§Ø¨)",
        lbl_payer_name: "Ù†Ø§Ù… Ù…Ø´ØªØ±ÛŒ (Ù¾Ø±Ø¯Ø§Ø®Øª Ù†Ù‚Ø¯ÛŒ)",
        lbl_phone: "ØªÙ„ÙÙ† ØªÙ…Ø§Ø³",
        lbl_amount: "Ù…Ø¨Ù„Øº",
        header_beneficiary: "Ù…Ø´Ø®ØµØ§Øª Ø°ÛŒÙ†ÙØ¹ (Beneficiary)",
        lbl_ben_name: "Ù†Ø§Ù… Ø°ÛŒÙ†ÙØ¹ (ÙØ§Ø±Ø³ÛŒ)",
        lbl_desc: "ØªÙˆØ¶ÛŒØ­Ø§Øª ØªÚ©Ù…ÛŒÙ„ÛŒ",
        btn_submit_tt: "Ø«Ø¨Øª Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ùˆ Ø¯Ø±ÛŒØ§ÙØª ÙˆØ¬Ù‡ (F10)",
        btn_print_form: "ğŸ–¨ Ú†Ø§Ù¾ ÙØ±Ù… Ø±Ø³Ù…ÛŒ",
        header_crypto_deal: "Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ø±Ø² Ø¯ÛŒØ¬ÛŒØªØ§Ù„ (Crypto)",
        btn_print_receipt: "ğŸ–¨ Ú†Ø§Ù¾ Ø±Ø³ÛŒØ¯",
        lbl_select_customer: "Ø§Ù†ØªØ®Ø§Ø¨ Ù…Ø´ØªØ±ÛŒ",
        lbl_deal_type: "Ù†ÙˆØ¹ Ù…Ø¹Ø§Ù…Ù„Ù‡",
        opt_buy: "Ø®Ø±ÛŒØ¯ (Ù¾Ø±Ø¯Ø§Ø®Øª Ù¾ÙˆÙ„)",
        opt_sell: "ÙØ±ÙˆØ´ (Ø¯Ø±ÛŒØ§ÙØª Ù¾ÙˆÙ„)",
        lbl_crypto_name: "Ù†Ø§Ù… Ø§Ø±Ø² (USDT)",
        lbl_volume: "Ù…Ù‚Ø¯Ø§Ø± (Volume)",
        lbl_payment_curr: "Ù†ÙˆØ¹ Ø§Ø±Ø² Ù¾Ø±Ø¯Ø§Ø®ØªÛŒ/Ø¯Ø±ÛŒØ§ÙØªÛŒ",
        lbl_total_fiat: "Ù…Ø¨Ù„Øº Ú©Ù„ (Total Fiat)",
        lbl_cost_basis: "Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø³ÙˆØ¯ (ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ ÙØ±ÙˆØ´): Ù‚ÛŒÙ…Øª Ø®Ø±ÛŒØ¯ Ø§ÙˆÙ„ÛŒÙ‡ Ú†Ù‚Ø¯Ø± Ø¨ÙˆØ¯Ù‡ØŸ",
        btn_submit_deal: "Ø«Ø¨Øª Ù†Ù‡Ø§ÛŒÛŒ Ù…Ø¹Ø§Ù…Ù„Ù‡ (F10)",
        header_fx_deal: "Ù…Ø¹Ø§Ù…Ù„Ù‡ Ø§Ø±Ø²ÛŒ (FX Deal Ticket)",
        btn_fx_buy: "Ø®Ø±ÛŒØ¯ (BUY)",
        btn_fx_sell: "ÙØ±ÙˆØ´ (SELL)",
        lbl_rate: "Rate:",
        lbl_total: "Ù…Ø¨Ù„Øº Ù†Ù‡Ø§ÛŒÛŒ (Total)",
        lbl_cash_balance_after: "ØªØ±Ø§Ø² ØµÙ†Ø¯ÙˆÙ‚ Ù¾Ø³ Ø§Ø² Ø§Ù†Ø¬Ø§Ù…",
        lbl_desc_opt: "ØªÙˆØ¶ÛŒØ­Ø§Øª (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)",
        lbl_cost_basis_fx: "Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø³ÙˆØ¯ Ù„Ø­Ø¸Ù‡â€ŒØ§ÛŒ (Cost Basis)",
        header_backup: "Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ (Backup)",
        btn_download_backup: "â¬‡ï¸ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø¨Ú©â€ŒØ¢Ù¾ Ú©Ø§Ù…Ù„",
        btn_restore_backup: "â¬†ï¸ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø¨Ú©â€ŒØ¢Ù¾ (Restore)",
        header_journal: "Ø¯ÙØªØ± Ø±ÙˆØ²Ù†Ø§Ù…Ù‡ (Log) - Ø§Ù…Ú©Ø§Ù† Ø¨Ø§Ø²Ú¯Ø´Øª ØªØ±Ø§Ú©Ù†Ø´",
        btn_print_log: "ğŸ–¨ Ù¾Ø±ÛŒÙ†Øª Ø±Ø³Ù…ÛŒ Ú¯Ø²Ø§Ø±Ø´",
        th_time: "Ø²Ù…Ø§Ù†",
        th_section: "Ø¨Ø®Ø´",
        th_user: "Ú©Ø§Ø±Ø¨Ø±",
        modal_new_hawala: "Ø«Ø¨Øª Ø­ÙˆØ§Ù„Ù‡ Ø¬Ø¯ÛŒØ¯",
        lbl_operation_type: "Ù†ÙˆØ¹ Ø¹Ù…Ù„ÛŒØ§Øª",
        opt_outgoing_full: "Ø§Ø±Ø³Ø§Ù„ (Ø¨Ù‡ Ø´Ù‡Ø± Ø¯ÛŒÚ¯Ø±)",
        opt_incoming_full: "Ø¯Ø±ÛŒØ§ÙØª (Ø§Ø² Ø´Ù‡Ø± Ø¯ÛŒÚ¯Ø±)",
        lbl_city_book: "Ú©ØªØ§Ø¨ Ø´Ù‡Ø± (Ø·Ø±Ù Ø­Ø³Ø§Ø¨)",
        lbl_currency: "Ø§Ø±Ø²",
        lbl_commission: "Ú©Ù…ÛŒØ´Ù† (Ø¯Ø³ØªÛŒ)",
        lbl_sender: "Ù†Ø§Ù… ÙØ±Ø³ØªÙ†Ø¯Ù‡",
        lbl_receiver: "Ù†Ø§Ù… Ú¯ÛŒØ±Ù†Ø¯Ù‡",
        lbl_id_card: "Ø´Ù…Ø§Ø±Ù‡ ØªØ°Ú©Ø±Ù‡/Ù¾Ø§Ø³Ù¾ÙˆØ±Øª",
        btn_cancel: "Ø§Ù†ØµØ±Ø§Ù (Esc)",
        btn_issue_hawala: "ØµØ¯ÙˆØ± Ùˆ Ø«Ø¨Øª (F10)",
        modal_edit_hawala: "ÙˆÛŒØ±Ø§ÛŒØ´ Ø­ÙˆØ§Ù„Ù‡",
        msg_security_warning: "ØªÙˆØ¬Ù‡: Ø¬Ù‡Øª Ø§Ù…Ù†ÛŒØª ØµÙ†Ø¯ÙˆÙ‚ØŒ Ø§Ù…Ú©Ø§Ù† ØªØºÛŒÛŒØ± Ù…Ø¨Ù„Øº ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯. Ø¨Ø±Ø§ÛŒ Ø§ØµÙ„Ø§Ø­ Ù…Ø¨Ù„ØºØŒ Ø­ÙˆØ§Ù„Ù‡ Ø±Ø§ Ø­Ø°Ù Ùˆ Ù…Ø¬Ø¯Ø¯ Ø§ÛŒØ¬Ø§Ø¯ Ú©Ù†ÛŒØ¯.",
        lbl_amount_fixed: "Ù…Ø¨Ù„Øº (ØºÛŒØ±Ù‚Ø§Ø¨Ù„ ØªØºÛŒÛŒØ±)",
        lbl_currency_fixed: "Ø§Ø±Ø² (ØºÛŒØ±Ù‚Ø§Ø¨Ù„ ØªØºÛŒÛŒØ±)",
        btn_save_edit: "Ø«Ø¨Øª ÙˆÛŒØ±Ø§ÛŒØ´ (F10)",
        modal_tx_header: "Ø«Ø¨Øª ØªØ±Ø§Ú©Ù†Ø´ Ø­Ø³Ø§Ø¨ Ù…Ø´ØªØ±ÛŒ",
        lbl_account_party: "Ø·Ø±Ù Ø­Ø³Ø§Ø¨",
        opt_deposit: "ÙˆØ§Ø±ÛŒØ² Ø¨Ù‡ Ø­Ø³Ø§Ø¨ (Ø¯Ø±ÛŒØ§ÙØª Ù¾ÙˆÙ„)",
        opt_withdraw: "Ø¨Ø±Ø¯Ø§Ø´Øª Ø§Ø² Ø­Ø³Ø§Ø¨ (Ù¾Ø±Ø¯Ø§Ø®Øª Ù¾ÙˆÙ„)",
        btn_submit_tx: "Ø«Ø¨Øª Ø³Ù†Ø¯ Ùˆ Ø§Ù†Ø¬Ø§Ù… (F10)",
        btn_close: "Ø¨Ø³ØªÙ† (Esc)",
        modal_transfer_header: "Ø§Ù†ØªÙ‚Ø§Ù„ Ø¨ÛŒÙ† Ø­Ø³Ø§Ø¨ Ù…Ø´ØªØ±ÛŒâ€ŒÙ‡Ø§",
        lbl_source_account: "Ù…Ø¨Ø¯Ø§ (Ú©Ø³Ø± Ø§Ø² Ø­Ø³Ø§Ø¨):",
        lbl_dest_account: "Ù…Ù‚ØµØ¯ (ÙˆØ§Ø±ÛŒØ² Ø¨Ù‡ Ø­Ø³Ø§Ø¨)",
        lbl_transfer_amount: "Ù…Ø¨Ù„Øº Ø§Ù†ØªÙ‚Ø§Ù„",
        btn_do_transfer: "Ø§Ù†Ø¬Ø§Ù… Ø§Ù†ØªÙ‚Ø§Ù„ (F10)",
        modal_new_cust: "Ù…Ø´ØªØ±ÛŒ Ø¬Ø¯ÛŒØ¯",
        lbl_cust_name: "Ù†Ø§Ù… Ú©Ø§Ù…Ù„ Ù…Ø´ØªØ±ÛŒ",
        btn_add_list: "Ø§ÙØ²ÙˆØ¯Ù† Ø¨Ù‡ Ù„ÛŒØ³Øª (F10)",
        modal_edit_cust: "ÙˆÛŒØ±Ø§ÛŒØ´ Ù…Ø´Ø®ØµØ§Øª Ù…Ø´ØªØ±ÛŒ",
        msg_edit_name_warning: "ØªÙˆØ¬Ù‡: ØªØºÛŒÛŒØ± Ù†Ø§Ù… Ø¨Ø§Ø¹Ø« ØªØºÛŒÛŒØ± Ù†Ø§Ù… Ø¯Ø± ØªÙ…Ø§Ù… Ú¯Ø²Ø§Ø±Ø´Ø§Øª Ù‚Ø¨Ù„ÛŒ Ù†ÛŒØ² Ù…ÛŒâ€ŒØ´ÙˆØ¯.",
        lbl_new_name: "Ù†Ø§Ù… Ø¬Ø¯ÛŒØ¯",
        lbl_new_phone: "ØªÙ„ÙÙ† Ø¬Ø¯ÛŒØ¯",
        btn_save_changes: "Ø«Ø¨Øª ØªØºÛŒÛŒØ±Ø§Øª (F10)",
        modal_all_acc_status: "ÙˆØ¶Ø¹ÛŒØª Ú©Ù„ Ø­Ø³Ø§Ø¨â€ŒÙ‡Ø§ÛŒ Ù…Ø´ØªØ±ÛŒØ§Ù†",
        msg_click_to_view: "* Ø¬Ù‡Øª Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø±ÛŒØ²Ø­Ø³Ø§Ø¨ØŒ Ø±ÙˆÛŒ Ú©Ø§Ø±Øª Ù…Ø´ØªØ±ÛŒ Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯.",
        header_settings: "ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø³ÛŒØ³ØªÙ…",
        lbl_print_settings: "ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ú†Ø§Ù¾",
        lbl_print_header_opt: "Ù†Ù…Ø§ÛŒØ´ Â«Ù†Ø§Ù… Ø´Ø±Ú©ØªÂ» Ø¯Ø± Ø³Ø±Ø¨Ø±Ú¯ ØªÙ…Ø§Ù… Ú†Ø§Ù¾â€ŒÙ‡Ø§",
        lbl_initial_capital_set: "Ø³Ø±Ù…Ø§ÛŒÙ‡ Ø§ÙˆÙ„ÛŒÙ‡ (Ø¬Ù‡Øª Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø³ÙˆØ¯/Ø²ÛŒØ§Ù†)",
        btn_save_capital: "Ø«Ø¨Øª Ø³Ø±Ù…Ø§ÛŒÙ‡ Ø§ÙˆÙ„ÛŒÙ‡",
        lbl_user_mgmt: "Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø§Ø±Ø¨Ø±Ø§Ù†",
        lbl_permissions: "Ø³Ø·ÙˆØ­ Ø¯Ø³ØªØ±Ø³ÛŒ:",
        perm_hawala: "Ø­ÙˆØ§Ù„Ù‡â€ŒØ¬Ø§Øª",
        perm_exchange: "Ø®Ø±ÛŒØ¯/ÙØ±ÙˆØ´",
        perm_accounts: "Ø­Ø³Ø§Ø¨ Ù…Ø´ØªØ±ÛŒØ§Ù†",
        perm_tt: "Ø§Ù†ØªÙ‚Ø§Ù„ Ø§Ø±Ø² (TT)",
        perm_admin: "Ø¯Ø³ØªØ±Ø³ÛŒ Ú©Ø§Ù…Ù„ (Ù…Ø¯ÛŒØ±)",
        btn_add_user: "Ø§ÙØ²ÙˆØ¯Ù† Ú©Ø§Ø±Ø¨Ø±",
        lbl_add_city: "Ø§ÙØ²ÙˆØ¯Ù† Ø´Ù‡Ø± (Ú©ØªØ§Ø¨ Ø­ÙˆØ§Ù„Ù‡)",
        btn_add: "Ø§ÙØ²ÙˆØ¯Ù†",
        lbl_delete_city: "Ø­Ø°Ù Ø´Ù‡Ø± (Delete City)",
        msg_city_has_data: "ØªÙˆØ¬Ù‡: Ø§ÛŒÙ† Ø´Ù‡Ø± Ø¯Ø§Ø±Ø§ÛŒ Ø­ÙˆØ§Ù„Ù‡ Ø§Ø³Øª. Ù…Ù‚ØµØ¯ Ø§Ù†ØªÙ‚Ø§Ù„:",
        btn_delete_city: "Ø­Ø°Ù Ø´Ù‡Ø±",
        lbl_currency_mgmt: "Ù…Ø¯ÛŒØ±ÛŒØª Ø§Ø±Ø²Ù‡Ø§ (Ø§ÙØ²ÙˆØ¯Ù† Ùˆ Ø­Ø°Ù)",
        lbl_reset_app: "Ø±ÛŒØ³ØªØ§Ø±Øª Ø¨Ø±Ù†Ø§Ù…Ù‡ (Ø­Ø°Ù ØªÙ…Ø§Ù… Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ùˆ Ù…Ø´ØªØ±ÛŒØ§Ù†)",
        btn_full_reset: "Ø±ÛŒØ³ØªØ§Ø±Øª Ú©Ø§Ù…Ù„ Ø¨Ø±Ù†Ø§Ù…Ù‡",
        lbl_change_pass: "ØªØºÛŒÛŒØ± Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ù…Ù†",
        btn_change_pass: "ØªØºÛŒÛŒØ± Ø±Ù…Ø²"
    },
    en: {
        dir: 'ltr',
        app_title: "Heratiha Exchange",
        company_subtitle: "Money Exchange & Services Co.",
        login_btn: "Login (Enter)",
        login_error: "Invalid Credentials",
        loading_db: "Loading Secure Database...",
        nav_dashboard: "ğŸ“Š Dashboard (F1)",
        nav_hawala: "âœˆï¸ Hawala (F2)",
        nav_accounts: "ğŸ‘¥ Accounts (F3)",
        nav_tt: "ğŸŒ TT Transfer (F6)",
        nav_exchange: "ğŸ’± Exchange (FX) (F4)",
        nav_crypto: "ğŸª™ Crypto Assets",
        nav_reports: "ğŸ“‘ Reports (Logs)",
        nav_settings: "âš™ï¸ Settings",
        nav_logout: "ğŸšª Secure Logout",
        lbl_initial_capital: "Initial Capital Registered",
        lbl_profit_loss: "Profit / Loss (FX & Crypto)",
        lbl_cash_balance: "Physical Cash Balance (Vault)",
        lbl_crypto_assets: "Digital Assets (Crypto)",
        lbl_city_balance: "City Ledgers Balance (Agents)",
        btn_refresh: "ğŸ”„ Refresh",
        msg_city_balance_hint: "* Positive (Green): Agent owes us. Negative (Red): We owe agent.",
        lbl_total_commissions: "Total Hawala Commissions (Net Profit)",
        header_hawala_manage: "Hawala Management",
        btn_new_hawala: "â• New Hawala (F9)",
        lbl_filter_city: "Filter City",
        lbl_type: "Type",
        opt_all: "All",
        opt_outgoing: "Outgoing",
        opt_incoming: "Incoming",
        lbl_status: "Status",
        opt_pending: "Pending",
        opt_done: "Done/Settled",
        btn_excel: "ğŸ“Š Export Excel",
        btn_print_book: "ğŸ–¨ Print Book",
        th_hawala_no: "Hawala No",
        th_type: "Type",
        th_city_book: "City/Book",
        th_amount: "Amount",
        th_commission: "Comm",
        th_reg_date: "Date",
        th_exec_date: "Exec Date",
        th_status: "Status",
        th_ops: "Actions",
        header_accounts_manage: "Customer Accounts",
        lbl_search_customer: "Search Customer",
        btn_new_customer: "â• New Customer (F9)",
        btn_deposit_withdraw: "ğŸ’° Dep/Withdraw",
        btn_transfer: "ğŸ”„ Transfer",
        btn_all_accounts: "ğŸ“‹ All Balances",
        lbl_statement: "Statement:",
        btn_edit: "âœï¸ Edit",
        btn_delete: "ğŸ—‘ Delete",
        btn_print: "ğŸ–¨ Print",
        th_date: "Date",
        th_desc: "Description",
        th_currency: "Curr",
        th_debit: "Debit",
        th_credit: "Credit",
        th_balance: "Balance",
        header_tt_app: "TT Application Form",
        opt_internal_cust: "Internal Customer (Account)",
        opt_external_cust: "Walk-in Customer (Cash)",
        lbl_select_account: "Select Account (Debit)",
        lbl_payer_name: "Payer Name (Cash)",
        lbl_phone: "Phone Number",
        lbl_amount: "Amount",
        header_beneficiary: "Beneficiary Details",
        lbl_ben_name: "Beneficiary Name",
        lbl_desc: "Additional Description",
        btn_submit_tt: "Submit Application (F10)",
        btn_print_form: "ğŸ–¨ Print Official Form",
        header_crypto_deal: "Crypto Currency Deals",
        btn_print_receipt: "ğŸ–¨ Print Receipt",
        lbl_select_customer: "Select Customer",
        lbl_deal_type: "Deal Type",
        opt_buy: "Buy (Pay Cash)",
        opt_sell: "Sell (Receive Cash)",
        lbl_crypto_name: "Asset Name (USDT)",
        lbl_volume: "Volume",
        lbl_payment_curr: "Payment Currency",
        lbl_total_fiat: "Total Fiat Amount",
        lbl_cost_basis: "Profit Calc (For Sells): Buy Price?",
        btn_submit_deal: "Submit Deal (F10)",
        header_fx_deal: "FX Deal Ticket",
        btn_fx_buy: "BUY",
        btn_fx_sell: "SELL",
        lbl_rate: "Rate:",
        lbl_total: "Total Amount",
        lbl_cash_balance_after: "Vault Balance After Deal",
        lbl_desc_opt: "Description (Optional)",
        lbl_cost_basis_fx: "Est. Profit Calc (Cost Basis)",
        header_backup: "Backup & Restore",
        btn_download_backup: "â¬‡ï¸ Download Full Backup",
        btn_restore_backup: "â¬†ï¸ Restore Backup",
        header_journal: "Journal Log (Reversal)",
        btn_print_log: "ğŸ–¨ Print Journal",
        th_time: "Time",
        th_section: "Section",
        th_user: "User",
        modal_new_hawala: "New Hawala Entry",
        lbl_operation_type: "Operation Type",
        opt_outgoing_full: "Outgoing (Send)",
        opt_incoming_full: "Incoming (Receive)",
        lbl_city_book: "City Book",
        lbl_currency: "Currency",
        lbl_commission: "Commission",
        lbl_sender: "Sender Name",
        lbl_receiver: "Receiver Name",
        lbl_id_card: "ID Card / Passport",
        btn_cancel: "Cancel (Esc)",
        btn_issue_hawala: "Issue & Save (F10)",
        modal_edit_hawala: "Edit Hawala",
        msg_security_warning: "Security: Amount cannot be changed. Delete and re-create if needed.",
        lbl_amount_fixed: "Amount (Fixed)",
        lbl_currency_fixed: "Currency (Fixed)",
        btn_save_edit: "Save Changes (F10)",
        modal_tx_header: "Customer Transaction",
        lbl_account_party: "Account Holder",
        opt_deposit: "Deposit (Receive Cash)",
        opt_withdraw: "Withdraw (Pay Cash)",
        btn_submit_tx: "Submit Transaction (F10)",
        btn_close: "Close (Esc)",
        modal_transfer_header: "Internal Transfer",
        lbl_source_account: "From (Debit):",
        lbl_dest_account: "To (Credit)",
        lbl_transfer_amount: "Transfer Amount",
        btn_do_transfer: "Execute Transfer (F10)",
        modal_new_cust: "New Customer",
        lbl_cust_name: "Full Name",
        btn_add_list: "Add to List (F10)",
        modal_edit_cust: "Edit Customer",
        msg_edit_name_warning: "Warning: Changing name updates all past records.",
        lbl_new_name: "New Name",
        lbl_new_phone: "New Phone",
        btn_save_changes: "Save Changes (F10)",
        modal_all_acc_status: "All Accounts Status",
        msg_click_to_view: "* Click on a customer card to view ledger.",
        header_settings: "System Settings",
        lbl_print_settings: "Print Settings",
        lbl_print_header_opt: "Show Company Name on Header",
        lbl_initial_capital_set: "Initial Capital (Profit Calc)",
        btn_save_capital: "Save Capital",
        lbl_user_mgmt: "User Management",
        lbl_permissions: "Permissions:",
        perm_hawala: "Hawala",
        perm_exchange: "Exchange",
        perm_accounts: "Accounts",
        perm_tt: "TT Transfer",
        perm_admin: "Full Admin",
        btn_add_user: "Add User",
        lbl_add_city: "Add City",
        btn_add: "Add",
        lbl_delete_city: "Delete City",
        msg_city_has_data: "City has data. Transfer to:",
        btn_delete_city: "Delete City",
        lbl_currency_mgmt: "Currency Management",
        lbl_reset_app: "Factory Reset (Wipe Data)",
        btn_full_reset: "Full Reset",
        lbl_change_pass: "Change My Password",
        btn_change_pass: "Change Password"
    },
    tr: {
        dir: 'ltr',
        app_title: "Heratiha DÃ¶viz",
        company_subtitle: "Para Transfer ve DÃ¶viz Hizmetleri",
        login_btn: "GiriÅŸ (Enter)",
        login_error: "HatalÄ± Bilgi",
        loading_db: "VeritabanÄ± YÃ¼kleniyor...",
        nav_dashboard: "ğŸ“Š GÃ¶sterge Paneli",
        nav_hawala: "âœˆï¸ Havale (F2)",
        nav_accounts: "ğŸ‘¥ MÃ¼ÅŸteri HesaplarÄ±",
        nav_tt: "ğŸŒ TT Transfer",
        nav_exchange: "ğŸ’± DÃ¶viz AlÄ±m/SatÄ±m",
        nav_crypto: "ğŸª™ Kripto Para",
        nav_reports: "ğŸ“‘ Raporlar",
        nav_settings: "âš™ï¸ Ayarlar",
        nav_logout: "ğŸšª Ã‡Ä±kÄ±ÅŸ",
        lbl_initial_capital: "KayÄ±tlÄ± Sermaye",
        lbl_profit_loss: "Kar / Zarar",
        lbl_cash_balance: "Kasa Bakiyesi",
        lbl_crypto_assets: "Dijital VarlÄ±klar",
        lbl_city_balance: "Åehir Bakiyeleri",
        btn_refresh: "ğŸ”„ Yenile",
        msg_city_balance_hint: "* YeÅŸil: AlacaklÄ±yÄ±z. KÄ±rmÄ±zÄ±: BorÃ§luyuz.",
        lbl_total_commissions: "Toplam Komisyonlar",
        header_hawala_manage: "Havale YÃ¶netimi",
        btn_new_hawala: "â• Yeni Havale (F9)",
        lbl_filter_city: "Åehir Filtrele",
        lbl_type: "Tip",
        opt_all: "Hepsi",
        opt_outgoing: "Giden (Out)",
        opt_incoming: "Gelen (In)",
        lbl_status: "Durum",
        opt_pending: "Beklemede",
        opt_done: "TamamlandÄ±",
        btn_excel: "ğŸ“Š Excel Ä°ndir",
        btn_print_book: "ğŸ–¨ YazdÄ±r",
        th_hawala_no: "Havale No",
        th_type: "Tip",
        th_city_book: "Åehir",
        th_amount: "Tutar",
        th_commission: "Komisyon",
        th_reg_date: "Tarih",
        th_exec_date: "Ä°ÅŸlem Tarihi",
        th_status: "Durum",
        th_ops: "Ä°ÅŸlem",
        header_accounts_manage: "Hesap YÃ¶netimi",
        lbl_search_customer: "MÃ¼ÅŸteri Ara",
        btn_new_customer: "â• Yeni MÃ¼ÅŸteri",
        btn_deposit_withdraw: "ğŸ’° YatÄ±r/Ã‡ek",
        btn_transfer: "ğŸ”„ Transfer",
        btn_all_accounts: "ğŸ“‹ TÃ¼m Hesaplar",
        lbl_statement: "Ekstre:",
        btn_edit: "âœï¸ DÃ¼zenle",
        btn_delete: "ğŸ—‘ Sil",
        btn_print: "ğŸ–¨ YazdÄ±r",
        th_date: "Tarih",
        th_desc: "AÃ§Ä±klama",
        th_currency: "DÃ¶viz",
        th_debit: "BorÃ§",
        th_credit: "Alacak",
        th_balance: "Bakiye",
        header_tt_app: "TT Transfer Formu",
        opt_internal_cust: "KayÄ±tlÄ± MÃ¼ÅŸteri",
        opt_external_cust: "Nakit MÃ¼ÅŸteri",
        lbl_select_account: "Hesap SeÃ§imi",
        lbl_payer_name: "Ã–deyen AdÄ±",
        lbl_phone: "Telefon",
        lbl_amount: "Tutar",
        header_beneficiary: "AlÄ±cÄ± Bilgileri",
        lbl_ben_name: "AlÄ±cÄ± AdÄ±",
        lbl_desc: "AÃ§Ä±klama",
        btn_submit_tt: "Onayla ve GÃ¶nder (F10)",
        btn_print_form: "ğŸ–¨ Form YazdÄ±r",
        header_crypto_deal: "Kripto Ä°ÅŸlemleri",
        btn_print_receipt: "ğŸ–¨ Makbuz",
        lbl_select_customer: "MÃ¼ÅŸteri SeÃ§",
        lbl_deal_type: "Ä°ÅŸlem Tipi",
        opt_buy: "AlÄ±ÅŸ",
        opt_sell: "SatÄ±ÅŸ",
        lbl_crypto_name: "Kripto (USDT)",
        lbl_volume: "Miktar",
        lbl_payment_curr: "Ã–deme Birimi",
        lbl_total_fiat: "Toplam Tutar",
        lbl_cost_basis: "Maliyet (Kar Hesaplama)",
        btn_submit_deal: "Kaydet (F10)",
        header_fx_deal: "DÃ¶viz Ä°ÅŸlemi",
        btn_fx_buy: "ALIÅ",
        btn_fx_sell: "SATIÅ",
        lbl_rate: "Kur:",
        lbl_total: "SonuÃ§",
        lbl_cash_balance_after: "Ä°ÅŸlem SonrasÄ± Kasa",
        lbl_desc_opt: "Not",
        lbl_cost_basis_fx: "Kar Hesaplama (Opsiyonel)",
        header_backup: "Yedekleme",
        btn_download_backup: "â¬‡ï¸ Ä°ndir",
        btn_restore_backup: "â¬†ï¸ YÃ¼kle",
        header_journal: "Ä°ÅŸlem GÃ¼nlÃ¼ÄŸÃ¼",
        btn_print_log: "ğŸ–¨ GÃ¼nlÃ¼k YazdÄ±r",
        th_time: "Saat",
        th_section: "BÃ¶lÃ¼m",
        th_user: "KullanÄ±cÄ±",
        modal_new_hawala: "Yeni Havale",
        lbl_operation_type: "Ä°ÅŸlem TÃ¼rÃ¼",
        opt_outgoing_full: "GÃ¶nderim",
        opt_incoming_full: "AlÄ±m",
        lbl_city_book: "Åehir KitabÄ±",
        lbl_currency: "Para Birimi",
        lbl_commission: "Komisyon",
        lbl_sender: "GÃ¶nderen",
        lbl_receiver: "AlÄ±cÄ±",
        lbl_id_card: "Kimlik No",
        btn_cancel: "Ä°ptal",
        btn_issue_hawala: "OluÅŸtur",
        modal_edit_hawala: "Havale DÃ¼zenle",
        msg_security_warning: "GÃ¼venlik: Tutar deÄŸiÅŸtirilemez.",
        lbl_amount_fixed: "Tutar (Sabit)",
        lbl_currency_fixed: "Para Birimi (Sabit)",
        btn_save_edit: "Kaydet",
        modal_tx_header: "Hesap Ä°ÅŸlemi",
        lbl_account_party: "Hesap Sahibi",
        opt_deposit: "Para YatÄ±rma",
        opt_withdraw: "Para Ã‡ekme",
        btn_submit_tx: "Onayla",
        btn_close: "Kapat",
        modal_transfer_header: "Transfer",
        lbl_source_account: "GÃ¶nderen:",
        lbl_dest_account: "AlÄ±cÄ±:",
        lbl_transfer_amount: "Tutar",
        btn_do_transfer: "Transfer Et",
        modal_new_cust: "Yeni MÃ¼ÅŸteri",
        lbl_cust_name: "Ad Soyad",
        btn_add_list: "Ekle",
        modal_edit_cust: "MÃ¼ÅŸteri DÃ¼zenle",
        msg_edit_name_warning: "UyarÄ±: Ä°sim deÄŸiÅŸirse eski kayÄ±tlar da gÃ¼ncellenir.",
        lbl_new_name: "Yeni Ä°sim",
        lbl_new_phone: "Yeni Telefon",
        btn_save_changes: "Kaydet",
        modal_all_acc_status: "Hesap DurumlarÄ±",
        msg_click_to_view: "* Detay iÃ§in tÄ±klayÄ±n",
        header_settings: "Ayarlar",
        lbl_print_settings: "YazdÄ±rma AyarlarÄ±",
        lbl_print_header_opt: "BaÅŸlÄ±kta Åirket AdÄ± GÃ¶ster",
        lbl_initial_capital_set: "BaÅŸlangÄ±Ã§ Sermayesi",
        btn_save_capital: "Kaydet",
        lbl_user_mgmt: "KullanÄ±cÄ± YÃ¶netimi",
        lbl_permissions: "Yetkiler:",
        perm_hawala: "Havale",
        perm_exchange: "DÃ¶viz",
        perm_accounts: "Hesaplar",
        perm_tt: "TT",
        perm_admin: "YÃ¶netici",
        btn_add_user: "Ekle",
        lbl_add_city: "Åehir Ekle",
        btn_add: "Ekle",
        lbl_delete_city: "Åehir Sil",
        msg_city_has_data: "Bu ÅŸehirde veri var. Transfer et:",
        btn_delete_city: "Sil",
        lbl_currency_mgmt: "DÃ¶viz YÃ¶netimi",
        lbl_reset_app: "SÄ±fÄ±rla",
        btn_full_reset: "Tam SÄ±fÄ±rlama",
        lbl_change_pass: "Åifre DeÄŸiÅŸtir",
        btn_change_pass: "DeÄŸiÅŸtir"
    },
    ar: {
        dir: 'rtl',
        app_title: "ØµØ±Ø§ÙØ© Ø§Ù„Ù‡Ø±Ø§ØªÙŠÙŠÙ†",
        company_subtitle: "Ø´Ø±ÙƒØ© Ù‡Ø±Ø§Øª Ù„Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ© ÙˆØ§Ù„ØµØ±Ø§ÙØ©",
        login_btn: "Ø¯Ø®ÙˆÙ„ (Enter)",
        login_error: "Ø¨ÙŠØ§Ù†Ø§Øª Ø®Ø§Ø·Ø¦Ø©",
        loading_db: "Ø¬Ø§Ø± ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...",
        nav_dashboard: "ğŸ“Š Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…",
        nav_hawala: "âœˆï¸ Ø§Ù„Ø­ÙˆØ§Ù„Ø§Øª (F2)",
        nav_accounts: "ğŸ‘¥ Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ (F3)",
        nav_tt: "ğŸŒ Ø­ÙˆØ§Ù„Ø§Øª Ø®Ø§Ø±Ø¬ÙŠØ© (TT)",
        nav_exchange: "ğŸ’± Ø¨ÙŠØ¹ ÙˆØ´Ø±Ø§Ø¡ (FX)",
        nav_crypto: "ğŸª™ Ø§Ù„Ø¹Ù…Ù„Ø§Øª Ø§Ù„Ø±Ù‚Ù…ÙŠØ©",
        nav_reports: "ğŸ“‘ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±",
        nav_settings: "âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª",
        nav_logout: "ğŸšª Ø®Ø±ÙˆØ¬",
        lbl_initial_capital: "Ø±Ø£Ø³ Ø§Ù„Ù…Ø§Ù„ Ø§Ù„Ù…Ø³Ø¬Ù„",
        lbl_profit_loss: "Ø§Ù„Ø±Ø¨Ø­ / Ø§Ù„Ø®Ø³Ø§Ø±Ø©",
        lbl_cash_balance: "Ø±ØµÙŠØ¯ Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù†Ù‚Ø¯ÙŠ",
        lbl_crypto_assets: "Ø§Ù„Ø£ØµÙˆÙ„ Ø§Ù„Ø±Ù‚Ù…ÙŠØ©",
        lbl_city_balance: "Ø£Ø±ØµØ¯Ø© Ø§Ù„Ù…Ø¯Ù† ÙˆØ§Ù„ÙØ±ÙˆØ¹",
        btn_refresh: "ğŸ”„ ØªØ­Ø¯ÙŠØ«",
        msg_city_balance_hint: "* Ø§Ù„Ø£Ø®Ø¶Ø±: Ù„Ù†Ø§ØŒ Ø§Ù„Ø£Ø­Ù…Ø±: Ø¹Ù„ÙŠÙ†Ø§.",
        lbl_total_commissions: "Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ø¹Ù…ÙˆÙ„Ø§Øª (Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„ØµØ§ÙÙŠ)",
        header_hawala_manage: "Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­ÙˆØ§Ù„Ø§Øª",
        btn_new_hawala: "â• Ø­ÙˆØ§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø© (F9)",
        lbl_filter_city: "ÙÙ„ØªØ± Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©",
        lbl_type: "Ø§Ù„Ù†ÙˆØ¹",
        opt_all: "Ø§Ù„ÙƒÙ„",
        opt_outgoing: "ØµØ§Ø¯Ø±Ø©",
        opt_incoming: "ÙˆØ§Ø±Ø¯Ø©",
        lbl_status: "Ø§Ù„Ø­Ø§Ù„Ø©",
        opt_pending: "Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±",
        opt_done: "Ù…ÙƒØªÙ…Ù„Ø©",
        btn_excel: "ğŸ“Š Ù…Ù„Ù Ø¥ÙƒØ³Ù„",
        btn_print_book: "ğŸ–¨ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ÙƒØ´Ù",
        th_hawala_no: "Ø±Ù‚Ù… Ø§Ù„Ø­ÙˆØ§Ù„Ø©",
        th_type: "Ø§Ù„Ù†ÙˆØ¹",
        th_city_book: "Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©",
        th_amount: "Ø§Ù„Ù…Ø¨Ù„Øº",
        th_commission: "Ø§Ù„Ø¹Ù…ÙˆÙ„Ø©",
        th_reg_date: "Ø§Ù„ØªØ§Ø±ÙŠØ®",
        th_exec_date: "ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ†ÙÙŠØ°",
        th_status: "Ø§Ù„Ø­Ø§Ù„Ø©",
        th_ops: "Ø¹Ù…Ù„ÙŠØ§Øª",
        header_accounts_manage: "Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª",
        lbl_search_customer: "Ø¨Ø­Ø« Ø¹Ù† Ø¹Ù…ÙŠÙ„",
        btn_new_customer: "â• Ø¹Ù…ÙŠÙ„ Ø¬Ø¯ÙŠØ¯",
        btn_deposit_withdraw: "ğŸ’° Ø¥ÙŠØ¯Ø§Ø¹/Ø³Ø­Ø¨",
        btn_transfer: "ğŸ”„ ØªØ­ÙˆÙŠÙ„",
        btn_all_accounts: "ğŸ“‹ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø±ØµØ¯Ø©",
        lbl_statement: "ÙƒØ´Ù Ø­Ø³Ø§Ø¨:",
        btn_edit: "âœï¸ ØªØ¹Ø¯ÙŠÙ„",
        btn_delete: "ğŸ—‘ Ø­Ø°Ù",
        btn_print: "ğŸ–¨ Ø·Ø¨Ø§Ø¹Ø©",
        th_date: "Ø§Ù„ØªØ§Ø±ÙŠØ®",
        th_desc: "Ø§Ù„Ø¨ÙŠØ§Ù†",
        th_currency: "Ø§Ù„Ø¹Ù…Ù„Ø©",
        th_debit: "Ù…Ø¯ÙŠÙ† (Ø¹Ù„ÙŠÙ‡)",
        th_credit: "Ø¯Ø§Ø¦Ù† (Ù„Ù‡)",
        th_balance: "Ø§Ù„Ø±ØµÙŠØ¯",
        header_tt_app: "Ø·Ù„Ø¨ Ø­ÙˆØ§Ù„Ø© Ø®Ø§Ø±Ø¬ÙŠØ© (TT)",
        opt_internal_cust: "Ø¹Ù…ÙŠÙ„ Ù…Ø³Ø¬Ù„",
        opt_external_cust: "Ø¹Ù…ÙŠÙ„ Ù†Ù‚Ø¯ÙŠ",
        lbl_select_account: "Ø§Ø®ØªØ± Ø§Ù„Ø­Ø³Ø§Ø¨ (Ø®ØµÙ…)",
        lbl_payer_name: "Ø§Ø³Ù… Ø§Ù„Ø¯Ø§ÙØ¹ (Ù†Ù‚Ø¯ÙŠ)",
        lbl_phone: "Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ",
        lbl_amount: "Ø§Ù„Ù…Ø¨Ù„Øº",
        header_beneficiary: "Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªÙÙŠØ¯",
        lbl_ben_name: "Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙÙŠØ¯",
        lbl_desc: "Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©",
        btn_submit_tt: "ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨ (F10)",
        btn_print_form: "ğŸ–¨ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø±Ø©",
        header_crypto_deal: "Ø§Ù„Ø¹Ù…Ù„Ø§Øª Ø§Ù„Ù…Ø´ÙØ±Ø© (Crypto)",
        btn_print_receipt: "ğŸ–¨ Ø¥ÙŠØµØ§Ù„",
        lbl_select_customer: "Ø§Ø®ØªØ± Ø§Ù„Ø¹Ù…ÙŠÙ„",
        lbl_deal_type: "Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©",
        opt_buy: "Ø´Ø±Ø§Ø¡",
        opt_sell: "Ø¨ÙŠØ¹",
        lbl_crypto_name: "Ø§Ø³Ù… Ø§Ù„Ø¹Ù…Ù„Ø© (USDT)",
        lbl_volume: "Ø§Ù„ÙƒÙ…ÙŠØ©",
        lbl_payment_curr: "Ø¹Ù…Ù„Ø© Ø§Ù„Ø¯ÙØ¹/Ø§Ù„Ù‚Ø¨Ø¶",
        lbl_total_fiat: "Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ",
        lbl_cost_basis: "Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡ (Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø±Ø¨Ø­)",
        btn_submit_deal: "ØªÙ†ÙÙŠØ° (F10)",
        header_fx_deal: "Ø´Ø§Ø´Ø© Ø§Ù„ØµØ±Ø§ÙØ© (FX)",
        btn_fx_buy: "Ø´Ø±Ø§Ø¡ (BUY)",
        btn_fx_sell: "Ø¨ÙŠØ¹ (SELL)",
        lbl_rate: "Ø§Ù„Ø³Ø¹Ø±:",
        lbl_total: "Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ",
        lbl_cash_balance_after: "Ø§Ù„Ø±ØµÙŠØ¯ Ø¨Ø¹Ø¯ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©",
        lbl_desc_opt: "Ù…Ù„Ø§Ø­Ø¸Ø§Øª",
        lbl_cost_basis_fx: "Ø­Ø³Ø§Ø¨ Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„Ù„Ø­Ø¸ÙŠ",
        header_backup: "Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ",
        btn_download_backup: "â¬‡ï¸ ØªØ­Ù…ÙŠÙ„ Ù†Ø³Ø®Ø©",
        btn_restore_backup: "â¬†ï¸ Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ù†Ø³Ø®Ø©",
        header_journal: "Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª (Journal)",
        btn_print_log: "ğŸ–¨ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø³Ø¬Ù„",
        th_time: "Ø§Ù„ÙˆÙ‚Øª",
        th_section: "Ø§Ù„Ù‚Ø³Ù…",
        th_user: "Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…",
        modal_new_hawala: "ØªØ³Ø¬ÙŠÙ„ Ø­ÙˆØ§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø©",
        lbl_operation_type: "Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©",
        opt_outgoing_full: "Ø¥Ø±Ø³Ø§Ù„ (ØµØ§Ø¯Ø±Ø©)",
        opt_incoming_full: "Ø§Ø³ØªÙ„Ø§Ù… (ÙˆØ§Ø±Ø¯Ø©)",
        lbl_city_book: "Ø¯ÙØªØ± Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©",
        lbl_currency: "Ø§Ù„Ø¹Ù…Ù„Ø©",
        lbl_commission: "Ø§Ù„Ø¹Ù…ÙˆÙ„Ø©",
        lbl_sender: "Ø§Ø³Ù… Ø§Ù„Ù…Ø±Ø³Ù„",
        lbl_receiver: "Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙ„Ù…",
        lbl_id_card: "Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©",
        btn_cancel: "Ø¥Ù„ØºØ§Ø¡",
        btn_issue_hawala: "Ø¥ØµØ¯Ø§Ø± (F10)",
        modal_edit_hawala: "ØªØ¹Ø¯ÙŠÙ„ Ø­ÙˆØ§Ù„Ø©",
        msg_security_warning: "Ù„Ø£Ù…Ø§Ù† Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ØŒ Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØºÙŠÙŠØ± Ø§Ù„Ù…Ø¨Ù„Øº.",
        lbl_amount_fixed: "Ø§Ù„Ù…Ø¨Ù„Øº (Ø«Ø§Ø¨Øª)",
        lbl_currency_fixed: "Ø§Ù„Ø¹Ù…Ù„Ø© (Ø«Ø§Ø¨ØªØ©)",
        btn_save_edit: "Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„",
        modal_tx_header: "Ø­Ø±ÙƒØ© Ø­Ø³Ø§Ø¨",
        lbl_account_party: "ØµØ§Ø­Ø¨ Ø§Ù„Ø­Ø³Ø§Ø¨",
        opt_deposit: "Ø¥ÙŠØ¯Ø§Ø¹ (Ù‚Ø¨Ø¶)",
        opt_withdraw: "Ø³Ø­Ø¨ (Ø¯ÙØ¹)",
        btn_submit_tx: "ØªÙ†ÙÙŠØ°",
        btn_close: "Ø¥ØºÙ„Ø§Ù‚",
        modal_transfer_header: "ØªØ­ÙˆÙŠÙ„ Ø¯Ø§Ø®Ù„ÙŠ",
        lbl_source_account: "Ù…Ù† Ø­Ø³Ø§Ø¨:",
        lbl_dest_account: "Ø¥Ù„Ù‰ Ø­Ø³Ø§Ø¨:",
        lbl_transfer_amount: "Ù…Ø¨Ù„Øº Ø§Ù„ØªØ­ÙˆÙŠÙ„",
        btn_do_transfer: "ØªØ­ÙˆÙŠÙ„",
        modal_new_cust: "Ø¹Ù…ÙŠÙ„ Ø¬Ø¯ÙŠØ¯",
        lbl_cust_name: "Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„",
        btn_add_list: "Ø¥Ø¶Ø§ÙØ©",
        modal_edit_cust: "ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù…ÙŠÙ„",
        msg_edit_name_warning: "ØªÙ†Ø¨ÙŠÙ‡: ØªØºÙŠÙŠØ± Ø§Ù„Ø§Ø³Ù… Ø³ÙŠØ­Ø¯Ø« Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©.",
        lbl_new_name: "Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯",
        lbl_new_phone: "Ø§Ù„Ù‡Ø§ØªÙ Ø§Ù„Ø¬Ø¯ÙŠØ¯",
        btn_save_changes: "Ø­ÙØ¸",
        modal_all_acc_status: "Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª",
        msg_click_to_view: "* Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù…ÙŠÙ„ Ù„Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„.",
        header_settings: "Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª",
        lbl_print_settings: "Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©",
        lbl_print_header_opt: "Ø¥Ø¸Ù‡Ø§Ø± Ø§Ø³Ù… Ø§Ù„Ø´Ø±ÙƒØ© ÙÙŠ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©",
        lbl_initial_capital_set: "Ø±Ø£Ø³ Ø§Ù„Ù…Ø§Ù„ Ø§Ù„Ø£ÙˆÙ„ÙŠ",
        btn_save_capital: "Ø­ÙØ¸",
        lbl_user_mgmt: "Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†",
        lbl_permissions: "Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª:",
        perm_hawala: "Ø§Ù„Ø­ÙˆØ§Ù„Ø§Øª",
        perm_exchange: "Ø§Ù„ØµØ±Ø§ÙØ©",
        perm_accounts: "Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª",
        perm_tt: "TT",
        perm_admin: "Ù…Ø¯ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù…",
        btn_add_user: "Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù…",
        lbl_add_city: "Ø¥Ø¶Ø§ÙØ© Ù…Ø¯ÙŠÙ†Ø©",
        btn_add: "Ø¥Ø¶Ø§ÙØ©",
        lbl_delete_city: "Ø­Ø°Ù Ù…Ø¯ÙŠÙ†Ø©",
        msg_city_has_data: "ÙŠÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©. Ø§Ù†Ù‚Ù„ Ø¥Ù„Ù‰:",
        btn_delete_city: "Ø­Ø°Ù",
        lbl_currency_mgmt: "Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Øª",
        lbl_reset_app: "Ø¶Ø¨Ø· Ø§Ù„Ù…ØµÙ†Ø¹",
        btn_full_reset: "Ø­Ø°Ù ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª",
        lbl_change_pass: "ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±",
        btn_change_pass: "ØªØºÙŠÙŠØ±"
    }
};

let currentLang = localStorage.getItem('heratiha_lang') || 'fa';

function setLanguage(lang) {
    if(!TRANSLATIONS[lang]) return;
    currentLang = lang;
    localStorage.setItem('heratiha_lang', lang);
    document.documentElement.lang = lang;
    document.documentElement.dir = TRANSLATIONS[lang].dir;
    document.querySelectorAll('.lang-btn').forEach(btn => btn.classList.remove('active'));
    const activeBtn = document.getElementById(`btn-lang-${lang}`);
    if(activeBtn) activeBtn.classList.add('active');
    applyTranslations();
}

function applyTranslations() {
    const t = TRANSLATIONS[currentLang];
    document.querySelectorAll('[data-i18n]').forEach(el => {
        const key = el.getAttribute('data-i18n');
        if(t[key]) {
            if(el.tagName === 'INPUT' && el.getAttribute('placeholder')) {
                el.placeholder = t[key];
            } else {
                el.innerText = t[key];
            }
        }
    });
    if(document.getElementById('mainApp').style.display === 'flex') {
        updateUI(); 
    }
}
class DBAdapter {
    constructor(dbName, version) { this.dbName = dbName; this.version = version; this.db = null; }
    async init() {
        return new Promise((resolve, reject) => {
            const request = indexedDB.open(this.dbName, this.version);
            request.onupgradeneeded = (event) => {
                const db = event.target.result;
                ['users', 'customers', 'cashBox', 'currencies', 'hawalas', 'accounts', 'journal', 'cities', 'initialCapital', 'cityHawalaCounters', 'fxProfit', 'settings'].forEach(store => {
                    if (!db.objectStoreNames.contains(store)) db.createObjectStore(store);
                });
            };
            request.onsuccess = (e) => { this.db = e.target.result; resolve(); };
            request.onerror = (e) => reject(e.target.error);
        });
    }
    async loadAll() {
        const data = {};
        const stores = ['users', 'customers', 'cashBox', 'currencies', 'hawalas', 'accounts', 'journal', 'cities', 'initialCapital', 'cityHawalaCounters', 'fxProfit', 'settings'];
        const tx = this.db.transaction(stores, 'readonly');
        const promises = stores.map(store => new Promise(resolve => {
            const req = tx.objectStore(store).get('root');
            req.onsuccess = (e) => resolve({ [store]: e.target.result });
            req.onerror = () => resolve({ [store]: null });
        }));
        (await Promise.all(promises)).forEach(res => Object.assign(data, res));
        return data;
    }
    async saveAll(dbObj) {
        const stores = Object.keys(dbObj).filter(k => ['users', 'customers', 'cashBox', 'currencies', 'hawalas', 'accounts', 'journal', 'cities', 'initialCapital', 'cityHawalaCounters', 'fxProfit', 'settings'].includes(k));
        const tx = this.db.transaction(stores, 'readwrite');
        stores.forEach(s => tx.objectStore(s).put(dbObj[s], 'root'));
        return new Promise((res, rej) => { tx.oncomplete = () => res(); tx.onerror = () => rej(tx.error); });
    }
}
const dbAdapter = new DBAdapter('heratiha_secure_db_v3', 3);

function generateSalt() { return CryptoJS.lib.WordArray.random(128/8).toString(); }
function hashPassword(pwd, salt) { return CryptoJS.PBKDF2(pwd, salt, { keySize: 256/32, iterations: 1000 }).toString(); }
function escapeHtml(text) { if (!text) return ''; return text.toString().replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;").replace(/'/g, "&#039;"); }

let db = { 
    users: [], 
    customers: [], 
    cashBox: { 'USD': 0, 'AFN': 0, 'EUR': 0 }, 
    currencies: ['USD', 'AFN', 'EUR', 'USDT', 'BTC', 'ETH'], 
    hawalas: [], 
    accounts: {}, 
    journal: [], 
    cities: [{ name: 'Ú©Ø§Ø¨Ù„', code: 'KBL' }, { name: 'Ù‡Ø±Ø§Øª', code: 'HRT' }], 
    initialCapital: { 'USD': 0, 'AFN': 0, 'EUR': 0 }, 
    cityHawalaCounters: {}, 
    fxProfit: {}, 
    settings: { printHeader: false } 
};

let currentUser = null; 
let fxProfit = {};
let ttType = 'internal'; 
let exType = 'external';
let hawalaCustType = 'external'; 
let cryptoCustType = 'external'; 
let fxDirection = 'Buy'; 
let fxOperator = 'multiply';
const CRYPTO_LIST = ['USDT', 'BTC', 'ETH', 'TRX', 'LTC', 'DOGE', 'BNB'];
function toggleTheme() {
    const html = document.documentElement;
    const current = html.getAttribute('data-theme');
    const next = current === 'dark' ? 'light' : 'dark';
    html.setAttribute('data-theme', next);
}

function getPrintHeaderHTML() {
    // Ø§Ú¯Ø± ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù†Ø¯Ø§Ø±ÛŒÙ…ØŒ Ø®Ø§Ù„ÛŒ Ø¨Ø±Ú¯Ø±Ø¯Ø§Ù†
    if (!db.settings) return '';
    // Ø§Ú¯Ø± ØªÛŒÚ© Ù†Ù…Ø§ÛŒØ´ Ø³Ø±Ø¨Ø±Ú¯ Ø®Ø§Ù…ÙˆØ´ Ø§Ø³ØªØŒ Ø®Ø§Ù„ÛŒ Ø¨Ø±Ú¯Ø±Ø¯Ø§Ù†
    if (db.settings.printHeader === false) return '';

    const title = db.settings.companyName || "ØµØ±Ø§ÙÛŒ Ù‡Ø±Ø§ØªÛŒâ€ŒÙ‡Ø§";
    const sub = db.settings.slogan || "";
    const phone = db.settings.phone || "";
    const addr = db.settings.address || "";
    
    return `<div style="text-align:center; margin-bottom:15px; border-bottom:2px solid #000; padding-bottom:10px;">
                <h2 style="margin:0; padding:0; font-family:'Vazirmatn'; font-weight:900;">${title}</h2>
                <div style="font-size:14px; margin-top:5px;">${sub}</div>
                <div style="font-size:12px; margin-top:5px; display:flex; justify-content:space-between; direction:rtl;">
                    <span>ğŸ“ ${phone}</span>
                    <span>ğŸ“ ${addr}</span>
                </div>
            </div>`;
}

async function loadDB() {
    try {
        await dbAdapter.init();
        const savedData = await dbAdapter.loadAll();
        if (savedData.users && savedData.users.length > 0) { db = Object.assign(db, savedData); } 
        else { const s = generateSalt(); db.users = [{ u: 'admin', salt: s, hash: hashPassword('123456', s), perms: { hawala: true, exchange: true, accounts: true, tt: true, admin: true } }]; }
        fxProfit = db.fxProfit || {};
        if (!db.settings) db.settings = { printHeader: false };
if (!db.avgRates) db.avgRates = {};
        db.currencies.forEach(c => { if (db.cashBox[c] === undefined) db.cashBox[c] = 0; if (db.initialCapital[c] === undefined) db.initialCapital[c] = 0; });
        db.cityHawalaCounters = db.cityHawalaCounters || {};
        db.cities.forEach(city => { if (!db.cityHawalaCounters[city.code]) { db.cityHawalaCounters[city.code] = { Outgoing: 1001, Incoming: 1001 }; } });
        await dbAdapter.saveAll(db);
    } catch (e) { console.error("DB Load Error", e); alert("Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù¾Ø§ÛŒÚ¯Ø§Ù‡ Ø¯Ø§Ø¯Ù‡"); }
}

async function saveDB() { db.fxProfit = fxProfit; try { await dbAdapter.saveAll(db); updateUI(); } catch (err) { console.error("Save Failed", err); alert("Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡ Ø§Ø·Ù„Ø§Ø¹Ø§Øª!"); } }

function go(pageId) {
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
    if (pageId === 'hawala' && !currentUser.perms.hawala && !currentUser.perms.admin) return;
    if (pageId === 'accounts' && !currentUser.perms.accounts && !currentUser.perms.admin) return;
    if (pageId === 'exchange' && !currentUser.perms.exchange && !currentUser.perms.admin) return;
    if (pageId === 'ttPage' && !currentUser.perms.tt && !currentUser.perms.admin) return;
    const targetPage = document.getElementById(pageId);
    targetPage.classList.add('active');
    const btn = document.querySelector(`.nav-btn[onclick="go('${pageId}')"]`);
    if(btn) btn.classList.add('active');
    const t = TRANSLATIONS[currentLang];
    let titleKey = "";
    switch(pageId) {
        case 'dashboard': titleKey = 'nav_dashboard'; break;
        case 'hawala': titleKey = 'nav_hawala'; break;
        case 'accounts': titleKey = 'nav_accounts'; break;
        case 'exchange': titleKey = 'nav_exchange'; break;
        case 'ttPage': titleKey = 'nav_tt'; break;
        case 'cryptoFX': titleKey = 'nav_crypto'; break;
        case 'reports': titleKey = 'nav_reports'; break;
    }
    let titleText = t[titleKey] || pageId;
    document.getElementById('pageTitle').innerText = titleText;
    updateUI();
    setTimeout(() => { const firstInput = targetPage.querySelector('input, select'); if(firstInput) firstInput.focus(); }, 100);
}

function openModal(id) { const modal = document.getElementById(id); modal.style.display = 'flex'; setTimeout(() => { const firstInput = modal.querySelector('input:not([type="hidden"]), select'); if(firstInput) firstInput.focus(); }, 100); }
function closeModal(id) { const modal = document.getElementById(id); modal.style.display = 'none'; modal.querySelectorAll('input').forEach(inp => inp.value = ''); modal.querySelectorAll('select').forEach(sel => sel.selectedIndex = 0); }

function logTx(section, desc, amt, type = null, data = null) { db.journal.push({ id: Date.now() + Math.random(), time: new Date().getTime(), section: section, desc: desc, amt: amt, user: currentUser.u, type: type, data: data }); }

async function init() {
    setLanguage(currentLang);
    const loadingMsg = document.getElementById('loadingMsg'); loadingMsg.style.display = 'block';
    await loadDB(); loadingMsg.style.display = 'none';
    document.getElementById('displayDate').innerText = new Date().toLocaleDateString(currentLang === 'fa' ? 'fa-IR' : 'en-US');
    document.addEventListener('keydown', handleGlobalKeydown);
}

function handleGlobalKeydown(e) {
    if (e.key === 'Enter') {
        const target = e.target;
        if (target.tagName === 'BUTTON') return;
        if (target.tagName === 'TEXTAREA' && !e.shiftKey) { e.preventDefault(); } else if (target.tagName !== 'TEXTAREA') { e.preventDefault(); }
        const formElements = Array.from(document.querySelectorAll('input:not([type="hidden"]):not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled])')).filter(el => { return el.offsetWidth > 0 && el.offsetHeight > 0 && el.closest('.modal') === document.querySelector('.modal[style*="flex"]') || (!document.querySelector('.modal[style*="flex"]') && el.closest('.page.active')); });
        const index = formElements.indexOf(target);
        if (index > -1 && index < formElements.length - 1) { formElements[index + 1].focus(); } else if (index === formElements.length - 1) { handleF10(); }
    }
    if (e.key.startsWith('F')) {
        const key = e.key;
        if(['F1','F2','F3','F4','F6','F9','F10'].includes(key)) e.preventDefault();
        switch (key) {
            case 'F1': go('dashboard'); break;
            case 'F2': go('hawala'); break;
            case 'F3': go('accounts'); break;
            case 'F4': go('exchange'); break;
            case 'F6': go('ttPage'); break;
            case 'F9': handleF9(); break; 
            case 'F10': handleF10(); break; 
        }
    }
    if (e.key === 'Escape') { document.querySelectorAll('.modal').forEach(m => { if(m.style.display === 'flex') { const closeBtn = m.querySelector('.close-icon'); if(closeBtn) closeBtn.click(); else m.style.display = 'none'; } }); }
}
function handleF9() {
    if (document.querySelector('.modal[style*="flex"]')) return;
    const activePage = document.querySelector('.page.active').id;
    if (activePage === 'hawala') openModal('modalNewHawala');
    else if (activePage === 'accounts') openModal('modalNewCust');
    else if (activePage === 'exchange') document.getElementById('fxBaseAmt').focus();
    else if (activePage === 'ttPage') document.getElementById('ttAmt').focus();
}

function handleF10() {
    const openModals = document.querySelectorAll('.modal');
    for (let m of openModals) {
        if (m.style.display === 'flex' || getComputedStyle(m).display === 'flex') {
            if (m.id === 'modalNewHawala') submitHawala();
            else if (m.id === 'modalEditHawala') submitEditHawala();
            else if (m.id === 'modalTx') submitTx();
            else if (m.id === 'modalClientTransfer') submitClientTransfer();
            else if (m.id === 'modalNewCust') addCustomer();
            else if (m.id === 'modalEditCust') submitEditCustomer();
            return;
        }
    }
    const activePage = document.querySelector('.page.active').id;
    if (activePage === 'exchange') submitExchange();
    else if (activePage === 'cryptoFX') submitCryptoFx();
    else if (activePage === 'ttPage') submitNewTT();
}

function auth() {
    const u = document.getElementById('loginUser').value.trim().toLowerCase();
    const p = document.getElementById('loginPass').value;
    const user = db.users.find(x => x.u === u);
    document.getElementById('loginErr').style.display = 'none';
    if (user && hashPassword(p, user.salt) === user.hash) {
        currentUser = user; 
        document.getElementById('loginPage').style.display = 'none'; 
        document.getElementById('mainApp').style.display = 'flex';
        document.getElementById('sidebarUserInfo').innerText = `${u}`;
        applyPermissions(); 
        go('dashboard'); 
        applyTranslations();
        return;
    } 
    document.getElementById('loginErr').style.display = 'block';
}

function logout() { location.reload(); }
function applyPermissions() {
    const isFullAdmin = currentUser?.perms.admin; 
    document.querySelectorAll('.admin-only-btn').forEach(el => { el.style.display = isFullAdmin ? 'flex' : 'none'; });
    document.querySelectorAll('.admin-only-view').forEach(el => { if(!isFullAdmin) el.classList.remove('active'); });
    document.querySelectorAll('.admin-only-col').forEach(el => { el.style.display = isFullAdmin ? 'table-cell' : 'none'; });
    const settingsAdminSection = document.getElementById('settingsAdminSection');
    if (settingsAdminSection) settingsAdminSection.style.display = isFullAdmin ? 'block' : 'none';
    if (!isFullAdmin) {
        if(!currentUser.perms.hawala) {
             const btn = document.querySelector("button[onclick=\"go('hawala')\"]");
             if(btn) btn.style.display = 'none';
        }
        if(!currentUser.perms.accounts) {
             const btn = document.querySelector("button[onclick=\"go('accounts')\"]");
             if(btn) btn.style.display = 'none';
        }
    }
    if (isFullAdmin) renderUserManagement();
}

function updateUI() {
    const t = TRANSLATIONS[currentLang];
    const currOptions = db.currencies.map(c => `<option value="${c}">${c}</option>`).join('');
    document.querySelectorAll('#hCurr, #editHCurr, #txCurr, #exSellCurr, #exBuyCurr, #cryptoCurr, #ttCurr, #ctCurr, #fxBaseCurr, #fxQuoteCurr').forEach(select => { 
        select.innerHTML = currOptions; 
    });
    const cityOptions = db.cities.map(c => `<option value="${c.code}">${escapeHtml(c.name)}</option>`).join('');
    document.querySelectorAll('#hCityBook, #editHCityBook').forEach(select => { select.innerHTML = cityOptions; });
    document.getElementById('filterHCity').innerHTML = `<option value="All">${t.opt_all || 'All'}</option>` + cityOptions;
    document.getElementById('cityToDelete').innerHTML = `<option value="">...</option>` + cityOptions;
    document.getElementById('cityTransferTarget').innerHTML = cityOptions;
    const custOptions = db.customers.map(c => `<option value="${escapeHtml(c.name)}">${escapeHtml(c.name)}</option>`).join('');
    document.querySelectorAll('#selCustomer, #txCust, #ttCustomer, #hCustomerSelect, #cryptoCustomer, #exCustomer').forEach(sel => { 
        sel.innerHTML = `<option value="">...</option>` + custOptions; 
    });
    document.getElementById('ctReceiver').innerHTML = custOptions;
    const currToDelete = document.getElementById('currToDelete'); 
    if (currToDelete) currToDelete.innerHTML = db.currencies.map(c => `<option value="${c}">${c}</option>`).join('');
    const initCapDiv = document.getElementById('initialCapitalInputs');
     if (initCapDiv) { 
        initCapDiv.innerHTML = db.currencies.map(c => {
            const currentRate = (db.avgRates && db.avgRates[c]) ? db.avgRates[c] : 0;
            return `
            <div style="display:flex; gap:5px; align-items:center; margin-bottom:5px; border-bottom:1px dashed #444; padding-bottom:5px;">
                <div style="flex:1">
                    <span style="font-size:11px; color:var(--gold-primary)">Ù…ÙˆØ¬ÙˆØ¯ÛŒ ${c}:</span>
                    <input type="number" id="initCap_${c}" class="input" placeholder="Amount" value="${db.initialCapital[c] || 0}" style="margin-bottom:2px">
                </div>
                <div style="flex:1">
                    <span style="font-size:11px; color:#4caf50">Ù†Ø±Ø® Ø®Ø±ÛŒØ¯ (${c}):</span>
                    <input type="number" id="initRate_${c}" class="input" placeholder="Rate" value="${currentRate}" style="margin-bottom:2px">
                </div>
            </div>`;
        }).join(''); 
    }
    if(document.getElementById('hawala').classList.contains('active')) filterHawala(); 
    if(document.getElementById('accounts').classList.contains('active')) loadCustomerLedger();
// --- Ø´Ø±ÙˆØ¹ Ú©Ø¯ Ø¬Ø¯ÛŒØ¯: Ù†Ù…Ø§ÛŒØ´ Ù†Ø§Ù… Ø´Ø±Ú©Øª ---
    if (db.settings) {
        // Ù¾Ø± Ú©Ø±Ø¯Ù† Ú©Ø§Ø¯Ø±Ù‡Ø§ÛŒ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¨Ø§ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù‚Ø¨Ù„ÛŒ
        if(document.getElementById('setCompName')) document.getElementById('setCompName').value = db.settings.companyName || '';
        if(document.getElementById('setCompSlogan')) document.getElementById('setCompSlogan').value = db.settings.slogan || '';
        if(document.getElementById('setCompPhone')) document.getElementById('setCompPhone').value = db.settings.phone || '';
        if(document.getElementById('setCompAddress')) document.getElementById('setCompAddress').value = db.settings.address || '';
        if(document.getElementById('setCompFooter')) document.getElementById('setCompFooter').value = db.settings.footerMsg || '';
        
        // ØªØºÛŒÛŒØ± Ù†Ø§Ù…â€ŒÙ‡Ø§ Ø¯Ø± Ù…Ù†Ùˆ Ùˆ ØµÙØ­Ù‡ ÙˆØ±ÙˆØ¯
        applyCompanySettings();
    }
    // --- Ù¾Ø§ÛŒØ§Ù† Ú©Ø¯ Ø¬Ø¯ÛŒØ¯ ---
}

async function togglePrintHeaderSetting() { if (!db.settings) db.settings = {}; db.settings.printHeader = document.getElementById('printHeaderOpt').checked; await saveDB(); }
// --- Ø´Ø±ÙˆØ¹ Ú©Ø¯ Ø¢Ù†Ø§Ù„ÛŒØ² Ø³Ø±Ù…Ø§ÛŒÙ‡ ---
function renderAnalysis() {
    const tbody = document.getElementById('analysisBody');
    tbody.innerHTML = '';
    
    // 1. Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…Ø§Ù†Ø¯Ù‡ Ø­Ø³Ø§Ø¨ Ù…Ø´ØªØ±ÛŒØ§Ù†
    let customerBalances = {};
    for (let custName in db.accounts) {
        db.accounts[custName].forEach(tx => {
            if (!customerBalances[tx.curr]) customerBalances[tx.curr] = 0;
            customerBalances[tx.curr] += (tx.debit - tx.credit);
        });
    }

    // 2. Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…Ø§Ù†Ø¯Ù‡ Ú©ØªØ§Ø¨ Ø­ÙˆØ§Ù„Ù‡
    let cityBalances = {};
    db.hawalas.forEach(h => {
        if (!cityBalances[h.curr]) cityBalances[h.curr] = 0;
        if (h.type === 'Outgoing') cityBalances[h.curr] += h.amt; 
        else if (h.type === 'Incoming') cityBalances[h.curr] -= h.amt; 
        if (h.comm) cityBalances[h.curr] += h.comm; 
    });

    let grandTotalUSD = 0;

    db.currencies.forEach(curr => {
        const cash = (db.cashBox[curr] || 0) + (db.initialCapital[curr] || 0);
        const custBal = customerBalances[curr] || 0;
        const cityBal = cityBalances[curr] || 0;
        const netCapital = cash + custBal + cityBal;

        // Ù†Ø±Ø® Ù¾ÛŒØ´ ÙØ±Ø¶ Ø¨Ø±Ø§ÛŒ ØªØªØ± Ùˆ Ø¯Ù„Ø§Ø± 1 Ø§Ø³Øª
        let defaultRate = '';
        if(curr === 'USD' || curr === 'USDT' || curr === 'DAI') defaultRate = '1';
        
        const tr = document.createElement('tr');
        tr.innerHTML = `
            <td style="font-weight:bold">${curr}</td>
            <td dir="ltr" style="color:${cash >= 0 ? 'var(--text-main)' : 'var(--danger)'}">${cash.toLocaleString()}</td>
            <td dir="ltr" style="color:${custBal >= 0 ? 'var(--success)' : 'var(--danger)'}">${custBal.toLocaleString()}</td>
            <td dir="ltr" style="color:${cityBal >= 0 ? 'var(--success)' : 'var(--danger)'}">${cityBal.toLocaleString()}</td>
            <td dir="ltr" style="font-weight:900; background:rgba(212,175,55,0.05); color:${netCapital >= 0 ? 'var(--gold-primary)' : 'var(--danger)'}">${netCapital.toLocaleString()}</td>
            <td>
                <input type="number" class="input" style="margin:0; text-align:center; direction:ltr" 
                       placeholder="Rate..." value="${defaultRate}" id="rate_${curr}" 
                       oninput="calculateRowUSD('${curr}', ${netCapital})">
            </td>
            <td dir="ltr" style="font-weight:bold" id="usdResult_${curr}">0</td>
        `;
        tbody.appendChild(tr);
        
        if(defaultRate === '1') {
            setTimeout(() => calculateRowUSD(curr, netCapital), 100);
        }
    });
}

function calculateRowUSD(curr, netCapital) {
    const rateInput = document.getElementById(`rate_${curr}`).value;
    const resultCell = document.getElementById(`usdResult_${curr}`);
    
    if (rateInput && !isNaN(rateInput)) {
        const rate = parseFloat(rateInput);
        const totalUSD = netCapital * rate;
        resultCell.innerText = totalUSD.toLocaleString(undefined, {minimumFractionDigits: 0, maximumFractionDigits: 2});
        resultCell.style.color = totalUSD >= 0 ? 'var(--success)' : 'var(--danger)';
        resultCell.dataset.value = totalUSD; 
    } else {
        resultCell.innerText = "0";
        resultCell.dataset.value = 0;
    }
    updateGrandTotal();
}

function updateGrandTotal() {
    let total = 0;
    db.currencies.forEach(c => {
        const cell = document.getElementById(`usdResult_${c}`);
        if(cell && cell.dataset.value) {
            total += parseFloat(cell.dataset.value);
        }
    });
    document.getElementById('grandTotalUSD').innerText = total.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2}) + " $";
}
function renderDashboard() { 
    // --- Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø³ÙˆØ¯ Ú©Ù„ (Ù…Ø«Ù„ Ù‚Ø¨Ù„) ---
    let totalProfit = {}; 
    for (const c in fxProfit) { 
        if (fxProfit[c] !== 0) totalProfit[c] = (totalProfit[c] || 0) + fxProfit[c]; 
    }

    // --- Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø³ÙˆØ¯ Ø§Ù…Ø±ÙˆØ² (Ø¨Ø®Ø´ Ø¬Ø¯ÛŒØ¯) ---
    let dailyProfit = {};
    const startOfDay = new Date();
    startOfDay.setHours(0,0,0,0); // ØªÙ†Ø¸ÛŒÙ… Ø³Ø§Ø¹Øª Ø±ÙˆÛŒ 12 Ø´Ø¨
    const startTime = startOfDay.getTime();

    // Ø¨Ø±Ø±Ø³ÛŒ Ø¯ÙØªØ± Ø±ÙˆØ²Ù†Ø§Ù…Ù‡ Ø¨Ø±Ø§ÛŒ Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯Ù† Ø³ÙˆØ¯Ù‡Ø§ÛŒ Ø§Ù…Ø±ÙˆØ²
    db.journal.forEach(log => {
        if (log.time >= startTime) {
            // Ø§Ú¯Ø± Ù…Ø¹Ø§Ù…Ù„Ù‡ Ø§Ø±Ø²ÛŒ (EXCHANGE) Ø¨ÙˆØ¯
            if (log.type === 'EXCHANGE' && log.data && log.data.profit) {
                const curr = log.data.quoteCurr; // Ø³ÙˆØ¯ Ù…Ø¹Ù…ÙˆÙ„Ø§ Ø¨Ù‡ Ø§Ø±Ø² Ø¯ÙˆÙ… (Ù…Ø«Ù„ Ø§ÙØºØ§Ù†ÛŒ) Ø§Ø³Øª
                if(curr) dailyProfit[curr] = (dailyProfit[curr] || 0) + log.data.profit;
            }
            // Ø§Ú¯Ø± Ù…Ø¹Ø§Ù…Ù„Ù‡ Ú©Ø±ÛŒÙ¾ØªÙˆ (CRYPTO) Ø¨ÙˆØ¯
            if (log.type === 'CRYPTO' && log.data && log.data.profit) {
                const curr = log.data.curr; 
                if(curr) dailyProfit[curr] = (dailyProfit[curr] || 0) + log.data.profit;
            }
        }
    });

    // --- Ù†Ù…Ø§ÛŒØ´ Ø³Ø±Ù…Ø§ÛŒÙ‡ Ø§ÙˆÙ„ÛŒÙ‡ ---
    let initHtml = ''; 
    db.currencies.forEach(c => { 
        if (db.initialCapital[c] > 0) initHtml += `<span style="margin-left:10px">${db.initialCapital[c].toLocaleString()} ${c}</span>`; 
    });
    document.getElementById('dispInitialCap').innerHTML = initHtml || `<span style="opacity:0.6">-</span>`;

    // --- Ù†Ù…Ø§ÛŒØ´ Ø³ÙˆØ¯ Ú©Ù„ ---
    let profitHtml = ''; 
    for (const c in totalProfit) { 
        const val = totalProfit[c]; 
        if (Math.abs(val) > 0.001) { 
            const color = val >= 0 ? 'var(--success)' : 'var(--danger)'; 
            profitHtml += `<div style="color:${color}; direction:ltr">${val >= 0 ? '+' : ''}${val.toLocaleString()} ${c}</div>`; 
        } 
    }
    document.getElementById('dispProfit').innerHTML = profitHtml || `0`;

    // --- Ù†Ù…Ø§ÛŒØ´ Ø³ÙˆØ¯ Ø§Ù…Ø±ÙˆØ² (Ø¬Ø¯ÛŒØ¯) ---
    let dailyHtml = '';
    for (const c in dailyProfit) {
        const val = dailyProfit[c];
        if (Math.abs(val) > 0.001) {
            const color = val >= 0 ? '#4caf50' : '#f44336'; // Ø³Ø¨Ø² Ø±ÙˆØ´Ù† ÛŒØ§ Ù‚Ø±Ù…Ø²
            dailyHtml += `<div style="color:${color}; direction:ltr">${val >= 0 ? '+' : ''}${val.toLocaleString()} ${c}</div>`;
        }
    }
    document.getElementById('dispDailyProfit').innerHTML = dailyHtml || `<span style="opacity:0.5; font-size:14px">Ø¨Ø¯ÙˆÙ† Ø³ÙˆØ¯</span>`;

    // --- Ø¨Ù‚ÛŒÙ‡ Ú©Ø¯Ù‡Ø§ÛŒ Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ (Ù†Ù…Ø§ÛŒØ´ ØµÙ†Ø¯ÙˆÙ‚ Ùˆ ...) ---
    const cashStatsDiv = document.getElementById('cashStats'); 
    const cryptoStatsDiv = document.getElementById('cryptoStats');
    cashStatsDiv.innerHTML = ''; 
    cryptoStatsDiv.innerHTML = '';
    db.currencies.forEach(c => {
        const amount = (db.cashBox[c] || 0) + (db.initialCapital[c] || 0);
        const colorClass = amount < 0 ? 'var(--danger)' : 'var(--gold-primary)';
        const boxHtml = `<div class="stat-box"><div class="label" style="color:var(--text-muted); font-weight:800">${c}</div><div class="stat-val" style="color:${colorClass}">${amount.toLocaleString()}</div></div>`;
        if (CRYPTO_LIST.includes(c)) cryptoStatsDiv.innerHTML += boxHtml; 
        else cashStatsDiv.innerHTML += boxHtml;
    });

    const cityStatsDiv = document.getElementById('cityStats'); 
    cityStatsDiv.innerHTML = '';
    const cityBalances = {}; 
    const totalCommissions = {};
    db.hawalas.forEach(h => { 
        if (!cityBalances[h.cityBook]) cityBalances[h.cityBook] = {}; 
        if (!cityBalances[h.cityBook][h.curr]) cityBalances[h.cityBook][h.curr] = 0; 
        if (h.type === 'Outgoing') cityBalances[h.cityBook][h.curr] += h.amt; 
        else if (h.type === 'Incoming') cityBalances[h.cityBook][h.curr] -= h.amt; 
        if (h.comm && h.comm > 0) { if (!totalCommissions[h.curr]) totalCommissions[h.curr] = 0; totalCommissions[h.curr] += h.comm; }
    });
    db.cities.forEach(city => {
        let balanceHtml = ''; 
        const cityBal = cityBalances[city.code];
        if (cityBal) { 
            for (const curr in cityBal) { 
                const bal = cityBal[curr]; 
                if (Math.abs(bal) > 0.001) { 
                    const color = bal >= 0 ? 'var(--success)' : 'var(--danger)'; 
                    balanceHtml += `<div style="font-size:14px; font-weight:900; color:${color}; direction:ltr">${bal >= 0 ? '+' : ''}${bal.toLocaleString()} ${curr}</div>`; 
                } 
            } 
        }
        cityStatsDiv.innerHTML += `<div class="stat-box" style="text-align:right"><div class="label" style="font-size:14px; font-weight:bold">${escapeHtml(city.name)}</div>${balanceHtml || '<div style="font-size:12px; color:gray">0</div>'}</div>`;
    });

    const commDiv = document.getElementById('cityCommissions'); 
    commDiv.innerHTML = '';
    if (Object.keys(totalCommissions).length === 0) { 
        commDiv.innerHTML = '<div style="grid-column: 1/-1; text-align:center; color:var(--text-muted); font-size:12px;">...</div>'; 
    } else { 
        for (const curr in totalCommissions) { 
            commDiv.innerHTML += `<div class="stat-box" style="background:rgba(0, 230, 118, 0.05); border-color:var(--success);"><div class="label" style="color:var(--success)">${curr}</div><div class="stat-val" style="color:var(--success)">+${totalCommissions[curr].toLocaleString()}</div></div>`; 
        } 
    }
}
function renderJournal() {
    if (!currentUser.perms.admin) return;
    const t = TRANSLATIONS[currentLang];
    const tbody = document.getElementById('journalBody');
    const logs = db.journal.sort((a, b) => b.time - a.time);
    tbody.innerHTML = logs.map(j => {
        const timeStr = new Date(j.time).toLocaleDateString(currentLang === 'fa' ? 'fa-IR' : 'en-US', { hour: '2-digit', minute: '2-digit' });
        const canReverse = j.type ? true : false;
        const btnStyle = canReverse ? "btn-red" : "btn-outline";
        const btnText = canReverse ? (currentLang === 'fa' ? "Ø­Ø°Ù Ùˆ Ø¨Ø§Ø²Ú¯Ø´Øª" : "Reverse") : (currentLang === 'fa' ? "Ø­Ø°Ù Ù„Ø§Ú¯" : "Delete Log");
        return `<tr><td style="font-size:11px">${timeStr}</td><td>${j.section}</td><td>${escapeHtml(j.desc)}</td><td dir="ltr" style="font-size:11px; font-weight:bold">${j.amt}</td><td style="font-size:11px">${j.user}</td><td class="admin-only-col"><button class="btn ${btnStyle}" style="padding:2px 5px; font-size:10px" onclick="deleteLog(${j.time}, ${j.id})">${btnText}</button></td></tr>`;
    }).join('');
}

async function deleteLog(time, logId) {
    const logEntry = db.journal.find(j => (j.id && j.id === logId) || j.time === time);
    if (!logEntry) return;
    const msg = currentLang === 'fa' ? 'Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù Ø§ÛŒÙ† Ú¯Ø²Ø§Ø±Ø´ Ùˆ Ø¨Ø§Ø²Ú¯Ø´Øª Ø§Ø«Ø± Ù…Ø§Ù„ÛŒ Ø¢Ù† Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø¯Ø§Ø±ÛŒØ¯ØŸ' : 'Are you sure you want to reverse this transaction?';
    if(confirm(msg)) {
        if (logEntry.type && logEntry.data) {
            const d = logEntry.data;
            try {
                if (logEntry.type === 'EXCHANGE') {
                    if (d.isInternal) {
                        if (d.cust && db.accounts[d.cust]) {
                            db.accounts[d.cust] = db.accounts[d.cust].filter(acc => acc.id !== d.accId1 && acc.id !== d.accId2);
                        }
                    } else {
                        if (d.baseCurr && d.quoteCurr) {
                            if (d.direction === 'Buy') { db.cashBox[d.baseCurr] -= d.baseAmt; db.cashBox[d.quoteCurr] += d.quoteAmt; } 
                            else { db.cashBox[d.baseCurr] += d.baseAmt; db.cashBox[d.quoteCurr] -= d.quoteAmt; }
                        }
                        if (d.profit && d.baseCurr) fxProfit[d.baseCurr] = (fxProfit[d.baseCurr] || 0) - d.profit;
                    }
                } 
                else if (logEntry.type === 'TX') {
                    if (d.type === 'debit') db.cashBox[d.curr] += d.amt; else db.cashBox[d.curr] -= d.amt;
                    if (db.accounts[d.cust]) db.accounts[d.cust] = db.accounts[d.cust].filter(acc => acc.id !== d.accId);
                }
                else if (logEntry.type === 'TT_INTERNAL') {
                    if (d.cust && d.accId && db.accounts[d.cust]) {
                         db.accounts[d.cust] = db.accounts[d.cust].filter(acc => acc.id !== d.accId);
                    }
                }
                else if (logEntry.type === 'TT_EXTERNAL') {
                    db.cashBox[d.curr] -= d.amt;
                }
                else if (logEntry.type === 'ACC_TRANSFER') {
                    if(db.accounts[d.s]) db.accounts[d.s] = db.accounts[d.s].filter(a => a.id !== d.id1);
                    if(db.accounts[d.r]) db.accounts[d.r] = db.accounts[d.r].filter(a => a.id !== d.id2);
                }
                else if (logEntry.type === 'HAWALA_SUBMIT') {
                    const hIndex = db.hawalas.findIndex(h => h.id === d.hawalaId);
                    if (hIndex > -1) {
                         const h = db.hawalas[hIndex];
                         if (h.type === 'Outgoing' && !d.isInternal) { db.cashBox[h.curr] -= (h.amt + (h.comm || 0)); }
                         if (d.isInternal && d.cust && d.accId && db.accounts[d.cust]) {
                             db.accounts[d.cust] = db.accounts[d.cust].filter(acc => acc.id !== d.accId);
                         }
                         db.hawalas.splice(hIndex, 1);
                    }
                    if (d.hawalaId) {
                        const parts = d.hawalaId.split('-');
                        if(parts.length >= 3) {
                             const city = parts[0];
                             const typeChar = parts[1];
                             const num = parseInt(parts[2]);
                             const typeKey = typeChar === 'O' ? 'Outgoing' : 'Incoming';
                             if (db.cityHawalaCounters[city] && db.cityHawalaCounters[city][typeKey] === num + 1) {
                                 db.cityHawalaCounters[city][typeKey]--;
                             }
                        }
                    }
                }
                else if (logEntry.type === 'HAWALA_EXEC_IN') {
                    const h = db.hawalas.find(h => h.id === d.hawalaId);
                    if(h) {
                        h.status = 'Pending'; h.execDate = 0;
                        if (d.isInternal && d.cust && d.accId) {
                            db.accounts[d.cust] = db.accounts[d.cust].filter(acc => acc.id !== d.accId);
                        } else {
                            db.cashBox[d.curr] += d.amt;
                        }
                    }
                }
                else if (logEntry.type === 'CRYPTO') {
                    if (d.isInternal) {
                         if (d.cust && db.accounts[d.cust]) {
                             db.accounts[d.cust] = db.accounts[d.cust].filter(acc => acc.id !== d.accId);
                         }
                    } else {
                        if (d.type === 'Buy') {
                            db.cashBox[d.curr] += d.fiatAmt;
                        } else {
                             db.cashBox[d.curr] -= d.fiatAmt;
                             if(d.profit) fxProfit[d.curr] = (fxProfit[d.curr] || 0) - d.profit;
                        }
                    }
                    if (d.cName && d.vol) {
                         if (d.type === 'Buy') db.cashBox[d.cName] = (db.cashBox[d.cName] || 0) - d.vol;
                         else db.cashBox[d.cName] = (db.cashBox[d.cName] || 0) + d.vol;
                    }
                }
            } catch (err) { console.error(err); alert("Error reversing transaction."); return; }
        }
        db.journal = db.journal.filter(j => j.time !== time);
        await saveDB(); renderJournal(); renderDashboard(); alert(currentLang === 'fa' ? "Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†ÛŒ Ø´Ø¯." : "Reversed.");
    }
}
function openSettings() { updateUI(); openModal('modalSettings'); }

function getNewHawalaNumber(cityCode, type) {
    if (!db.cityHawalaCounters) db.cityHawalaCounters = {};
    if (!db.cityHawalaCounters[cityCode]) { db.cityHawalaCounters[cityCode] = { Outgoing: 1001, Incoming: 1001 }; }
    if (!db.cityHawalaCounters[cityCode].Outgoing) db.cityHawalaCounters[cityCode].Outgoing = 1001;
    if (!db.cityHawalaCounters[cityCode].Incoming) db.cityHawalaCounters[cityCode].Incoming = 1001;
    const currentCount = db.cityHawalaCounters[cityCode][type];
    db.cityHawalaCounters[cityCode][type]++; 
    return currentCount;
}

function setHawalaCustType(type) {
    hawalaCustType = type;
    document.getElementById('hOptInternal').classList.toggle('active', type === 'internal');
    document.getElementById('hOptExternal').classList.toggle('active', type === 'external');
    document.getElementById('hInternalSec').style.display = type === 'internal' ? 'block' : 'none';
}

function fillHawalaCustName() {
    const sel = document.getElementById('hCustomerSelect');
    if(hawalaCustType === 'internal' && sel.value) {
        document.getElementById('hSender').value = sel.value; 
    }
}
async function submitHawala() {
    const hType = document.getElementById('hType').value; 
    const hCityBook = document.getElementById('hCityBook').value; 
    const hAmt = parseFloat(document.getElementById('hAmt').value); 
    const hCurr = document.getElementById('hCurr').value; 
    const hSender = document.getElementById('hSender').value.trim(); 
    const hReceiver = document.getElementById('hReceiver').value.trim();
    
    // Ø¯Ø±ÛŒØ§ÙØª Ù…Ù‚Ø¯Ø§Ø± Ùˆ Ù†ÙˆØ¹ Ú©Ù…ÛŒØ´Ù†
    let rawComm = parseFloat(document.getElementById('hComm').value) || 0; 
    const commType = document.getElementById('hCommType').value;
    
    // Ø§Ú¯Ø± Ù†ÙˆØ¹ Ú©Ù…ÛŒØ´Ù† "Ù¾Ø±Ø¯Ø§Ø®ØªÛŒ" Ø¨Ø§Ø´Ø¯ØŒ Ù…Ù†ÙÛŒ Ù…ÛŒØ´ÙˆØ¯ (Ù‡Ø²ÛŒÙ†Ù‡)ØŒ Ø§Ú¯Ø± "Ø¯Ø±ÛŒØ§ÙØªÛŒ" Ø¨Ø§Ø´Ø¯ØŒ Ù…Ø«Ø¨Øª Ù…ÛŒÙ…Ø§Ù†Ø¯ (Ø³ÙˆØ¯)
    const hComm = (commType === 'out') ? -rawComm : rawComm; 

    if (!hCityBook || hAmt <= 0 || !hSender || !hReceiver) { alert("Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù†Ø§Ù‚Øµ Ø§Ø³Øª / Data Incomplete"); return; }
    
    const isInternal = (hawalaCustType === 'internal');
    const custName = document.getElementById('hCustomerSelect').value;
    if (isInternal && !custName) { alert("Ù„Ø·ÙØ§ Ù…Ø´ØªØ±ÛŒ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯ / Select Customer"); return; }

    const bookNum = getNewHawalaNumber(hCityBook, hType);
    const uniqueId = `${hCityBook}-${hType === 'Outgoing' ? 'O' : 'I'}-${bookNum}`;
    const displayNum = `${hCityBook}-${bookNum}`;

    const newHawala = { 
        id: uniqueId, displayId: displayNum, bookNum: bookNum, type: hType, 
        cityBook: hCityBook, amt: hAmt, curr: hCurr, comm: hComm,
        sender: hSender, receiver: hReceiver, 
        phone: document.getElementById('hPhone').value, idCard: document.getElementById('hIDCard').value, 
        regDate: Date.now(), 
        execDate: hType === 'Outgoing' ? Date.now() : 0, 
        status: hType === 'Outgoing' ? 'Done' : 'Pending',
        isInternal: isInternal,
        internalCust: isInternal ? custName : null
    };

    let logData = { hawalaId: uniqueId, isInternal: isInternal };

    if (hType === 'Outgoing') { 
        if (isInternal) {
            const accId = Date.now();
            // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø®ÙˆØ¯Ú©Ø§Ø± Ø¨Ø§ ØªÙˆØ¬Ù‡ Ø¨Ù‡ Ù…Ø«Ø¨Øª ÛŒØ§ Ù…Ù†ÙÛŒ Ø¨ÙˆØ¯Ù† Ú©Ù…ÛŒØ´Ù†
            db.accounts[custName].push({ id: accId, date: Date.now(), desc: `Hawala Out ${displayNum} to ${hReceiver}`, curr: hCurr, debit: (hAmt + hComm), credit: 0, type: 'debit' });
            logData.cust = custName; logData.accId = accId;
            logTx('Ø­ÙˆØ§Ù„Ù‡', `Out (Int) ${displayNum}`, `Debit Account: ${hAmt+hComm} ${hCurr}`, 'HAWALA_SUBMIT', logData);
        } else {
            // ØªØ§Ø«ÛŒØ± Ù…Ø³ØªÙ‚ÛŒÙ… Ø±ÙˆÛŒ ØµÙ†Ø¯ÙˆÙ‚ (Ú©Ù… Ø´Ø¯Ù† ÛŒØ§ Ø²ÛŒØ§Ø¯ Ø´Ø¯Ù† Ø¨Ø± Ø§Ø³Ø§Ø³ Ù†ÙˆØ¹ Ú©Ù…ÛŒØ´Ù†)
            db.cashBox[hCurr] += (hAmt + hComm); 
            logTx('Ø­ÙˆØ§Ù„Ù‡', `Out (Cash) ${displayNum}`, `Cash In: ${hAmt+hComm} ${hCurr}`, 'HAWALA_SUBMIT', logData); 
        }
    } else { 
        logTx('Ø­ÙˆØ§Ù„Ù‡', `In ${displayNum}`, `Incoming: ${hAmt}`, 'HAWALA_SUBMIT', logData); 
    }

    db.hawalas.push(newHawala); 
    await saveDB(); 
    closeModal('modalNewHawala'); filterHawala(); renderDashboard(); 
    
    // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† ÙØ±Ù… Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø¨Ø¹Ø¯ÛŒ
    document.getElementById('hComm').value = "0";
    document.getElementById('hCommType').value = "in";
    
    alert(`Ø­ÙˆØ§Ù„Ù‡ ${displayNum} Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø«Ø¨Øª Ø´Ø¯.`);
}

async function execHawala(id) {
    if (!currentUser.perms.admin && !currentUser.perms.hawala) return;
    const h = db.hawalas.find(x => x.id === id); if (!h || h.status !== 'Pending') return;
    
    let confirmMsg = currentLang === 'fa' ? `Ø¢ÛŒØ§ Ø­ÙˆØ§Ù„Ù‡ ${h.displayId || h.id} Ù¾Ø±Ø¯Ø§Ø®Øª Ø´Ø¯ØŸ` : `Is Hawala ${h.displayId || h.id} Paid?`;
    
    if (h.type === 'Incoming' && confirm(confirmMsg)) {
        let logData = { hawalaId: h.id, curr: h.curr, amt: h.amt, isInternal: false };
        const currentCash = (db.cashBox[h.curr] || 0) + (db.initialCapital[h.curr] || 0);
        if (currentCash < h.amt) { alert(`Low Cash`); return; }
        db.cashBox[h.curr] -= h.amt; 
        logTx('Ø­ÙˆØ§Ù„Ù‡', `Paid Hawala (Cash) ${h.displayId}`, `Cash Out: ${h.amt} ${h.curr}`, 'HAWALA_EXEC_IN', logData);

        h.status = 'Done'; h.execDate = new Date().getTime(); 
        await saveDB(); filterHawala(); renderDashboard();
    }
}

async function submitEditHawala() {
     const id = document.getElementById('editHId').value; const h = db.hawalas.find(x => x.id === id); if (!h) return;
     h.cityBook = document.getElementById('editHCityBook').value; 
     h.sender = document.getElementById('editHSender').value; 
     h.receiver = document.getElementById('editHReceiver').value; 
     h.phone = document.getElementById('editHPhone').value; 
     h.idCard = document.getElementById('editHIDCard').value;
     logTx('Ø­ÙˆØ§Ù„Ù‡', `Edited Hawala ${h.displayId || id}`, `Edited Info`);
     await saveDB(); closeModal('modalEditHawala'); filterHawala(); renderDashboard(); alert(`Saved.`);
}

async function deleteHawala(id) {
    if (!currentUser.perms.admin) return;
    const hIndex = db.hawalas.findIndex(x => x.id === id); if (hIndex === -1) return; const h = db.hawalas[hIndex];
    if (!confirm(`Delete ${h.displayId || id}?`)) return;
    
    if (h.type === 'Outgoing' && h.status === 'Done' && !h.isInternal) {
        db.cashBox[h.curr] -= (h.amt + (h.comm || 0)); 
    } else if (h.type === 'Incoming' && h.status === 'Done' && !h.isInternal) {
        db.cashBox[h.curr] += h.amt;
    }
    db.hawalas.splice(hIndex, 1); logTx('Ø­ÙˆØ§Ù„Ù‡', `Deleted Hawala ${h.displayId || id}`, `Reversed: ${h.amt} ${h.curr}`);
    await saveDB(); filterHawala(); renderDashboard();
}
function filterHawala() {
    const list = db.hawalas.filter(h => (document.getElementById('filterHCity').value === 'All' || h.cityBook === document.getElementById('filterHCity').value) && (document.getElementById('filterHType').value === 'All' || h.type === document.getElementById('filterHType').value) && (document.getElementById('filterHStatus').value === 'All' || h.status === document.getElementById('filterHStatus').value))
    .sort((a, b) => b.regDate - a.regDate);
    const t = TRANSLATIONS[currentLang];
    document.getElementById('hawalaBody').innerHTML = list.map(h => {
        let opBtns = `<button class="btn btn-outline no-print" style="padding:5px 8px; font-size:12px; margin-left:5px" onclick="printH('${h.id}')">ğŸ–¨</button>`;
        if (h.status === 'Pending' && h.type === 'Incoming') opBtns += `<button class="btn btn-green no-print" style="padding:5px" onclick="execHawala('${h.id}')">âœ…</button>`; 
        if (currentUser.perms.admin) { opBtns += ` <button class="btn btn-outline" style="padding:5px" onclick="openEditHawalaModal('${h.id}')">âœï¸</button>`; opBtns += ` <button class="btn btn-red no-print" style="padding:5px" onclick="deleteHawala('${h.id}')">ğŸ—‘</button>`; }
        const commDisp = h.comm ? h.comm.toLocaleString() : '0';
        const typeLabel = h.type === 'Outgoing' ? `<span class="badge" style="background:#fff3cd; color:#856404">${t.opt_outgoing || 'Out'}</span>` : `<span class="badge" style="background:#d4edda; color:#155724">${t.opt_incoming || 'In'}</span>`;
        const statusLabel = h.status === 'Done' ? (t.opt_done || 'Done') : (t.opt_pending || 'Pending');
        return `<tr><td style="font-weight:900; direction:ltr">${h.displayId || h.id}</td><td>${typeLabel}</td><td>${h.cityBook}</td><td dir="ltr" style="font-weight:bold">${h.amt.toLocaleString()} ${h.curr}</td><td dir="ltr" style="color:var(--text-muted); font-weight:bold">${commDisp}</td><td>${new Date(h.regDate).toLocaleDateString(currentLang === 'fa' ? 'fa-IR' : 'en-US')}</td><td>${h.execDate ? new Date(h.execDate).toLocaleDateString(currentLang === 'fa' ? 'fa-IR' : 'en-US') : '-'}</td><td>${statusLabel}</td><td>${opBtns}</td></tr>`;
    }).join('');
}

function openEditHawalaModal(id) {
    const h = db.hawalas.find(x => x.id === id); if (!h) return;
    document.getElementById('editHId').value = h.id; document.getElementById('editHawalaId').innerText = h.displayId || h.id; document.getElementById('editHType').value = h.type; document.getElementById('editHCityBook').value = h.cityBook; document.getElementById('editHAmt').value = h.amt; document.getElementById('editHCurr').value = h.curr; document.getElementById('editHSender').value = h.sender; document.getElementById('editHReceiver').value = h.receiver; document.getElementById('editHPhone').value = h.phone; document.getElementById('editHIDCard').value = h.idCard; openModal('modalEditHawala');
}

function printH(id) {
    const h = db.hawalas.find(x => x.id === id); if (!h) { alert('Not Found'); return; }
    const t = TRANSLATIONS[currentLang];
    const typeText = h.type === 'Outgoing' ? (t.opt_outgoing || 'Outgoing') : (t.opt_incoming || 'Incoming');
    const cityName = db.cities.find(c => c.code === h.cityBook)?.name || h.cityBook;
    const win = window.open('', '_blank', 'width=800,height=600');
    const dir = t.dir;
    win.document.write(`<html><head><title>${typeText}</title><style>@page{size:A5 landscape;margin:10mm}body{font-family:'Vazirmatn','Tahoma',sans-serif;direction:${dir};padding:0}.receipt{border:3px double #000;padding:15px}.info-item{border-bottom:1px dotted #999;display:flex;justify-content:space-between;margin-bottom:5px}</style></head><body>${getPrintHeaderHTML()}<div class="receipt"><div style="text-align:center;font-weight:bold;border-bottom:1px solid #000;padding-bottom:10px">${typeText} - ${h.displayId||h.id}</div><br><div class="info-item"><b>${t.th_reg_date || 'Date'}:</b><span>${new Date(h.regDate).toLocaleDateString(currentLang === 'fa' ? 'fa-IR' : 'en-US')}</span></div><div class="info-item"><b>${t.th_city_book || 'City'}:</b><span>${escapeHtml(cityName)}</span></div><div class="info-item"><b>${t.lbl_sender || 'Sender'}:</b><span>${escapeHtml(h.sender)}</span></div><div class="info-item"><b>${t.lbl_receiver || 'Receiver'}:</b><span>${escapeHtml(h.receiver)}</span></div><div style="border:2px solid #000;padding:10px;text-align:center;margin-top:15px;background:#f9f9f9"><div>${t.th_amount || 'Amount'}:</div><b dir="ltr" style="font-size:16pt">${h.amt.toLocaleString()} ${h.curr}</b></div></div></body></html>`);
    win.document.close(); win.print();
}

function printHawalaList() {
    const filterCity = document.getElementById('filterHCity').value; const filterType = document.getElementById('filterHType').value; const filterStatus = document.getElementById('filterHStatus').value;
    const filteredHawalas = db.hawalas.filter(h => (filterCity === 'All' || h.cityBook === filterCity) && (filterType === 'All' || h.type === filterType) && (filterStatus === 'All' || h.status === filterStatus)).sort((a, b) => b.regDate - a.regDate);
    const t = TRANSLATIONS[currentLang];
    let printableBody = filteredHawalas.map(h => `<tr><td style="font-weight:bold;text-align:center">${h.displayId||h.id}</td><td>${escapeHtml(h.sender)}</td><td>${escapeHtml(h.receiver)}</td><td dir="ltr" style="text-align:center">${h.amt.toLocaleString()} ${h.curr}</td></tr>`).join('');
    const win = window.open('', '_blank', 'width=1100,height=800'); 
    const dir = t.dir;
    win.document.write(`<html><head><title>Book</title><style>table{width:100%;border-collapse:collapse;font-family:'Vazirmatn','Tahoma';direction:${dir}}th,td{border:1px solid #000;padding:5px;text-align:${dir==='rtl'?'right':'left'}}@page{size:A4 landscape}</style></head><body>${getPrintHeaderHTML()}<h3>${t.header_hawala_manage || 'Book'}</h3><table><thead><tr><th>${t.th_hawala_no}</th><th>${t.lbl_sender}</th><th>${t.lbl_receiver}</th><th>${t.th_amount}</th></tr></thead><tbody>${printableBody}</tbody></table></body></html>`);
    win.document.close(); win.print();
}

function setTTType(type) { 
    ttType = type; 
    document.getElementById('ttOptInternal').classList.toggle('active', type === 'internal'); 
    document.getElementById('ttOptExternal').classList.toggle('active', type === 'external'); 
    document.getElementById('ttInternalSec').style.display = type === 'internal' ? 'block' : 'none'; 
    document.getElementById('ttExternalSec').style.display = type === 'external' ? 'block' : 'none'; 
}

async function submitNewTT() {
    const amt = parseFloat(document.getElementById('ttAmt').value); 
    const curr = document.getElementById('ttCurr').value; 
    const ref = document.getElementById('ttRef').value || `TT-${Math.floor(Math.random()*10000)}`; 
    const ben = document.getElementById('ttBenName').value;

    if (!amt || amt <= 0 || !ben) { alert('Invalid Data'); return; }

    if (ttType === 'internal') {
        const custName = document.getElementById('ttCustomer').value;
        if (!custName) { alert('Select Customer'); return; }
        const accId = Date.now();
        db.accounts[custName].push({ id: accId, date: Date.now(), desc: `TT Request (${ref}) - Ben: ${ben}`, curr: curr, debit: amt, credit: 0, type: 'debit' });
        logTx('TT', `TT Internal ${custName}`, `Acc Deduct: ${amt} ${curr}`, 'TT_INTERNAL', { cust: custName, accId: accId, amt: amt, curr: curr });
    } else {
        const extName = document.getElementById('ttExtName').value;
        db.cashBox[curr] = (db.cashBox[curr] || 0) + amt; 
        logTx('TT', `TT Cash (${extName})`, `Cash Recieved: ${amt} ${curr}`, 'TT_EXTERNAL', { amt: amt, curr: curr });
    }
    await saveDB(); renderDashboard(); alert(`TT Registered. Ref: ${ref}`); 
}

function printCurrentTTForm() { 
    const amt = document.getElementById('ttAmt').value; 
    const curr = document.getElementById('ttCurr').value; 
    const t = TRANSLATIONS[currentLang];
    const win = window.open('', '_blank', 'width=900,height=1000'); 
    win.document.write(`<html><head><title>TT Form</title><style>body{font-family:'Vazirmatn';direction:${t.dir}}</style></head><body>${getPrintHeaderHTML()}<h3>TT Application</h3><div>Amount: ${amt} ${curr}</div></body></html>`); 
    win.document.close(); win.print(); 
}

function setCryptoCustType(type) {
    cryptoCustType = type;
    document.getElementById('cryptoOptInternal').classList.toggle('active', type === 'internal');
    document.getElementById('cryptoOptExternal').classList.toggle('active', type === 'external');
    document.getElementById('cryptoInternalSec').style.display = type === 'internal' ? 'block' : 'none';
}

async function submitCryptoFx() {
    const t = document.getElementById('cryptoTxType').value; 
    const n = document.getElementById('cryptoName').value; 
    const v = parseFloat(document.getElementById('cryptoAmt').value); 
    const fc = document.getElementById('cryptoCurr').value; 
    const fa = parseFloat(document.getElementById('fiatAmt').value);
    const desc = document.getElementById('cryptoDesc').value;

    if(!n || !v || !fa) { alert("Incomplete Data"); return; }

    let logData = { type: t, curr: fc, fiatAmt: fa, profit: 0, isInternal: false, cName: n, vol: v };
    const isInternal = (cryptoCustType === 'internal');
    const cust = document.getElementById('cryptoCustomer').value;

    if(isInternal && !cust) { alert("Select Customer"); return; }

    if (t === 'Buy') { 
        if (!isInternal && ((db.cashBox[fc]||0)+(db.initialCapital[fc]||0)) < fa) return alert('Low Cash'); 
        
        if (isInternal) {
            const id1 = Date.now();
            db.accounts[cust].push({ id: id1, date: Date.now(), desc: `Crypto Buy: ${v} ${n} (${desc})`, curr: fc, debit: 0, credit: fa, type: 'credit' });
            logData.isInternal = true; logData.cust = cust; logData.accId = id1;
        } else {
            db.cashBox[fc] -= fa; 
        }
        db.cashBox[n] = (db.cashBox[n] || 0) + v; 
        logTx('Ú©Ø±ÛŒÙ¾ØªÙˆ', `Buy ${v} ${n}`, `Paid ${fa} ${fc}`, 'CRYPTO', logData); 

    } else { 
        const cost = parseFloat(document.getElementById('cryptoCostBasis').value) || 0; 
        if (cost > 0) { logData.profit = fa - cost; fxProfit[fc] = (fxProfit[fc] || 0) + logData.profit; } 
        
        if (isInternal) {
            const id1 = Date.now();
            db.accounts[cust].push({ id: id1, date: Date.now(), desc: `Crypto Sell: ${v} ${n} (${desc})`, curr: fc, debit: fa, credit: 0, type: 'debit' });
            logData.isInternal = true; logData.cust = cust; logData.accId = id1;
        } else {
            db.cashBox[fc] += fa; 
        }
        db.cashBox[n] = (db.cashBox[n] || 0) - v; 
        logTx('Ú©Ø±ÛŒÙ¾ØªÙˆ', `Sell ${v} ${n}`, `Recvd ${fa} ${fc}`, 'CRYPTO', logData); 
    }

    if (!db.currencies.includes(n)) db.currencies.push(n); 
    await saveDB(); renderDashboard(); alert('Crypto Deal Saved.');
}

function printCryptoFx() { 
    const win = window.open('', '_blank', 'width=500,height=600'); 
    win.document.write(`<html><head><title>Crypto</title><style>body{font-family:'Vazirmatn';direction:${TRANSLATIONS[currentLang].dir}}</style></head><body>${getPrintHeaderHTML()}<h3>Crypto Receipt</h3></body></html>`); 
    win.document.close(); win.print(); 
}
async function addCustomer() { const n = document.getElementById('newCustName').value.trim(); if (!n || db.customers.some(c => c.name === n)) { alert("Invalid Name"); return; } db.customers.push({ name: n, phone: document.getElementById('newCustPhone').value }); db.accounts[n] = []; await saveDB(); closeModal('modalNewCust'); updateUI(); alert("Added."); }
function openEditCustomerModal() { const custName = document.getElementById('selCustomer').value; if (!custName) return; const custObj = db.customers.find(c => c.name === custName); document.getElementById('editCustName').value = custObj.name; document.getElementById('editCustPhone').value = custObj.phone || ''; openModal('modalEditCust'); }
async function submitEditCustomer() { const oldName = document.getElementById('selCustomer').value; const newName = document.getElementById('editCustName').value.trim(); if (!newName) return; const custIndex = db.customers.findIndex(c => c.name === oldName); if (custIndex !== -1) { db.customers[custIndex].name = newName; db.customers[custIndex].phone = document.getElementById('editCustPhone').value.trim(); } if (newName !== oldName && db.accounts[oldName]) { db.accounts[newName] = db.accounts[oldName]; delete db.accounts[oldName]; } await saveDB(); closeModal('modalEditCust'); updateUI(); document.getElementById('selCustomer').value = newName; loadCustomerLedger(); alert('Edited.'); }

async function submitTx() {
    const c = document.getElementById('txCust').value; const t = document.getElementById('txType').value; const a = parseFloat(document.getElementById('txAmt').value); const cur = document.getElementById('txCurr').value; const d = document.getElementById('txDesc').value.trim();
    if (!c || !a || a <= 0) { alert("Data Error"); return; }
    if (t === 'debit') { if (((db.cashBox[cur]||0) + (db.initialCapital[cur]||0)) < a) { alert('Low Cash'); return; } db.cashBox[cur] -= a; } else { db.cashBox[cur] += a; }
    const accId = Date.now();
    db.accounts[c].push({ id: accId, date: Date.now(), desc: d, curr: cur, debit: t === 'debit' ? a : 0, credit: t === 'credit' ? a : 0, type: t });
    logTx('Ø­Ø³Ø§Ø¨', `${t} ${c}`, `${a} ${cur}`, 'TX', { type: t, cust: c, accId: accId, amt: a, curr: cur }); 
    await saveDB(); closeModal('modalTx'); loadCustomerLedger(); renderDashboard(); alert("Saved.");
}

function loadCustomerLedger() {
    const c = document.getElementById('selCustomer').value; const div = document.getElementById('ledgerCard');
    if (!c) { div.style.display = 'none'; return; }
    div.style.display = 'block'; 
    const custObj = db.customers.find(customer => customer.name === c);
    document.getElementById('ledgerName').innerText = c;
    document.getElementById('ledgerPhone').innerText = custObj ? `(${custObj.phone || ''})` : '';
    const list = db.accounts[c] || []; list.sort((a, b) => a.date - b.date); 
    const bal = {};
    const t = TRANSLATIONS[currentLang];
    document.getElementById('ledgerBody').innerHTML = list.map(x => {
        bal[x.curr] = (bal[x.curr] || 0) + (x.credit - x.debit);
        return `<tr><td>${new Date(x.date).toLocaleDateString(currentLang === 'fa' ? 'fa-IR' : 'en-US')}</td><td>${escapeHtml(x.desc)}</td><td>${x.curr}</td><td class="${x.debit > 0 ? 'text-red' : ''}">${x.debit > 0 ? x.debit.toLocaleString() : '-'}</td><td class="${x.credit > 0 ? 'text-green' : ''}">${x.credit > 0 ? x.credit.toLocaleString() : '-'}</td><td dir="ltr" style="font-weight:bold">${bal[x.curr].toLocaleString()}</td><td class="no-print"><button class="btn btn-red admin-only-col" style="padding:2px 5px; font-size:10px" onclick="delTx('${c}',${x.id})">x</button></td></tr>`;
    }).join('');
    let s = ''; for (let k in bal) if (Math.abs(bal[k]) > 0.1) s += `<span class="${bal[k] > 0 ? 'text-red' : 'text-green'}" style="margin-right:10px">${bal[k].toLocaleString()} ${k}</span>`;
    document.getElementById('ledgerFinalSum').innerHTML = s || '0'; applyPermissions();
}

async function delTx(c, id) { if (!currentUser.perms.admin || !confirm('Delete?')) return; const idx = db.accounts[c].findIndex(x => x.id === id); const tx = db.accounts[c][idx]; if (tx.type === 'debit') db.cashBox[tx.curr] += tx.debit; else db.cashBox[tx.curr] -= tx.credit; db.accounts[c].splice(idx, 1); await saveDB(); loadCustomerLedger(); renderDashboard(); }
async function deleteCustomer() { const c = document.getElementById('selCustomer').value; if (!c || !confirm('Delete Customer?')) return; delete db.accounts[c]; db.customers = db.customers.filter(cust => cust.name !== c); await saveDB(); updateUI(); document.getElementById('ledgerCard').style.display = 'none'; }
function openModalClientTransfer() { const s = document.getElementById('selCustomer').value; if(!s) { alert("Select Source"); return; } document.getElementById('ctSender').innerText = s; openModal('modalClientTransfer'); }
async function submitClientTransfer() { 
    const s = document.getElementById('selCustomer').value; const r = document.getElementById('ctReceiver').value; const a = parseFloat(document.getElementById('ctAmt').value); const cur = document.getElementById('ctCurr').value; const desc = document.getElementById('ctDesc').value || '';
    if(!s || !r || s===r || !a || a<=0) return alert("Error");
    const id1 = Date.now(); const id2 = Date.now()+1;
    db.accounts[s].push({id:id1,date:Date.now(),desc:`Trf to ${r} - ${desc}`,curr:cur,debit:a,credit:0,type:'debit'}); 
    db.accounts[r].push({id:id2,date:Date.now(),desc:`Trf from ${s} - ${desc}`,curr:cur,debit:0,credit:a,type:'credit'}); 
    logTx('Ø§Ù†ØªÙ‚Ø§Ù„ Ø­Ø³Ø§Ø¨', `Trf ${s}->${r}`, `${a} ${cur}`, 'ACC_TRANSFER', {s:s, r:r, amt:a, curr:cur, id1:id1, id2:id2});
    await saveDB(); closeModal('modalClientTransfer'); alert('Done'); loadCustomerLedger();
}

function setExType(type) { exType = type; document.getElementById('exOptInternal').classList.toggle('active', type === 'internal'); document.getElementById('exOptExternal').classList.toggle('active', type === 'external'); document.getElementById('exInternalSec').style.display = type === 'internal' ? 'block' : 'none'; }
function setFxDirection(dir) { 
    fxDirection = dir; 
    document.getElementById('btnFxBuy').classList.remove('active', 'buy'); 
    document.getElementById('btnFxSell').classList.remove('active', 'sell'); 
    if (dir === 'Buy') { 
        document.getElementById('btnFxBuy').classList.add('active', 'buy'); 
        document.getElementById('fxDirText').innerText = currentLang === 'fa' ? "Ù…Ø§ Ù…ÛŒâ€ŒØ®Ø±ÛŒÙ… (Ø§Ø±Ø² Ù¾Ø§ÛŒÙ‡ ÙˆØ§Ø±Ø¯ ØµÙ†Ø¯ÙˆÙ‚ Ù…Ø§ Ù…ÛŒâ€ŒØ´ÙˆØ¯)" : "We Buy (Base Currency IN)"; 
        document.getElementById('fxDirText').style.color = "var(--success)"; 
    } else { 
        document.getElementById('btnFxSell').classList.add('active', 'sell'); 
        document.getElementById('fxDirText').innerText = currentLang === 'fa' ? "Ù…Ø§ Ù…ÛŒâ€ŒÙØ±ÙˆØ´ÛŒÙ… (Ø§Ø±Ø² Ù¾Ø§ÛŒÙ‡ Ø§Ø² ØµÙ†Ø¯ÙˆÙ‚ Ù…Ø§ Ø®Ø§Ø±Ø¬ Ù…ÛŒâ€ŒØ´ÙˆØ¯)" : "We Sell (Base Currency OUT)"; 
        document.getElementById('fxDirText').style.color = "var(--danger)"; 
    } 
    calcFx(); 
}
function toggleFxOperator() { fxOperator = fxOperator === 'multiply' ? 'divide' : 'multiply'; document.getElementById('fxOpDisplay').innerText = fxOperator === 'multiply' ? 'âœ–' : 'â—'; calcFx(); }
function calcFx() { 
    const baseAmt = parseFloat(document.getElementById('fxBaseAmt').value) || 0; 
    const rate = parseFloat(document.getElementById('fxRate').value) || 1; 
    const quoteCurr = document.getElementById('fxQuoteCurr').value; 
    const baseCurr = document.getElementById('fxBaseCurr').value; // Ù†Ø§Ù… Ø§Ø±Ø²ÛŒ Ú©Ù‡ Ø¯Ø§Ø±ÛŒØ¯ Ù…Ø¹Ø§Ù…Ù„Ù‡ Ù…ÛŒâ€ŒÚ©Ù†ÛŒØ¯

    // --- Ø§ÛŒÙ† Ù‚Ø³Ù…Øª Ø¬Ø¯ÛŒØ¯ Ø§Ø³Øª: Ù¾Ø± Ú©Ø±Ø¯Ù† Ø§ØªÙˆÙ…Ø§ØªÛŒÚ© Ù‚ÛŒÙ…Øª Ø®Ø±ÛŒØ¯ ---
    // ÙÙ‚Ø· ÙˆÙ‚ØªÛŒ "ÙØ±ÙˆØ´" Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ø±Ø¯Ù‡ Ø¨Ø§Ø´ÛŒØ¯ Ø§ÛŒÙ† Ú©Ø§Ø± Ø±Ø§ Ù…ÛŒâ€ŒÚ©Ù†Ø¯
    if (fxDirection === 'Sell') {
        // Ø§Ú¯Ø± Ù†Ø±Ø®â€ŒÙ‡Ø§ÛŒ Ø®Ø±ÛŒØ¯ Ù‚Ø¨Ù„Ø§Ù‹ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯Ù‡ Ø¨Ø§Ø´Ù†Ø¯ØŒ Ø¢Ù† Ø±Ø§ Ù¾ÛŒØ¯Ø§ Ù…ÛŒâ€ŒÚ©Ù†Ø¯
        if (db.avgRates && db.avgRates[baseCurr]) {
            const myBuyRate = db.avgRates[baseCurr];
            // Ø¹Ø¯Ø¯ Ø±Ø§ Ø¯Ø§Ø®Ù„ Ú©Ø§Ø¯Ø± "Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø³ÙˆØ¯" Ù…ÛŒâ€ŒÙ†ÙˆÛŒØ³Ø¯
            document.getElementById('exCostBasis').value = myBuyRate;
        } else {
            // Ø§Ú¯Ø± Ù†Ø±Ø®ÛŒ Ù¾ÛŒØ¯Ø§ Ù†Ú©Ø±Ø¯ØŒ Ú©Ø§Ø¯Ø± Ø±Ø§ Ø®Ø§Ù„ÛŒ Ù…ÛŒâ€ŒÚ¯Ø°Ø§Ø±Ø¯
            document.getElementById('exCostBasis').value = '';
        }
    }
    // ----------------------------------------------------

    let quoteAmt = 0; 
    if (rate !== 0) { 
        if (fxOperator === 'multiply') quoteAmt = baseAmt * rate; 
        else quoteAmt = baseAmt / rate; 
    } 
    document.getElementById('fxQuoteAmt').value = quoteAmt.toFixed(2); 

    // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø³ÙˆØ¯ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø¹Ø¯Ø¯ÛŒ Ú©Ù‡ Ø³ÛŒØ³ØªÙ… ÛŒØ§ Ø´Ù…Ø§ ÙˆØ§Ø±Ø¯ Ú©Ø±Ø¯Ù‡â€ŒØ§ÛŒØ¯
    const costRate = parseFloat(document.getElementById('exCostBasis').value); 
    
    if(costRate && fxDirection === 'Sell') { 
        const totalSell = quoteAmt; 
        const totalBuy = baseAmt * costRate; 
        const profit = totalSell - totalBuy;
        
        document.getElementById('estimatedProfit').innerText = profit.toLocaleString() + " " + quoteCurr; 
        
        if(profit >= 0) document.getElementById('estimatedProfit').style.color = "var(--success)"; // Ø³Ø¨Ø²
        else document.getElementById('estimatedProfit').style.color = "var(--danger)"; // Ù‚Ø±Ù…Ø²
    } else { 
        document.getElementById('estimatedProfit').innerText = "---"; 
    } 
}
async function submitExchange() {
    const baseAmt = parseFloat(document.getElementById('fxBaseAmt').value); 
    const quoteAmt = parseFloat(document.getElementById('fxQuoteAmt').value); 
    const baseCurr = document.getElementById('fxBaseCurr').value; 
    const quoteCurr = document.getElementById('fxQuoteCurr').value; 
    const desc = document.getElementById('exDesc').value; 
    const rate = parseFloat(document.getElementById('fxRate').value);

    if (!baseAmt || baseAmt <= 0 || !quoteAmt || baseCurr === quoteCurr) { 
        alert("Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù†Ø§Ù‚Øµ Ø§Ø³Øª"); return; 
    }

    if (!db.avgRates) db.avgRates = {};
    let profit = 0; 

    // Ø§Ú¯Ø± ÙØ±ÙˆØ´ Ø§Ø³ØªØŒ Ø³ÙˆØ¯ Ø±Ø§ Ø­Ø³Ø§Ø¨ Ú©Ù†
    if (fxDirection === 'Sell') {
        const avgBuyRate = db.avgRates[baseCurr] || 0; 
        if (avgBuyRate > 0) {
            const totalCost = baseAmt * avgBuyRate; 
            profit = quoteAmt - totalCost; 
        }
    }

    // Ø§Ú¯Ø± Ø®Ø±ÛŒØ¯ Ø§Ø³ØªØŒ Ù†Ø±Ø® Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ø±Ø§ Ø¢Ù¾Ø¯ÛŒØª Ú©Ù†
    if (fxDirection === 'Buy') {
        const oldQty = (db.cashBox[baseCurr] || 0) + (db.initialCapital[baseCurr] || 0);
        const oldRate = db.avgRates[baseCurr] || 0;
        const oldTotalValue = oldQty * oldRate; 
        const newTradeValue = quoteAmt; 
        const totalNewQty = oldQty + baseAmt;
        if (totalNewQty > 0) {
            const newAvgRate = (oldTotalValue + newTradeValue) / totalNewQty;
            db.avgRates[baseCurr] = newAvgRate; 
        }
    }

    const logData = { baseCurr: baseCurr, baseAmt: baseAmt, quoteCurr: quoteCurr, quoteAmt: quoteAmt, direction: fxDirection, profit: profit, isInternal: false };
    const actionText = fxDirection === 'Buy' ? `Buy ${baseAmt} ${baseCurr}` : `Sell ${baseAmt} ${baseCurr}`;

    if (exType === 'internal') {
        const cust = document.getElementById('exCustomer').value; 
        if (!cust) { alert('Ù…Ø´ØªØ±ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ù†Ø´Ø¯Ù‡'); return; }
        const id1 = Date.now(); const id2 = Date.now() + 1;

        if (fxDirection === 'Buy') {
            db.accounts[cust].push({ id: id1, date: Date.now(), desc: `ÙØ±ÙˆØ´ Ø§Ø±Ø² Ø¨Ù‡ ØµØ±Ø§ÙÛŒ (${actionText} @ ${rate})`, curr: baseCurr, debit: baseAmt, credit: 0, type: 'debit' });
            db.accounts[cust].push({ id: id2, date: Date.now(), desc: `Ø¯Ø±ÛŒØ§ÙØª Ù…Ø¹Ø§Ø¯Ù„ (${quoteAmt} ${quoteCurr})`, curr: quoteCurr, debit: 0, credit: quoteAmt, type: 'credit' });
        } else {
            db.accounts[cust].push({ id: id1, date: Date.now(), desc: `Ø®Ø±ÛŒØ¯ Ø§Ø±Ø² Ø§Ø² ØµØ±Ø§ÙÛŒ (${actionText} @ ${rate})`, curr: baseCurr, debit: 0, credit: baseAmt, type: 'credit' });
            db.accounts[cust].push({ id: id2, date: Date.now(), desc: `Ù¾Ø±Ø¯Ø§Ø®Øª Ù…Ø¹Ø§Ø¯Ù„ (${quoteAmt} ${quoteCurr})`, curr: quoteCurr, debit: quoteAmt, credit: 0, type: 'debit' });
        }
        logData.isInternal = true; logData.cust = cust; logData.accId1 = id1; logData.accId2 = id2;
        logTx('ØµØ±Ø§ÙÛŒ (Ø¯Ø§Ø®Ù„ÛŒ)', `Int FX ${cust}`, `${actionText}`, 'EXCHANGE', logData);

    } else {
        if (fxDirection === 'Buy') { 
            if ((db.cashBox[quoteCurr] || 0) + (db.initialCapital[quoteCurr] || 0) < quoteAmt) { alert(`Ù…ÙˆØ¬ÙˆØ¯ÛŒ ØµÙ†Ø¯ÙˆÙ‚ ${quoteCurr} Ú©Ù… Ø§Ø³Øª!`); return; } 
            db.cashBox[baseCurr] = (db.cashBox[baseCurr] || 0) + baseAmt; 
            db.cashBox[quoteCurr] = (db.cashBox[quoteCurr] || 0) - quoteAmt; 
        } else { 
            if ((db.cashBox[baseCurr] || 0) + (db.initialCapital[baseCurr] || 0) < baseAmt) { alert(`Ù…ÙˆØ¬ÙˆØ¯ÛŒ ØµÙ†Ø¯ÙˆÙ‚ ${baseCurr} Ú©Ù… Ø§Ø³Øª!`); return; } 
            db.cashBox[baseCurr] = (db.cashBox[baseCurr] || 0) - baseAmt; 
            db.cashBox[quoteCurr] = (db.cashBox[quoteCurr] || 0) + quoteAmt; 
        }
        
        if (profit !== 0 && fxDirection === 'Sell') { 
            fxProfit[quoteCurr] = (fxProfit[quoteCurr] || 0) + profit; 
        }
        logTx('ØµØ±Ø§ÙÛŒ', 'Cash FX', `${actionText} -> ${quoteAmt} ${quoteCurr}`, 'EXCHANGE', logData);
    }

    await saveDB(); 
    renderDashboard(); 
    
    document.getElementById('exCostBasis').value = '';
    document.getElementById('estimatedProfit').innerText = '---';
    
    // Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ§Ù… ÙØ§Ø±Ø³ÛŒ Ø³ÙˆØ¯ ÛŒØ§ Ø¶Ø±Ø±
    let msg = 'Ù…Ø¹Ø§Ù…Ù„Ù‡ Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯.';
    if(profit !== 0 && fxDirection === 'Sell') {
        if(profit > 0) msg += `\nâœ… Ø³ÙˆØ¯ Ø§ÛŒÙ† Ù…Ø¹Ø§Ù…Ù„Ù‡: ${profit.toLocaleString()} ${quoteCurr}`;
        else msg += `\nâŒ Ø²ÛŒØ§Ù† Ø§ÛŒÙ† Ù…Ø¹Ø§Ù…Ù„Ù‡: ${profit.toLocaleString()} ${quoteCurr}`;
    }
    alert(msg);
}

function printLedger() { 
    const c = document.getElementById('selCustomer').value; 
    if (!c) { alert('Ù…Ø´ØªØ±ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.'); return; }
    const list = db.accounts[c] || []; list.sort((a, b) => a.date - b.date);
    const balances = {};
    const rows = list.map(x => { 
        balances[x.curr] = (balances[x.curr] || 0) + (x.credit - x.debit); 
        return `<tr><td style="text-align:center">${new Date(x.date).toLocaleDateString('fa-IR')}</td><td>${escapeHtml(x.desc)}</td><td style="text-align:center">${x.curr}</td><td dir="ltr" style="text-align:center">${x.debit > 0 ? x.debit.toLocaleString() : '-'}</td><td dir="ltr" style="text-align:center">${x.credit > 0 ? x.credit.toLocaleString() : '-'}</td><td dir="ltr" style="text-align:center; font-weight:bold">${balances[x.curr].toLocaleString()}</td></tr>`; 
    }).join('');
    const finalSum = Object.entries(balances).map(([curr, val]) => `<div style="margin-left:20px"><b>${curr}:</b> <span dir="ltr">${val.toLocaleString()}</span></div>`).join('');
    const accNum = `ACC-${Math.abs(c.split('').reduce((a,b)=>{a=((a<<5)-a)+b.charCodeAt(0);return a&a},0)||0).toString().substring(0,8)}`; 
    const win = window.open('', '_blank', 'width=900,height=1000');
    win.document.write(`<html><head><title>Bank Statement - ${c}</title><style>@import url('https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;700&display=swap'); body { font-family: 'Vazirmatn', sans-serif; direction: rtl; padding: 40px; color: #000; font-size: 12px; } .header { display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #b8860b; padding-bottom: 10px; margin-bottom: 20px; } .cust-box { border: 1px solid #b8860b; padding: 15px; margin-bottom: 20px; border-radius: 4px; display: flex; justify-content: space-between; } table { width: 100%; border-collapse: collapse; margin-bottom: 20px; font-size: 11px; } th { border: 1px solid #b8860b; background: #eee; padding: 8px; font-weight: bold; text-align: center; } td { border: 1px solid #ccc; padding: 6px; } .summary { display: flex; justify-content: flex-end; background: #f9f9f9; padding: 10px; border: 1px solid #ccc; } @media print { @page { margin: 10mm; } }</style></head><body>${getPrintHeaderHTML()}<div class="header"><div class="title" style="font-size:20px; font-weight:bold">ØµÙˆØ±Øªâ€ŒØ­Ø³Ø§Ø¨ Ù…Ø§Ù„ÛŒ</div><div class="meta">Date: ${new Date().toLocaleDateString('fa-IR')}</div></div><div class="cust-box"><div><div style="color:#555; font-size:10px">Ù†Ø§Ù… ØµØ§Ø­Ø¨ Ø­Ø³Ø§Ø¨</div><div style="font-size:16px; font-weight:bold">${c}</div></div><div style="text-align:left"><div style="color:#555; font-size:10px">Ø´Ù…Ø§Ø±Ù‡ Ø­Ø³Ø§Ø¨</div><div style="font-size:14px; font-weight:bold">${accNum}</div></div></div><table><thead><tr><th style="width:15%">ØªØ§Ø±ÛŒØ®</th><th style="width:40%">Ø´Ø±Ø­</th><th style="width:10%">Ø§Ø±Ø²</th><th style="width:10%">Ø¨Ø¯Ù‡Ú©Ø§Ø±</th><th style="width:10%">Ø¨Ø³ØªØ§Ù†Ú©Ø§Ø±</th><th style="width:15%">Ù…Ø§Ù†Ø¯Ù‡</th></tr></thead><tbody>${rows}</tbody></table><div class="summary"><div style="font-weight:bold; margin-left:10px">Ù…Ø§Ù†Ø¯Ù‡ Ù†Ù‡Ø§ÛŒÛŒ:</div><div style="display:flex">${finalSum}</div></div></body></html>`); 
    win.document.close(); win.print();
}

function printHawalaList() {
    const filterCity = document.getElementById('filterHCity').value; const filterType = document.getElementById('filterHType').value; const filterStatus = document.getElementById('filterHStatus').value;
    let cityNameHeader = "Ù‡Ù…Ù‡ Ø´Ù‡Ø±Ù‡Ø§"; if (filterCity !== "All") { const foundCity = db.cities.find(c => c.code === filterCity); cityNameHeader = foundCity ? foundCity.name : filterCity; }
    const filteredHawalas = db.hawalas.filter(h => (filterCity === 'All' || h.cityBook === filterCity) && (filterType === 'All' || h.type === filterType) && (filterStatus === 'All' || h.status === filterStatus)).sort((a, b) => b.regDate - a.regDate);
    let totals = {}; filteredHawalas.forEach(h => { if (!totals[h.curr]) totals[h.curr] = { in: 0, out: 0, comm: 0 }; if (h.type === 'Incoming') totals[h.curr].in += h.amt; else totals[h.curr].out += h.amt; totals[h.curr].comm += (h.comm || 0); });
    let balanceHtml = '<div style="margin-bottom:20px; border:2px solid #000; padding:10px; background:#f0f0f0;"><h4 style="margin:0 0 10px 0; border-bottom:1px solid #999; padding-bottom:5px">Ø®Ù„Ø§ØµÙ‡ ÙˆØ¶Ø¹ÛŒØª</h4>';
    for (let curr in totals) { balanceHtml += `<div style="display:flex; justify-content:space-between; margin-bottom:5px; border-bottom:1px dotted #ccc; padding-bottom:5px;"><span style="font-weight:bold">${curr}</span><span>Ø¯Ø±ÛŒØ§ÙØªÛŒ: <b dir="ltr">${totals[curr].in.toLocaleString()}</b></span><span>Ù¾Ø±Ø¯Ø§Ø®ØªÛŒ: <b dir="ltr">${totals[curr].out.toLocaleString()}</b></span><span>ØªÙØ§Ø¶Ù„: <b dir="ltr" style="direction:ltr">${(totals[curr].in - totals[curr].out).toLocaleString()}</b></span><span style="background:#eee; padding:0 5px; border-radius:4px;">Ú©Ù…ÛŒØ´Ù†: <b dir="ltr">${totals[curr].comm.toLocaleString()}</b></span></div>`; }
    balanceHtml += '</div>';
    let printableBody = filteredHawalas.map(h => `<tr><td style="font-weight:bold; direction:ltr; text-align:center">${h.displayId || h.id}</td><td style="text-align:center">${new Date(h.regDate).toLocaleDateString('fa-IR')}</td><td>${escapeHtml(h.sender)}</td><td>${escapeHtml(h.receiver)}</td><td dir="ltr" style="text-align:center">${escapeHtml(h.phone || '-')}</td><td dir="ltr" style="font-weight:bold; text-align:center">${h.amt.toLocaleString()} ${h.curr}</td><td dir="ltr" style="text-align:center">${h.comm ? h.comm.toLocaleString() : '-'}</td><td style="text-align:center">${h.execDate ? new Date(h.execDate).toLocaleDateString('fa-IR') : '-'}</td></tr>`).join('');
    const win = window.open('', '_blank', 'width=1100,height=800'); 
    win.document.write(`<html><head><title>Hawala Book</title><style>table{width:100%;border-collapse:collapse;font-family:'Vazirmatn';font-size:10pt;direction:rtl}th,td{border:1px solid #000;padding:5px;text-align:right} th{background:#eee; text-align:center;} @page{size:A4 landscape}</style></head><body>${getPrintHeaderHTML()}<h3>Ú¯Ø²Ø§Ø±Ø´ Ú©ØªØ§Ø¨ Ø­ÙˆØ§Ù„Ù‡ - ${cityNameHeader}</h3>${balanceHtml}<table><thead><tr><th>Ø´Ù…Ø§Ø±Ù‡ Ø­ÙˆØ§Ù„Ù‡</th><th>ØªØ§Ø±ÛŒØ® Ø«Ø¨Øª</th><th>ÙØ±Ø³ØªÙ†Ø¯Ù‡</th><th>Ú¯ÛŒØ±Ù†Ø¯Ù‡</th><th>Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„</th><th>Ù…Ø¨Ù„Øº Ù¾ÙˆÙ„</th><th>Ú©Ù…ÛŒØ´Ù†</th><th>ØªØ§Ø±ÛŒØ® Ø§Ø¬Ø±Ø§</th></tr></thead><tbody>${printableBody}</tbody></table></body></html>`);
    win.document.close(); win.print();
}

function printH(id) {
    const h = db.hawalas.find(x => x.id === id); if (!h) { alert('Ø­ÙˆØ§Ù„Ù‡ ÛŒØ§ÙØª Ù†Ø´Ø¯.'); return; }
    const typeText = h.type === 'Outgoing' ? 'Ø­ÙˆØ§Ù„Ù‡ ØµØ§Ø¯Ø±Ù‡ (Out)' : 'Ø­ÙˆØ§Ù„Ù‡ ÙˆØ§Ø±Ø¯Ù‡ (In)';
    const cityName = db.cities.find(c => c.code === h.cityBook)?.name || h.cityBook;
    const amtInWords = numberToPersianWords(h.amt) + " " + h.curr;
    const win = window.open('', '_blank', 'width=800,height=600');
    win.document.write(`<html><head><title>${typeText} - ${h.displayId || h.id}</title><style>@page { size: A5 landscape; margin: 10mm; } body { font-family: 'Vazirmatn', tahoma; direction: rtl; padding: 0; margin: 0; font-size: 11pt; color: #000; } .receipt { width: 100%; max-width: 95%; margin: 0 auto; padding: 15px; border: 3px double #000; border-radius: 0; background: #ffffff; position: relative; } .info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px; } .info-item { font-size: 11pt; border-bottom: 1px dotted #999; padding-bottom: 5px; margin-bottom: 5px; display: flex; justify-content: space-between; } .info-item b { font-weight: bold; } .amount-box { border: 2px solid #000; padding: 10px; text-align: center; margin-top: 15px; background: #f9f9f9; } .amount-words { font-weight: bold; font-size: 12pt; margin-top: 5px; } .footer-grid { display: grid; grid-template-columns: 1fr 1fr; margin-top: 40px; text-align: center; font-size: 10pt; }</style></head><body>${getPrintHeaderHTML()}<div class="receipt"><div style="text-align:center; font-weight:bold; margin-bottom:20px; font-size: 14pt; border-bottom: 1px solid #000; padding-bottom: 10px;">Ø±Ø³ÛŒØ¯ ${typeText} (Ú©Ø¯: ${h.displayId || h.id})</div><div class="info-grid"><div class="info-item"><b>ØªØ§Ø±ÛŒØ®:</b> <span>${new Date(h.regDate).toLocaleDateString('fa-IR')}</span></div><div class="info-item"><b>Ø´Ù‡Ø± Ø·Ø±Ù Ø­Ø³Ø§Ø¨:</b> <span>${escapeHtml(cityName)}</span></div><div class="info-item"><b>ÙˆØ¶Ø¹ÛŒØª:</b> <span>${h.status}</span></div></div><div class="info-grid"><div class="info-item"><b>ÙØ±Ø³ØªÙ†Ø¯Ù‡:</b> <span>${escapeHtml(h.sender)}</span></div><div class="info-item"><b>Ú¯ÛŒØ±Ù†Ø¯Ù‡:</b> <span>${escapeHtml(h.receiver)}</span></div></div><div class="info-grid"><div class="info-item"><b>ØªÙ„ÙÙ†:</b> <span>${escapeHtml(h.phone || '-')}</span></div><div class="info-item"><b>Ø´Ù…Ø§Ø±Ù‡ ØªØ°Ú©Ø±Ù‡/Ù¾Ø§Ø³Ù¾ÙˆØ±Øª:</b> <span>${escapeHtml(h.idCard || '-')}</span></div></div><div class="amount-box"><div>Ù…Ø¨Ù„Øº Ø­ÙˆØ§Ù„Ù‡:</div><b dir="ltr" style="font-size: 16pt;">${h.amt.toLocaleString()} ${h.curr}</b><div class="amount-words">Ù…Ø¨Ù„Øº Ø¨Ù‡ Ø­Ø±ÙˆÙ: ${amtInWords}</div></div><div class="footer-grid"><div>Ø§Ù…Ø¶Ø§Ø¡ Ù…Ø´ØªØ±ÛŒ</div><div>Ù…Ù‡Ø± Ùˆ Ø§Ù…Ø¶Ø§Ø¡ ØµØ±Ø§ÙÛŒ</div></div></div></body></html>`);
    win.document.close(); win.print();
}

function printCurrentTTForm() {
    const amt = document.getElementById('ttAmt').value; const curr = document.getElementById('ttCurr').value; const amtWords = document.getElementById('ttAmtWords').value; const benName = document.getElementById('ttBenName').value; const benNameEn = document.getElementById('ttBenNameEn').value; const country = document.getElementById('ttCountry').value; const city = document.getElementById('ttCityDest').value; const address = document.getElementById('ttAddress').value; const bank = document.getElementById('ttDestBank').value; const swift = document.getElementById('ttSwift').value; const iban = document.getElementById('ttIban').value; const ref = document.getElementById('ttRef').value || '---';
    if (!amt || !benName) { alert('Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ ÙØ±Ù… Ø±Ø§ Ù¾Ø± Ú©Ù†ÛŒØ¯.'); return; }
    const win = window.open('', '_blank', 'width=900,height=1000');
    win.document.write(`<html><head><title>TT Application - ${ref}</title><style>@page { size: A4; margin: 10mm; } body { font-family: 'Times New Roman', sans-serif; padding: 20px; border: 2px solid #000; margin: 0; font-size: 11pt; } .header { text-align: center; border-bottom: 2px solid #000; padding-bottom: 15px; margin-bottom: 20px; } .title { font-size: 22px; font-weight: bold; text-transform: uppercase; letter-spacing: 1px; } .row { display: flex; margin-bottom: 5px; border-bottom: 1px dotted #eee; padding-bottom: 2px; } .lbl { font-weight: bold; width: 180px; } .val { flex: 1; font-family: 'Courier New', monospace; font-weight: 600; } .legal-text { direction: rtl; text-align: justify; font-family: 'Vazirmatn'; font-size: 9pt; margin-top: 30px; border-top: 2px solid #000; padding-top: 10px; background: #f9f9f9; padding: 10px; }</style></head><body>${getPrintHeaderHTML()}<div class="header"><div class="title">Telegraphic Transfer Application</div><div>REF: ${ref}</div><div>Date: ${new Date().toLocaleDateString('en-GB')}</div></div><div class="row"><span class="lbl">Beneficiary (FA):</span><span class="val" style="font-family:'Vazirmatn'">${benName}</span></div><div class="row"><span class="lbl">Beneficiary (EN):</span><span class="val">${benNameEn}</span></div><div class="row"><span class="lbl">Destination:</span><span class="val">${city}, ${country}</span></div><div class="row"><span class="lbl">Bank:</span><span class="val">${bank}</span></div><div class="row"><span class="lbl">Swift:</span><span class="val">${swift}</span></div><div class="row"><span class="lbl">IBAN:</span><span class="val">${iban}</span></div><div class="row"><span class="lbl">Amount:</span><span class="val">*** ${Number(amt).toLocaleString()} ${curr} ***</span></div><div class="row"><span class="lbl">Words:</span><span class="val">${amtWords}</span></div><div class="legal-text"><strong>Ù‚ÙˆØ§Ù†ÛŒÙ† Ùˆ Ù…Ù‚Ø±Ø±Ø§Øª / Terms & Conditions:</strong><br>Û±. ØµØ­Øª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨Ø± Ø¹Ù‡Ø¯Ù‡ Ù…Ø´ØªØ±ÛŒ Ø§Ø³Øª.<br>Û². Ù…Ø³Ø¦ÙˆÙ„ÛŒØª ØªØ­Ø±ÛŒÙ… Ùˆ Ø¨Ù„ÙˆÚ©Ù‡ Ø´Ø¯Ù† ÙˆØ¬Ù‡ Ø¨Ø§ Ù…Ø´ØªØ±ÛŒ Ø§Ø³Øª.<br>Û³. ØªØ§ÛŒÛŒØ¯ ÙˆØµÙˆÙ„ Ø¨Ø¹Ø¯ Ø§Ø² Û· Ø±ÙˆØ² Ú©Ø§Ø±ÛŒ Ø§Ø¹Ù„Ø§Ù… Ø´ÙˆØ¯.</div><br><br><div style="display:flex; justify-content:space-between;"><div>Signature</div><div>Company Stamp</div></div></body></html>`);
    win.document.close(); win.print();
}

function printTodayJournal() { 
    const win = window.open('', '_blank', 'width=1000,height=800');
    const originalBody = document.getElementById('journalBody');
    let rowsHTML = ""; if (originalBody) { Array.from(originalBody.rows).forEach(row => { let newRow = "<tr>"; for (let i = 0; i < 5; i++) { if (row.cells[i]) newRow += `<td style="border: 1px solid #ddd; padding: 8px; text-align: right;">${row.cells[i].innerHTML}</td>`; } newRow += "</tr>"; rowsHTML += newRow; }); }
    win.document.write(`<html><head><title>Journal Report</title><style>@page { size: A4 landscape; margin: 15mm; } body { font-family: 'Vazirmatn', Tahoma, sans-serif; direction: rtl; padding: 20px; } table { width: 100%; border-collapse: collapse; margin-top: 20px; font-size: 10pt; } th { background-color: #f2f2f2; font-weight: bold; border: 1px solid #999; padding: 10px; text-align: center; } td { border: 1px solid #ddd; padding: 8px; text-align: right; } </style></head><body>${getPrintHeaderHTML()}<h2 style="text-align:center">Ú¯Ø²Ø§Ø±Ø´ Ø¬Ø§Ù…Ø¹ Ø¯ÙØªØ± Ø±ÙˆØ²Ù†Ø§Ù…Ù‡ (Log)</h2><table><thead><tr><th style="width: 15%">Ø²Ù…Ø§Ù†</th><th style="width: 15%">Ø¨Ø®Ø´ Ø¹Ù…Ù„ÛŒØ§ØªÛŒ</th><th style="width: 40%">Ø´Ø±Ø­ ØªØ±Ø§Ú©Ù†Ø´</th><th style="width: 15%">Ù…Ø¨Ù„Øº / ØªØºÛŒÛŒØ±Ø§Øª</th><th style="width: 15%">Ú©Ø§Ø±Ø¨Ø±</th></tr></thead><tbody>${rowsHTML}</tbody></table></body></html>`);
    win.document.close(); win.print();
}

function printExchangeReceipt() {
    const baseAmt = document.getElementById('fxBaseAmt').value; const quoteAmt = document.getElementById('fxQuoteAmt').value; const baseCurr = document.getElementById('fxBaseCurr').value; const quoteCurr = document.getElementById('fxQuoteCurr').value; const rate = document.getElementById('fxRate').value; const desc = document.getElementById('exDesc').value || '---'; const type = fxDirection === 'Buy' ? 'Ø®Ø±ÛŒØ¯ Ø§Ø±Ø² (Purchase)' : 'ÙØ±ÙˆØ´ Ø§Ø±Ø² (Sale)';
    const win = window.open('', '_blank', 'width=500,height=600');
    win.document.write(`<html><head><title>Exchange Receipt</title><style>body{font-family:'Vazirmatn',tahoma;direction:rtl;padding:10px;text-align:center}.box{border:2px dashed #000;padding:20px;margin:0 auto;width:90%}.row{display:flex;justify-content:space-between;border-bottom:1px dotted #ccc;padding:5px 0}.val{font-weight:bold}</style></head><body>${getPrintHeaderHTML()}<div class="box"><h3>Ø±Ø³ÛŒØ¯ Ù…Ø¹Ø§Ù…Ù„Ù‡ Ø§Ø±Ø²ÛŒ (Deal Ticket)</h3><div class="row"><span>ØªØ§Ø±ÛŒØ®:</span><span class="val">${new Date().toLocaleDateString('fa-IR')}</span></div><div class="row"><span>Ù†ÙˆØ¹ Ø¹Ù…Ù„ÛŒØ§Øª:</span><span class="val">${type}</span></div><div class="row"><span>Ø§Ø±Ø² Ù¾Ø§ÛŒÙ‡ (Base):</span><span class="val" dir="ltr">${baseAmt} ${baseCurr}</span></div><div class="row"><span>Ø§Ø±Ø² Ù…ØªÙ‚Ø§Ø¨Ù„ (Quote):</span><span class="val" dir="ltr">${quoteAmt} ${quoteCurr}</span></div><div class="row"><span>Ù†Ø±Ø® (Rate):</span><span class="val">${rate}</span></div><div class="row"><span>ØªÙˆØ¶ÛŒØ­Ø§Øª:</span><span class="val">${desc}</span></div><br><p>Ø¨Ø§ ØªØ´Ú©Ø± Ø§Ø² Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ù…Ø§</p></div></body></html>`);
    win.document.close(); win.print();
}

function printCryptoFx() {
    const t = document.getElementById('cryptoTxType').value === 'Buy' ? 'Ø®Ø±ÛŒØ¯ (Buy)' : 'ÙØ±ÙˆØ´ (Sell)'; const n = document.getElementById('cryptoName').value; const v = document.getElementById('cryptoAmt').value; const fc = document.getElementById('cryptoCurr').value; const fa = document.getElementById('fiatAmt').value; const desc = document.getElementById('cryptoDesc').value || '---';
    const win = window.open('', '_blank', 'width=500,height=600');
    win.document.write(`<html><head><title>Crypto Receipt</title><style>body{font-family:'Vazirmatn',tahoma;direction:rtl;padding:10px;text-align:center}.box{border:3px double #000;padding:20px;margin:0 auto;width:90%}.row{display:flex;justify-content:space-between;border-bottom:1px dotted #ccc;padding:8px 0}.val{font-weight:bold}</style></head><body>${getPrintHeaderHTML()}<div class="box"><h3>Ø±Ø³ÛŒØ¯ Ø§Ø±Ø² Ø¯ÛŒØ¬ÛŒØªØ§Ù„ (Crypto)</h3><div class="row"><span>Ù†ÙˆØ¹ Ù…Ø¹Ø§Ù…Ù„Ù‡:</span><span class="val">${t}</span></div><div class="row"><span>Ù†Ø§Ù… Ø§Ø±Ø²:</span><span class="val" style="text-transform:uppercase">${n}</span></div><div class="row"><span>Ù…Ù‚Ø¯Ø§Ø± (Volume):</span><span class="val" dir="ltr">${v}</span></div><div class="row"><span>Ù…Ø¨Ù„Øº Ú©Ù„ (Fiat):</span><span class="val" dir="ltr">${fa} ${fc}</span></div><div class="row"><span>Ù…Ø´ØªØ±ÛŒ/ØªÙˆØ¶ÛŒØ­Ø§Øª:</span><span class="val">${desc}</span></div><br><div style="font-size:12px; border-top:1px solid #000; padding-top:10px;">Ø§Ù…Ø¶Ø§Ø¡ Ùˆ Ù…Ù‡Ø±</div></div></body></html>`);
    win.document.close(); win.print();
}

function exportDB() { const a = document.createElement('a'); a.href = URL.createObjectURL(new Blob([JSON.stringify(db)], { type: "application/json" })); a.download = `Backup_${Date.now()}.json`; a.click(); }
function importDB() { const i = document.createElement('input'); i.type = 'file'; i.onchange = e => { const r = new FileReader(); r.onload = async ev => { try { db = JSON.parse(ev.target.result); await dbAdapter.saveAll(db); location.reload(); } catch (x) { alert('File Error'); } }; r.readAsText(e.target.files[0]); }; i.click(); }
// --- Ø´Ø±ÙˆØ¹ Ú©Ø¯Ù‡Ø§ÛŒ Ø§Ú©Ø³Ù„ ---

// 1. Ø®Ø±ÙˆØ¬ÛŒ Ø§Ú©Ø³Ù„ Ø¨Ø±Ø§ÛŒ Ù„ÛŒØ³Øª Ø­ÙˆØ§Ù„Ù‡â€ŒÙ‡Ø§
function exportHawalaToExcel() { 
    // Ú¯Ø±ÙØªÙ† ÙÛŒÙ„ØªØ±Ù‡Ø§ÛŒ Ø§Ø¹Ù…Ø§Ù„ Ø´Ø¯Ù‡ ØªÙˆØ³Ø· Ú©Ø§Ø±Ø¨Ø±
    const filterCity = document.getElementById('filterHCity').value; 
    const filterType = document.getElementById('filterHType').value; 
    const filterStatus = document.getElementById('filterHStatus').value;
    
    // ÙÛŒÙ„ØªØ± Ú©Ø±Ø¯Ù† Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±
    const filteredHawalas = db.hawalas.filter(h => 
        (filterCity === 'All' || h.cityBook === filterCity) && 
        (filterType === 'All' || h.type === filterType) && 
        (filterStatus === 'All' || h.status === filterStatus)
    ).sort((a, b) => b.regDate - a.regDate); // Ù…Ø±ØªØ¨â€ŒØ³Ø§Ø²ÛŒ Ø¨Ø± Ø§Ø³Ø§Ø³ ØªØ§Ø±ÛŒØ® (Ø¬Ø¯ÛŒØ¯ Ø¨Ù‡ Ù‚Ø¯ÛŒÙ…)
    
    const data = []; 
    
    // Ø¨Ø®Ø´ Ø§ÙˆÙ„: Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…Ø¬Ù…ÙˆØ¹ Ù…Ø¨Ø§Ù„Øº Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ø§Ø±Ø²
    data.push({ 'Ù†Ù…Ø¨Ø±_Ø­ÙˆØ§Ù„Ù‡': '--- Ø®Ù„Ø§ØµÙ‡ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø§Ø±Ø²Ù‡Ø§ Ø¯Ø± Ø§ÛŒÙ† Ù„ÛŒØ³Øª ---' });
    
    let currencyTotals = {}; 
    filteredHawalas.forEach(h => { 
        if(!currencyTotals[h.curr]) currencyTotals[h.curr] = 0; 
        currencyTotals[h.curr] += h.amt; 
    }); 
    
    for(let c in currencyTotals) { 
        data.push({ 'Ù†Ù…Ø¨Ø±_Ø­ÙˆØ§Ù„Ù‡': c, 'Ù…Ø¨Ù„Øº': currencyTotals[c] }); 
    } 
    
    // Ø§ÛŒØ¬Ø§Ø¯ ÙØ§ØµÙ„Ù‡ Ø¯Ø± Ø§Ú©Ø³Ù„
    data.push({}); 
    data.push({});
    
    // Ø¨Ø®Ø´ Ø¯ÙˆÙ…: Ù„ÛŒØ³Øª Ú©Ø§Ù…Ù„ Ø­ÙˆØ§Ù„Ù‡â€ŒÙ‡Ø§
    filteredHawalas.forEach(h => { 
        data.push({ 
            'Ù†Ù…Ø¨Ø±_Ø­ÙˆØ§Ù„Ù‡': h.displayId || h.id, 
            'Ù†ÙˆØ¹': h.type === 'Outgoing' ? 'ØµØ§Ø¯Ø±Ù‡ (Ø§Ø±Ø³Ø§Ù„)' : 'ÙˆØ§Ø±Ø¯Ù‡ (Ø¯Ø±ÛŒØ§ÙØª)', 
            'Ø´Ù‡Ø±_Ú©ØªØ§Ø¨': db.cities.find(c => c.code === h.cityBook)?.name || h.cityBook, 
            'Ù…Ø¨Ù„Øº': h.amt, 
            'Ú©Ù…ÛŒØ´Ù†': h.comm || 0, 
            'Ø§Ø±Ø²': h.curr, 
            'ÙØ±Ø³ØªÙ†Ø¯Ù‡': h.sender, 
            'Ú¯ÛŒØ±Ù†Ø¯Ù‡': h.receiver, 
            'ØªÙ„ÙÙ†': h.phone, 
            'ØªØ§Ø±ÛŒØ®_Ø«Ø¨Øª': new Date(h.regDate).toLocaleDateString('fa-IR'), 
            'ÙˆØ¶Ø¹ÛŒØª': h.status === 'Done' ? 'Ø§Ø¬Ø±Ø§ Ø´Ø¯Ù‡' : 'Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±' 
        }); 
    });
    
    // ØªØ¨Ø¯ÛŒÙ„ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø¨Ù‡ Ø´ÛŒØª Ø§Ú©Ø³Ù„
    const ws = XLSX.utils.json_to_sheet(data); 
    const wb = XLSX.utils.book_new(); 
    XLSX.utils.book_append_sheet(wb, ws, "Ù„ÛŒØ³Øª Ø­ÙˆØ§Ù„Ø¬Ø§Øª"); 
    
    // Ø¯Ø§Ù†Ù„ÙˆØ¯ ÙØ§ÛŒÙ„
    XLSX.writeFile(wb, `Hawala_List_${new Date().toLocaleDateString('fa-IR').replace(/\//g, '-')}.xlsx`);
}

// 2. Ø®Ø±ÙˆØ¬ÛŒ Ø§Ú©Ø³Ù„ Ø¨Ø±Ø§ÛŒ ØµÙˆØ±Øªâ€ŒØ­Ø³Ø§Ø¨ Ù…Ø´ØªØ±ÛŒ (Ledger)
function exportLedgerToExcel() {
    const c = document.getElementById('selCustomer').value; 
    if(!c) {
        alert("Ù„Ø·ÙØ§ Ø§Ø¨ØªØ¯Ø§ ÛŒÚ© Ù…Ø´ØªØ±ÛŒ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.");
        return;
    }
    
    const list = db.accounts[c] || []; 
    // Ù…Ø±ØªØ¨â€ŒØ³Ø§Ø²ÛŒ ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§ Ø§Ø² Ù‚Ø¯ÛŒÙ… Ø¨Ù‡ Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ ØµÙˆØ±Øªâ€ŒØ­Ø³Ø§Ø¨
    list.sort((a, b) => a.date - b.date);
    
    // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…Ø§Ù†Ø¯Ù‡ Ù†Ù‡Ø§ÛŒÛŒ Ù‡Ø± Ø§Ø±Ø²
    const balances = {}; 
    list.forEach(x => { 
        balances[x.curr] = (balances[x.curr] || 0) + (x.credit - x.debit); 
    });
    
    const balanceString = Object.entries(balances)
        .map(([curr, val]) => `${val.toLocaleString()} ${curr}`)
        .join(' | ');
    
    const data = []; 
    
    // Ù‡Ø¯Ø± Ú¯Ø²Ø§Ø±Ø´
    data.push({ 'ØªØ§Ø±ÛŒØ®': `Ù†Ø§Ù… Ù…Ø´ØªØ±ÛŒ: ${c}`, 'Ø´Ø±Ø­': `Ù…Ø§Ù†Ø¯Ù‡ Ù†Ù‡Ø§ÛŒÛŒ Ø­Ø³Ø§Ø¨: ${balanceString}` }); 
    data.push({}); 
    
    // Ø±Ø¯ÛŒÙâ€ŒÙ‡Ø§ÛŒ ØµÙˆØ±Øªâ€ŒØ­Ø³Ø§Ø¨
    list.forEach(x => { 
        data.push({ 
            'ØªØ§Ø±ÛŒØ®': new Date(x.date).toLocaleDateString('fa-IR'), 
            'Ø´Ø±Ø­': x.desc, 
            'Ø§Ø±Ø²': x.curr, 
            'Ø¨Ø¯Ù‡Ú©Ø§Ø±': x.debit > 0 ? x.debit : 0, 
            'Ø¨Ø³ØªØ§Ù†Ú©Ø§Ø±': x.credit > 0 ? x.credit : 0 
        }); 
    });
    
    // Ø³Ø§Ø®Øª Ø´ÛŒØª Ø§Ú©Ø³Ù„
    const ws = XLSX.utils.json_to_sheet(data); 
    
    // ØªÙ†Ø¸ÛŒÙ… Ø¹Ø±Ø¶ Ø³ØªÙˆÙ†â€ŒÙ‡Ø§ Ø¨Ø±Ø§ÛŒ Ø²ÛŒØ¨Ø§ÛŒÛŒ Ø¨ÛŒØ´ØªØ±
    const wscols = [
        {wch:15}, // Ø¹Ø±Ø¶ Ø³ØªÙˆÙ† ØªØ§Ø±ÛŒØ®
        {wch:50}, // Ø¹Ø±Ø¶ Ø³ØªÙˆÙ† Ø´Ø±Ø­
        {wch:10}, // Ø¹Ø±Ø¶ Ø³ØªÙˆÙ† Ø§Ø±Ø²
        {wch:15}, // Ø¹Ø±Ø¶ Ø³ØªÙˆÙ† Ø¨Ø¯Ù‡Ú©Ø§Ø±
        {wch:15}  // Ø¹Ø±Ø¶ Ø³ØªÙˆÙ† Ø¨Ø³ØªØ§Ù†Ú©Ø§Ø±
    ]; 
    ws['!cols'] = wscols;
    
    const wb = XLSX.utils.book_new(); 
    XLSX.utils.book_append_sheet(wb, ws, "Ledger"); 
    
    // Ø¯Ø§Ù†Ù„ÙˆØ¯ ÙØ§ÛŒÙ„ Ø¨Ø§ Ù†Ø§Ù… Ù…Ø´ØªØ±ÛŒ
    XLSX.writeFile(wb, `ØµÙˆØ±ØªØ­Ø³Ø§Ø¨_${c}.xlsx`);
}
// --- Ù¾Ø§ÛŒØ§Ù† Ú©Ø¯Ù‡Ø§ÛŒ Ø§Ú©Ø³Ù„ ---
async function setInitialCapital() { 
    if (currentUser.perms.admin) { 
        if (!db.avgRates) db.avgRates = {}; 
        db.currencies.forEach(c => {
            db.initialCapital[c] = parseFloat(document.getElementById(`initCap_${c}`).value) || 0;
            const rateInput = document.getElementById(`initRate_${c}`);
            if(rateInput) { db.avgRates[c] = parseFloat(rateInput.value) || 0; }
        });
        await saveDB(); 
        alert('Ø³Ø±Ù…Ø§ÛŒÙ‡ Ùˆ Ù†Ø±Ø® Ø®Ø±ÛŒØ¯ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯.'); 
        renderDashboard(); 
    } 
}
async function changeMyPass() { const p = document.getElementById('myNewPass').value; if (p.length < 4) return; const u = db.users.find(x => x.u === currentUser.u); u.salt = generateSalt(); u.hash = hashPassword(p, u.salt); await saveDB(); alert('Password Changed.'); }
async function addUser() { const u = document.getElementById('newUName').value, p = document.getElementById('newUPass').value; if (u && p) { const s = generateSalt(); db.users.push({ u, salt: s, hash: hashPassword(p, s), perms: { hawala: document.getElementById('perm_hawala').checked, exchange: document.getElementById('perm_exchange').checked, accounts: document.getElementById('perm_accounts').checked, tt: document.getElementById('perm_tt').checked, admin: document.getElementById('perm_admin').checked } }); await saveDB(); renderUserManagement(); alert("User Added."); } }
function renderUserManagement() { document.getElementById('userListManage').innerHTML = db.users.map(u => `<div>${u.u} <button onclick="delUser('${u.u}')" class="btn btn-red" style="padding:2px 5px; font-size:10px">Delete</button></div>`).join(''); }
async function delUser(u) { if (u !== 'admin' && confirm('Delete?')) { db.users = db.users.filter(x => x.u !== u); await saveDB(); renderUserManagement(); alert("Deleted."); } }
async function addCity() { const n = document.getElementById('newCityName').value, c = document.getElementById('newCityCode').value.toUpperCase(); if (n && c) { db.cities.push({ name: n, code: c }); db.cityHawalaCounters[c] = { Outgoing: 1001, Incoming: 1001 }; await saveDB(); updateUI(); alert("City Added."); } }
async function addCurrency() { const c = document.getElementById('newCurrCode').value.toUpperCase(); if (c && !db.currencies.includes(c)) { db.currencies.push(c); db.cashBox[c] = 0; db.initialCapital[c] = 0; await saveDB(); updateUI(); alert("Currency Added."); } }
async function deleteCurrency() { const c = document.getElementById('currToDelete').value; if(c && confirm('Delete?')) { db.currencies = db.currencies.filter(x=>x!==c); delete db.cashBox[c]; await saveDB(); updateUI(); renderDashboard(); alert("Deleted."); } }
function checkCityForDelete() { const c = document.getElementById('cityToDelete').value; document.getElementById('transferCitySection').style.display = db.hawalas.some(h=>h.cityBook===c) ? 'block' : 'none'; }
async function deleteCityProcess() { const c = document.getElementById('cityToDelete').value; if(!c) return; const hasH = db.hawalas.some(h=>h.cityBook===c); if(hasH) { const t=document.getElementById('cityTransferTarget').value; if(!t)return alert('Select Target'); db.hawalas.forEach(h=>{if(h.cityBook===c)h.cityBook=t}); } db.cities=db.cities.filter(x=>x.code!==c); await saveDB(); updateUI(); alert('City Deleted.'); }
async function resetData() { if (confirm('Warning: Full Reset?')) { db.hawalas = []; db.accounts = {}; db.journal = []; db.customers = []; db.cityHawalaCounters = {}; db.cities.forEach(c => db.cityHawalaCounters[c.code] = { Outgoing: 1001, Incoming: 1001 }); db.currencies.forEach(c => db.cashBox[c] = 0); fxProfit = {}; await saveDB(); location.reload(); } }
let allAccountsCache = []; 
function openAllAccountsModal() { allAccountsCache = db.customers.map(c => { const bal = {}; if(db.accounts[c.name]) { db.accounts[c.name].forEach(x => { bal[x.curr] = (bal[x.curr] || 0) + (x.credit - x.debit); }); } return { name: c.name, phone: c.phone, balances: bal }; }); renderAllAccountsList(allAccountsCache); document.getElementById('searchAllAcc').value = ''; openModal('modalAllAcc'); }
function filterAllAccounts() { const q = document.getElementById('searchAllAcc').value.toLowerCase().trim(); if (!q) { renderAllAccountsList(allAccountsCache); return; } const filtered = allAccountsCache.filter(x => { const n = x.name ? x.name.toLowerCase() : ""; const p = x.phone ? x.phone.toString() : ""; return n.includes(q) || p.includes(q); }); renderAllAccountsList(filtered); }
function renderAllAccountsList(list) {
    const container = document.getElementById('allAccountsList');
    if(list.length === 0) { container.innerHTML = '<div style="text-align:center; padding:20px; color:gray">No Data</div>'; return; }
    container.innerHTML = list.map(item => {
        let balancesHtml = ''; let hasBalance = false;     
        for(let k in item.balances) { if(Math.abs(item.balances[k]) > 0.1) { hasBalance = true; const colorClass = item.balances[k] >= 0 ? 'text-green' : 'text-red'; const sign = item.balances[k] >= 0 ? '+' : ''; balancesHtml += `<span style="margin-left:8px; font-size:12px; background:rgba(0,0,0,0.2); padding:2px 8px; border-radius:10px; border:1px solid rgba(212,175,5,0.2)">${k}: <span class="${colorClass}" dir="ltr" style="font-weight:900">${sign}${item.balances[k].toLocaleString()}</span></span>`; } }
        if(!hasBalance) { balancesHtml = '<span style="font-size:11px; opacity:0.6; color:var(--text-muted)">Settled</span>'; }
        return `<div class="account-list-item" onclick="selectAndOpenLedger('${item.name}')"><div style="display:flex; align-items:center; gap:10px;"><div style="background:var(--gold-faint); color:var(--gold-primary); width:40px; height:40px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-weight:bold; border:1px solid var(--gold-border)">${item.name.charAt(0)}</div><div><div style="font-weight:bold; font-size:15px; color:var(--text-main)">${item.name}</div><div style="font-size:11px; opacity:0.7; color:var(--gold-primary)">${item.phone || ''}</div></div></div><div style="text-align:left; display:flex; flex-direction:column; align-items:flex-end; gap:5px; margin-top:5px;">${balancesHtml}</div></div>`;
    }).join('');
}
function selectAndOpenLedger(name) { closeModal('modalAllAcc'); go('accounts'); setTimeout(() => { const sel = document.getElementById('selCustomer'); const opt = Array.from(sel.options).find(o => o.value === name); if (!opt) { return setTimeout(() => selectAndOpenLedger(name), 150); } sel.value = name; loadCustomerLedger(); }, 200); }
function toggleAdminAccess(checkbox) { const isChecked = checkbox.checked; document.getElementById('perm_hawala').checked = isChecked; document.getElementById('perm_exchange').checked = isChecked; document.getElementById('perm_accounts').checked = isChecked; document.getElementById('perm_tt').checked = isChecked; }
// --- Ø´Ø±ÙˆØ¹ Ú©Ø¯Ù‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯ Ù¾Ø±ÙˆÙØ§ÛŒÙ„ Ø´Ø±Ú©Øª ---
async function saveCompanyProfile() {
    if (!db.settings) db.settings = {};
    
    // Ú¯Ø±ÙØªÙ† Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø§Ø² Ú©Ø§Ø¯Ø±Ù‡Ø§
    db.settings.companyName = document.getElementById('setCompName').value;
    db.settings.slogan = document.getElementById('setCompSlogan').value;
    db.settings.phone = document.getElementById('setCompPhone').value;
    db.settings.address = document.getElementById('setCompAddress').value;
    db.settings.footerMsg = document.getElementById('setCompFooter').value;
    
    await saveDB();
    applyCompanySettings();
    alert('ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø´Ø±Ú©Øª Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯!');
}

function applyCompanySettings() {
    if (!db.settings) return;
    
    const name = db.settings.companyName || "ØµØ±Ø§ÙÛŒ Ù‡Ø±Ø§ØªÛŒâ€ŒÙ‡Ø§";
    const slogan = db.settings.slogan || "Ø®Ø¯Ù…Ø§Øª Ù¾ÙˆÙ„ÛŒ Ùˆ Ø§Ø±Ø²ÛŒ";
    
    // ØªØºÛŒÛŒØ± Ù†Ø§Ù… Ø¯Ø± ØµÙØ­Ù‡ ÙˆØ±ÙˆØ¯
    const loginTitle = document.querySelector('.login-header-text');
    if(loginTitle) loginTitle.innerText = name;
    
    const loginSub = document.querySelector('.login-sub-text');
    if(loginSub) loginSub.innerText = slogan;
    
    // ØªØºÛŒÛŒØ± Ù†Ø§Ù… Ø¯Ø± Ù…Ù†ÙˆÛŒ Ø³Ù…Øª Ø±Ø§Ø³Øª
    const sidebarInfo = document.querySelector('.sidebar h2');
    if(sidebarInfo) sidebarInfo.innerText = name;
}
// --- Ù¾Ø§ÛŒØ§Ù† Ú©Ø¯Ù‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯ ---
init();
document.addEventListener('DOMContentLoaded', () => { 
    const fxContainer = document.querySelector('.fx-container'); 
    if (fxContainer) { setFxDirection('Buy'); calcFx(); } 
    setCryptoCustType('external');
});
// --- Ú©Ø¯Ù‡Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø§Ø±Ù…Ù†Ø¯Ø§Ù† ---

// 1. Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø§Ø² ÙˆØ¬ÙˆØ¯ Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Ú©Ø§Ø±Ù…Ù†Ø¯Ø§Ù†
if (!db.employees) { db.employees = []; }

// 2. ØªØ§Ø¨Ø¹ Ù†Ù…Ø§ÛŒØ´ Ù„ÛŒØ³Øª Ú©Ø§Ø±Ù…Ù†Ø¯Ø§Ù†
function renderEmployees() {
    const tbody = document.getElementById('employeeBody');
    if (!tbody) return;
    
    tbody.innerHTML = db.employees.map(emp => {
        const bal = emp.balance || 0;
        // Ø§Ú¯Ø± Ø¨Ø§Ù„Ø§Ù†Ø³ Ù…Ø«Ø¨Øª Ø¨Ø§Ø´Ø¯ ÛŒØ¹Ù†ÛŒ Ù…Ø§ Ø¨Ø¯Ù‡Ú©Ø§Ø±ÛŒÙ… (Ù‚Ø±Ù…Ø²)ØŒ Ø§Ú¯Ø± Ù…Ù†ÙÛŒ ÛŒØ§ ØµÙØ± Ø¨Ø§Ø´Ø¯ Ø³Ø¨Ø²
        const color = bal > 0 ? 'var(--danger)' : 'var(--success)';
        
        return `
            <tr>
                <td style="font-weight:bold">${emp.name}</td>
                <td>${emp.job}</td>
                <td>${parseInt(emp.salary).toLocaleString()} ${emp.curr}</td>
                <td style="color:${color}; font-weight:900; direction:ltr">${bal.toLocaleString()} ${emp.curr}</td>
                <td>
                    <button class="btn btn-gold btn-sm" onclick="accrueSalary('${emp.id}')" title="Ù…Ø§Ù‡ ØªÙ…Ø§Ù… Ø´Ø¯ØŒ Ø­Ù‚ÙˆÙ‚ Ø±Ø§ Ø¨Ù‡ Ø­Ø³Ø§Ø¨Ø´ Ø¨Ø²Ù†">ğŸ“… Ø³Ø±Ø±Ø³ÛŒØ¯ Ø­Ù‚ÙˆÙ‚</button>
                    <button class="btn btn-blue btn-sm" onclick="paySalary('${emp.id}')" title="Ù¾Ø±Ø¯Ø§Ø®Øª Ù¾ÙˆÙ„ Ù†Ù‚Ø¯ Ø§Ø² ØµÙ†Ø¯ÙˆÙ‚">ğŸ’° Ù¾Ø±Ø¯Ø§Ø®Øª Ù†Ù‚Ø¯ÛŒ</button>
                    <button class="btn btn-red btn-sm" onclick="deleteEmployee('${emp.id}')">ğŸ—‘</button>
                </td>
            </tr>
        `;
    }).join('');
    
    // Ù¾Ø± Ú©Ø±Ø¯Ù† Ù„ÛŒØ³Øª Ø§Ø±Ø²Ù‡Ø§ Ø¯Ø± ÙØ±Ù… Ø¬Ø¯ÛŒØ¯
    const currSelect = document.getElementById('empCurr');
    if(currSelect && currSelect.options.length === 0) {
        currSelect.innerHTML = db.currencies.map(c => `<option value="${c}">${c}</option>`).join('');
    }
}

// 3. Ø°Ø®ÛŒØ±Ù‡ Ú©Ø§Ø±Ù…Ù†Ø¯ Ø¬Ø¯ÛŒØ¯
async function saveNewEmployee() {
    const name = document.getElementById('empName').value;
    const job = document.getElementById('empJob').value;
    const salary = parseFloat(document.getElementById('empSalary').value);
    const curr = document.getElementById('empCurr').value;

    if(!name || !salary) { alert("Ù„Ø·ÙØ§Ù‹ Ù†Ø§Ù… Ùˆ Ø­Ù‚ÙˆÙ‚ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯"); return; }

    const newEmp = {
        id: Date.now().toString(),
        name: name,
        job: job,
        salary: salary,
        curr: curr,
        balance: 0 // ØµÙØ± ÛŒØ¹Ù†ÛŒ Ø¨ÛŒâ€ŒØ­Ø³Ø§Ø¨
    };

    if(!db.employees) db.employees = [];
    db.employees.push(newEmp);
    await saveDB();
    closeModal('modalNewEmp');
    renderEmployees();
    alert("Ú©Ø§Ø±Ù…Ù†Ø¯ Ø¬Ø¯ÛŒØ¯ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø´Ø¯.");
}

// 4. Ø³Ø±Ø±Ø³ÛŒØ¯ Ø­Ù‚ÙˆÙ‚ (Ø§ÙØ²Ø§ÛŒØ´ Ø¨Ø¯Ù‡ÛŒ Ù…Ø§ Ø¨Ù‡ Ú©Ø§Ø±Ù…Ù†Ø¯)
async function accrueSalary(id) {
    const emp = db.employees.find(e => e.id === id);
    if(!emp) return;

    if(confirm(`Ø¢ÛŒØ§ Ø­Ù‚ÙˆÙ‚ Ù…Ø§Ù‡Ø§Ù†Ù‡ Ø¨Ø±Ø§ÛŒ ${emp.name} Ø¨Ù‡ Ù…Ø¨Ù„Øº ${emp.salary} ${emp.curr} Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø´ÙˆØ¯ØŸ\n(Ø§ÛŒÙ† Ù…Ø¨Ù„Øº Ø¨Ù‡ Ø·Ù„Ø¨ Ú©Ø§Ø±Ù…Ù†Ø¯ Ø§Ø¶Ø§ÙÙ‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯)`)) {
        emp.balance = (emp.balance || 0) + parseFloat(emp.salary);
        
        // Ø«Ø¨Øª Ø¯Ø± Ú¯Ø²Ø§Ø±Ø´Ø§Øª
        logTx('Ø­Ù‚ÙˆÙ‚', `Ø³Ø±Ø±Ø³ÛŒØ¯ Ø­Ù‚ÙˆÙ‚: ${emp.name}`, `Bedehi: ${emp.salary} ${emp.curr}`);
        
        await saveDB();
        renderEmployees();
    }
}

// 5. Ù¾Ø±Ø¯Ø§Ø®Øª Ø­Ù‚ÙˆÙ‚ (Ú©Ø³Ø± Ø§Ø² ØµÙ†Ø¯ÙˆÙ‚ + Ú©Ø³Ø± Ø§Ø² Ø·Ù„Ø¨ Ú©Ø§Ø±Ù…Ù†Ø¯)
async function paySalary(id) {
    const emp = db.employees.find(e => e.id === id);
    if(!emp) return;
    
    // Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ù…Ø¨Ù„Øº Ù¾Ø±Ø¯Ø§Ø®Øª (Ú©Ù„ Ø¨Ø¯Ù‡ÛŒ)
    const amountToPay = prompt(`Ù…Ø¨Ù„Øº Ù¾Ø±Ø¯Ø§Ø®ØªÛŒ Ø¨Ù‡ ${emp.name} Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:\n(Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø·Ù„Ø¨ Ø§ÛŒØ´Ø§Ù†: ${emp.balance})`, emp.balance);
    
    if(amountToPay && parseFloat(amountToPay) > 0) {
        const amt = parseFloat(amountToPay);
        
        // Ú†Ú© Ú©Ø±Ø¯Ù† Ù…ÙˆØ¬ÙˆØ¯ÛŒ ØµÙ†Ø¯ÙˆÙ‚
        const currentCash = (db.cashBox[emp.curr] || 0) + (db.initialCapital[emp.curr] || 0);
        if(currentCash < amt) {
            alert(`Ù…ÙˆØ¬ÙˆØ¯ÛŒ ØµÙ†Ø¯ÙˆÙ‚ ${emp.curr} Ú©Ø§ÙÛŒ Ù†ÛŒØ³Øª!`);
            return;
        }

        // Ú©Ø³Ø± Ø§Ø² ØµÙ†Ø¯ÙˆÙ‚
        db.cashBox[emp.curr] -= amt;
        
        // Ú©Ø³Ø± Ø§Ø² Ø·Ù„Ø¨ Ú©Ø§Ø±Ù…Ù†Ø¯
        emp.balance -= amt;

        // Ø«Ø¨Øª Ø¯Ø± Ú¯Ø²Ø§Ø±Ø´Ø§Øª
        logTx('Ø­Ù‚ÙˆÙ‚', `Ù¾Ø±Ø¯Ø§Ø®Øª Ø­Ù‚ÙˆÙ‚ Ø¨Ù‡ ${emp.name}`, `Cash Out: ${amt} ${emp.curr}`, 'SALARY_PAY', { empId: id, amt: amt, curr: emp.curr });

        await saveDB();
        renderEmployees();
        renderDashboard(); // Ø¨Ø±Ø§ÛŒ Ø¢Ù¾Ø¯ÛŒØª Ø´Ø¯Ù† Ù…ÙˆØ¬ÙˆØ¯ÛŒ ØµÙ†Ø¯ÙˆÙ‚ Ø¯Ø± ØµÙØ­Ù‡ Ø§ØµÙ„ÛŒ
        alert("Ù¾Ø±Ø¯Ø§Ø®Øª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯.");
    }
}

// 6. Ø­Ø°Ù Ú©Ø§Ø±Ù…Ù†Ø¯
async function deleteEmployee(id) {
    if(confirm("Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ Ø§Ú¯Ø± Ú©Ø§Ø±Ù…Ù†Ø¯ Ø­Ø°Ù Ø´ÙˆØ¯ Ø­Ø³Ø§Ø¨ Ùˆ Ú©ØªØ§Ø¨ Ø§Ùˆ Ù¾Ø§Ú© Ù…ÛŒâ€ŒØ´ÙˆØ¯.")) {
        db.employees = db.employees.filter(e => e.id !== id);
        await saveDB();
        renderEmployees();
    }
}

// ØªØºÛŒÛŒØ± Ú©ÙˆÚ†Ú© Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ†Ú©Ù‡ ÙˆÙ‚ØªÛŒ Ø±ÙˆÛŒ Ø¯Ú©Ù…Ù‡ Ù…Ù†Ùˆ Ú©Ù„ÛŒÚ© Ù…ÛŒÚ©Ù†ÛŒ Ù„ÛŒØ³Øª Ø¨Ø§Ø²Ø³Ø§Ø²ÛŒ Ø´ÙˆØ¯
const originalGo = window.go;
window.go = function(pageId) {
    originalGo(pageId);
    if(pageId === 'employees') {
        renderEmployees();
    }
};
</script>
</body>
</html>
